# CSV Data Graphing Guide

This guide explains how to use the CSV files generated by the Dynamic OCPP EVSE tests to create meaningful graphs and visualizations.

## Generated CSV Files

### 1. `current_calculation_results.csv`
**Purpose:** Shows the fix for the feedback loop issue in Standard charge mode.

**Key Columns for Graphing:**
- `EVSE_Current_Per_Phase_A` (X-axis) - EVSE current from 0A to 20A per phase
- `Old_Logic_Available_A` (Y-axis) - Available current using old (broken) logic
- `New_Logic_Available_A` (Y-axis) - Available current using new (fixed) logic
- `Difference_A` (Y-axis) - Improvement gained by the fix

**Recommended Graphs:**

#### Graph 1: Feedback Loop Demonstration
- **Type:** Line chart
- **X-axis:** EVSE_Current_Per_Phase_A
- **Y-axis:** Available current (A)
- **Lines:** 
  - Old_Logic_Available_A (red line, showing decline)
  - New_Logic_Available_A (blue line, showing stability)
- **Title:** "EVSE Current Calculation: Old vs New Logic"
- **Shows:** How old logic creates feedback loop, new logic maintains stability

#### Graph 2: Improvement Analysis
- **Type:** Line chart
- **X-axis:** EVSE_Current_Per_Phase_A
- **Y-axis:** Difference_A
- **Line:** Single line showing improvement
- **Title:** "Current Availability Improvement (New - Old Logic)"
- **Shows:** Quantified benefit of the fix

### 2. `entity_migration_results.csv`
**Purpose:** Shows comprehensive testing of entity migration scenarios.

**Key Columns for Graphing:**
- `Scenario` (X-axis) - All 32 test scenarios
- `Existing_Entity_Count` (Y-axis) - Number of existing entities
- `Missing_Entity_Count` (Y-axis) - Number of entities needing creation
- `Migration_Needed` (Color/Category) - Whether migration is required

**Recommended Graphs:**

#### Graph 3: Entity Migration Coverage
- **Type:** Stacked bar chart
- **X-axis:** Scenario (Scenario_00 to Scenario_31)
- **Y-axis:** Entity count
- **Stacks:** 
  - Existing_Entity_Count (green)
  - Missing_Entity_Count (orange)
- **Title:** "Entity Migration Test Coverage (All 32 Scenarios)"
- **Shows:** Complete test coverage of all possible entity combinations

#### Graph 4: Migration Distribution
- **Type:** Histogram
- **X-axis:** Missing_Entity_Count (0, 1, 2, 3, 4, 5)
- **Y-axis:** Number of scenarios
- **Title:** "Distribution of Migration Scenarios"
- **Shows:** How many scenarios require different levels of migration

### 3. `entity_unique_ids.csv`
**Purpose:** Documents entity unique ID patterns.

**Use:** Reference table for understanding entity naming conventions.

## Sample Graph Creation

### Using Excel/Google Sheets:
1. Open the CSV file
2. Select data columns
3. Insert â†’ Chart
4. Choose appropriate chart type
5. Customize titles and labels

### Using Python (matplotlib):
```python
import pandas as pd
import matplotlib.pyplot as plt

# Load data
df = pd.read_csv('tests/current_calculation_results.csv')

# Create feedback loop demonstration graph
plt.figure(figsize=(12, 8))
plt.plot(df['EVSE_Current_Per_Phase_A'], df['Old_Logic_Available_A'], 
         'r-', label='Old Logic (Broken)', linewidth=2)
plt.plot(df['EVSE_Current_Per_Phase_A'], df['New_Logic_Available_A'], 
         'b-', label='New Logic (Fixed)', linewidth=2)
plt.xlabel('EVSE Current per Phase (A)')
plt.ylabel('Available Current (A)')
plt.title('EVSE Current Calculation: Feedback Loop Fix')
plt.legend()
plt.grid(True, alpha=0.3)
plt.show()
```

### Using R:
```r
library(ggplot2)

# Load data
df <- read.csv('tests/current_calculation_results.csv')

# Create feedback loop demonstration graph
ggplot(df, aes(x = EVSE_Current_Per_Phase_A)) +
  geom_line(aes(y = Old_Logic_Available_A, color = "Old Logic"), size = 1.2) +
  geom_line(aes(y = New_Logic_Available_A, color = "New Logic"), size = 1.2) +
  labs(title = "EVSE Current Calculation: Feedback Loop Fix",
       x = "EVSE Current per Phase (A)",
       y = "Available Current (A)",
       color = "Logic Type") +
  theme_minimal()
```

## Key Insights to Highlight

### Current Calculation Fix:
1. **Feedback Loop Problem:** Old logic shows declining available current as EVSE current increases
2. **Stability Achievement:** New logic maintains constant available current
3. **Quantified Improvement:** Up to 20A improvement in available current at high EVSE loads

### Entity Migration Fix:
1. **Complete Coverage:** All 32 possible entity combinations tested
2. **Migration Success:** 100% success rate across all scenarios
3. **Automatic Detection:** System correctly identifies missing entities in all cases

## Graph Interpretation

### What Good Results Look Like:
- **Current Calculation:** New logic line should be flat/stable
- **Entity Migration:** All scenarios should show "PASS" result
- **Coverage:** All possible combinations should be tested

### Red Flags to Watch For:
- **Current Calculation:** Declining available current as EVSE current increases
- **Entity Migration:** Any "FAIL" results or missing scenarios
- **Data Quality:** Missing data points or inconsistent patterns

## Using the Data

1. **Validation:** Graphs prove the fixes work correctly
2. **Documentation:** Visual evidence for technical documentation
3. **Monitoring:** Baseline data for future regression testing
4. **Analysis:** Quantified improvement metrics for reporting
