# Test scenarios: Eco mode, single-phase sites, no battery

scenarios:

  - name: "1ph-1c-eco-no-bat-good-solar"
    description: "Eco mode with solar surplus above min current"
    human_verified: false
    site:
      voltage: 230
      main_breaker_rating: 35
      max_import_power: 8050
      distribution_mode: priority
      solar_production: 3450  # 15A at 230V
      phase_a_consumption: 3.0
      battery_soc: null
      battery_soc_min: null
      battery_soc_target: null
      battery_max_charge_power: null
      battery_max_discharge_power: null
      inverter_supports_asymmetric: false
      inverter_max_power_per_phase: 12000
      inverter_max_power: 12000
    chargers:
      - entity_id: "charger_1"
        operating_mode: "Solar Priority"
        min_current: 6
        max_current: 16
        phases: 1
        priority: 1
    expected:
      charger_1:
        allocated: 12.0  # 15A solar - 3A consumption = 12A surplus > 6A min → use surplus

  - name: "1ph-1c-eco-no-bat-low-solar"
    description: "Eco mode with solar surplus below min current, falls back to minimum"
    human_verified: false
    site:
      voltage: 230
      main_breaker_rating: 35
      max_import_power: 8050
      distribution_mode: priority
      solar_production: 1610  # 7A at 230V
      phase_a_consumption: 4.0
      battery_soc: null
      battery_soc_min: null
      battery_soc_target: null
      battery_max_charge_power: null
      battery_max_discharge_power: null
      inverter_supports_asymmetric: false
      inverter_max_power_per_phase: 12000
      inverter_max_power: 12000
    chargers:
      - entity_id: "charger_1"
        operating_mode: "Solar Priority"
        min_current: 6
        max_current: 16
        phases: 1
        priority: 1
    expected:
      charger_1:
        allocated: 6.0  # 7A - 4A = 3A surplus < 6A min → Eco guarantees minimum

  - name: "1ph-1c-eco-no-bat-zero-solar"
    description: "Eco mode at night, no solar — charges at minimum"
    human_verified: false
    site:
      voltage: 230
      main_breaker_rating: 35
      max_import_power: 8050
      distribution_mode: priority
      solar_production: 0
      phase_a_consumption: 2.0
      battery_soc: null
      battery_soc_min: null
      battery_soc_target: null
      battery_max_charge_power: null
      battery_max_discharge_power: null
      inverter_supports_asymmetric: false
      inverter_max_power_per_phase: 12000
      inverter_max_power: 12000
    chargers:
      - entity_id: "charger_1"
        operating_mode: "Solar Priority"
        min_current: 6
        max_current: 16
        phases: 1
        priority: 1
    expected:
      charger_1:
        allocated: 6.0  # No solar → 0A surplus, Eco guarantees minimum 6A
