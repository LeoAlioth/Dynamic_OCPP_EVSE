s6-rc: info: service s6rc-oneshot-runner: starting
s6-rc: info: service s6rc-oneshot-runner successfully started
s6-rc: info: service fix-attrs: starting
s6-rc: info: service fix-attrs successfully started
s6-rc: info: service legacy-cont-init: starting
s6-rc: info: service legacy-cont-init successfully started
s6-rc: info: service legacy-services: starting
services-up: info: copying legacy longrun home-assistant (no readiness notification)
s6-rc: info: service legacy-services successfully started
2025-12-23 13:09:46.061 WARNING (SyncWorker_0) [homeassistant.loader] We found a custom integration evcc_intg which has not been tested by Home Assistant. This component might cause stability problems, be sure to disable it if you experience issues with Home Assistant
2025-12-23 13:09:46.062 WARNING (SyncWorker_0) [homeassistant.loader] We found a custom integration dynamic_ocpp_evse which has not been tested by Home Assistant. This component might cause stability problems, be sure to disable it if you experience issues with Home Assistant
2025-12-23 13:09:46.063 WARNING (SyncWorker_0) [homeassistant.loader] We found a custom integration solaredge_modbus which has not been tested by Home Assistant. This component might cause stability problems, be sure to disable it if you experience issues with Home Assistant
2025-12-23 13:09:46.064 WARNING (SyncWorker_0) [homeassistant.loader] We found a custom integration solaredge_modbus_multi which has not been tested by Home Assistant. This component might cause stability problems, be sure to disable it if you experience issues with Home Assistant
2025-12-23 13:09:46.064 WARNING (SyncWorker_0) [homeassistant.loader] We found a custom integration ocpp which has not been tested by Home Assistant. This component might cause stability problems, be sure to disable it if you experience issues with Home Assistant
2025-12-23 13:09:46.065 WARNING (SyncWorker_0) [homeassistant.loader] We found a custom integration goecharger_api2 which has not been tested by Home Assistant. This component might cause stability problems, be sure to disable it if you experience issues with Home Assistant
2025-12-23 13:09:46.065 WARNING (SyncWorker_0) [homeassistant.loader] We found a custom integration hacs which has not been tested by Home Assistant. This component might cause stability problems, be sure to disable it if you experience issues with Home Assistant
2025-12-23 13:09:46.066 WARNING (SyncWorker_0) [homeassistant.loader] We found a custom integration sunspec which has not been tested by Home Assistant. This component might cause stability problems, be sure to disable it if you experience issues with Home Assistant
2025-12-23 13:09:46.066 WARNING (SyncWorker_0) [homeassistant.loader] We found a custom integration mojelektro which has not been tested by Home Assistant. This component might cause stability problems, be sure to disable it if you experience issues with Home Assistant
2025-12-23 13:09:46.067 WARNING (SyncWorker_0) [homeassistant.loader] We found a custom integration elektro_network_tariff which has not been tested by Home Assistant. This component might cause stability problems, be sure to disable it if you experience issues with Home Assistant
2025-12-23 13:09:46.067 WARNING (SyncWorker_0) [homeassistant.loader] We found a custom integration evcc_intg which has not been tested by Home Assistant. This component might cause stability problems, be sure to disable it if you experience issues with Home Assistant
2025-12-23 13:09:46.068 WARNING (SyncWorker_0) [homeassistant.loader] We found a custom integration dynamic_ocpp_evse which has not been tested by Home Assistant. This component might cause stability problems, be sure to disable it if you experience issues with Home Assistant
2025-12-23 13:09:46.068 WARNING (SyncWorker_0) [homeassistant.loader] We found a custom integration solaredge_modbus which has not been tested by Home Assistant. This component might cause stability problems, be sure to disable it if you experience issues with Home Assistant
2025-12-23 13:09:46.069 WARNING (SyncWorker_0) [homeassistant.loader] We found a custom integration solaredge_modbus_multi which has not been tested by Home Assistant. This component might cause stability problems, be sure to disable it if you experience issues with Home Assistant
2025-12-23 13:09:46.069 WARNING (SyncWorker_0) [homeassistant.loader] We found a custom integration ocpp which has not been tested by Home Assistant. This component might cause stability problems, be sure to disable it if you experience issues with Home Assistant
2025-12-23 13:09:46.069 WARNING (SyncWorker_0) [homeassistant.loader] We found a custom integration goecharger_api2 which has not been tested by Home Assistant. This component might cause stability problems, be sure to disable it if you experience issues with Home Assistant
2025-12-23 13:09:46.070 WARNING (SyncWorker_0) [homeassistant.loader] We found a custom integration hacs which has not been tested by Home Assistant. This component might cause stability problems, be sure to disable it if you experience issues with Home Assistant
2025-12-23 13:09:46.070 WARNING (SyncWorker_0) [homeassistant.loader] We found a custom integration sunspec which has not been tested by Home Assistant. This component might cause stability problems, be sure to disable it if you experience issues with Home Assistant
2025-12-23 13:09:46.071 WARNING (SyncWorker_0) [homeassistant.loader] We found a custom integration mojelektro which has not been tested by Home Assistant. This component might cause stability problems, be sure to disable it if you experience issues with Home Assistant
2025-12-23 13:09:46.071 WARNING (SyncWorker_0) [homeassistant.loader] We found a custom integration elektro_network_tariff which has not been tested by Home Assistant. This component might cause stability problems, be sure to disable it if you experience issues with Home Assistant
2025-12-23 13:09:49.656 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get attribute 'phases' for sensor: sensor.dynamic_ocpp_evse
2025-12-23 13:09:49.872 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: select.dynamic_ocpp_evse_charging_mode: [FrameInfo(frame=<frame at 0x7f85ad8f20, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f85eb5470, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 359, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=359, function='get_state_config', code_context=['    state[CONF_CHARING_MODE] = get_sensor_data(self, self.config_entry.data.get(CONF_CHARGIN_MODE_ENTITY_ID))\n'], index=0, positions=Positions(lineno=359, end_lineno=359, col_offset=31, end_col_offset=109)), FrameInfo(frame=<frame at 0x7f85baadd0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f85ad7240, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f85ada460, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 26, code async_update_data>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=26, function='async_update_data', code_context=['        await temp_sensor.async_update()\n'], index=0, positions=Positions(lineno=26, end_lineno=26, col_offset=8, end_col_offset=40)), FrameInfo(frame=<frame at 0x7f85ac6c80, file '/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', line 308, code _async_update_data>, filename='/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', lineno=308, function='_async_update_data', code_context=['        return await self.update_method()\n'], index=0, positions=Positions(lineno=308, end_lineno=308, col_offset=15, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f85aae3e0, file '/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', line 419, code _async_refresh>, filename='/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', lineno=419, function='_async_refresh', code_context=['            self.data = await self._async_update_data()\n'], index=0, positions=Positions(lineno=419, end_lineno=419, col_offset=24, end_col_offset=55)), FrameInfo(frame=<frame at 0x7f859d9e00, file '/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', line 343, code _async_config_entry_first_refresh>, filename='/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', lineno=343, function='_async_config_entry_first_refresh', code_context=['            await self._async_refresh(\n'], index=0, positions=Positions(lineno=343, end_lineno=347, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f859da340, file '/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', line 318, code async_config_entry_first_refresh>, filename='/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', lineno=318, function='async_config_entry_first_refresh', code_context=['            await self._async_config_entry_first_refresh()\n'], index=0, positions=Positions(lineno=318, end_lineno=318, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f85ad51c0, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 49, code async_setup_entry>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=49, function='async_setup_entry', code_context=['    await coordinator.async_config_entry_first_refresh()\n'], index=0, positions=Positions(lineno=49, end_lineno=49, col_offset=4, end_col_offset=56)), FrameInfo(frame=<frame at 0x7f859793f0, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f85afeda0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 448, code _async_setup_platform>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=448, function='_async_setup_platform', code_context=['                awaitable = create_eager_task(awaitable, loop=hass.loop)\n'], index=0, positions=Positions(lineno=448, end_lineno=448, col_offset=28, end_col_offset=72)), FrameInfo(frame=<frame at 0x7f859da0a0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 418, code async_setup_entry>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=418, function='async_setup_entry', code_context=['        return await self._async_setup_platform(async_create_setup_awaitable)\n'], index=0, positions=Positions(lineno=418, end_lineno=418, col_offset=15, end_col_offset=77)), FrameInfo(frame=<frame at 0x7f857fa680, file '/usr/src/homeassistant/homeassistant/helpers/entity_component.py', line 221, code async_setup_entry>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_component.py', lineno=221, function='async_setup_entry', code_context=['        return await self._platforms[key].async_setup_entry(config_entry)\n'], index=0, positions=Positions(lineno=221, end_lineno=221, col_offset=15, end_col_offset=73)), FrameInfo(frame=<frame at 0x7f85ac6d40, file '/usr/src/homeassistant/homeassistant/components/sensor/__init__.py', line 100, code async_setup_entry>, filename='/usr/src/homeassistant/homeassistant/components/sensor/__init__.py', lineno=100, function='async_setup_entry', code_context=['    return await hass.data[DATA_COMPONENT].async_setup_entry(entry)\n'], index=0, positions=Positions(lineno=100, end_lineno=100, col_offset=11, end_col_offset=67)), FrameInfo(frame=<frame at 0x7f85914c40, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 761, code __async_setup_with_context>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=761, function='__async_setup_with_context', code_context=['                result = await component.async_setup_entry(hass, self)\n'], index=0, positions=Positions(lineno=761, end_lineno=761, col_offset=25, end_col_offset=70)), FrameInfo(frame=<frame at 0x7f859da5e0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 672, code async_setup>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=672, function='async_setup', code_context=['            await self.__async_setup_with_context(hass, integration)\n'], index=0, positions=Positions(lineno=672, end_lineno=672, col_offset=12, end_col_offset=68)), FrameInfo(frame=<frame at 0x7f85ab7040, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 2654, code _async_forward_entry_setup>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=2654, function='_async_forward_entry_setup', code_context=['        await entry.async_setup(self.hass, integration=integration)\n'], index=0, positions=Positions(lineno=2654, end_lineno=2654, col_offset=8, end_col_offset=67)), FrameInfo(frame=<frame at 0x7f859794e0, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f857fae60, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 2615, code <genexpr>>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=2615, function='<genexpr>', code_context=['                create_eager_task(\n'], index=0, positions=Positions(lineno=2615, end_lineno=2622, col_offset=16, end_col_offset=17)), FrameInfo(frame=<frame at 0x7f8593b030, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 2613, code _async_forward_entry_setups_locked>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=2613, function='_async_forward_entry_setups_locked', code_context=['        await asyncio.gather(\n'], index=0, positions=Positions(lineno=2613, end_lineno=2625, col_offset=14, end_col_offset=9)), FrameInfo(frame=<frame at 0x7f85ad6fc0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 2602, code async_forward_entry_setups>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=2602, function='async_forward_entry_setups', code_context=['            await self._async_forward_entry_setups_locked(entry, platforms)\n'], index=0, positions=Positions(lineno=2602, end_lineno=2602, col_offset=12, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f857f4860, file '/config/custom_components/dynamic_ocpp_evse/__init__.py', line 69, code async_setup_entry>, filename='/config/custom_components/dynamic_ocpp_evse/__init__.py', lineno=69, function='async_setup_entry', code_context=['    await hass.config_entries.async_forward_entry_setups(entry, ["sensor", "select", "button", "number", "switch"])\n'], index=0, positions=Positions(lineno=69, end_lineno=69, col_offset=4, end_col_offset=115)), FrameInfo(frame=<frame at 0x7f85914dc0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 761, code __async_setup_with_context>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=761, function='__async_setup_with_context', code_context=['                result = await component.async_setup_entry(hass, self)\n'], index=0, positions=Positions(lineno=761, end_lineno=761, col_offset=25, end_col_offset=70)), FrameInfo(frame=<frame at 0x7f859da7a0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 672, code async_setup>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=672, function='async_setup', code_context=['            await self.__async_setup_with_context(hass, integration)\n'], index=0, positions=Positions(lineno=672, end_lineno=672, col_offset=12, end_col_offset=68)), FrameInfo(frame=<frame at 0x7f859795d0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 906, code async_setup_locked>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=906, function='async_setup_locked', code_context=['            await self.async_setup(hass, integration=integration)\n'], index=0, positions=Positions(lineno=906, end_lineno=906, col_offset=12, end_col_offset=65)), FrameInfo(frame=<frame at 0x7f85ab6e40, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f85aae510, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:09:49.903 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: sensor.solaredge_i2_m1_ac_current_b: [FrameInfo(frame=<frame at 0x7f85ad8f20, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f859dac00, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 368, code get_phase_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=368, function='get_phase_current', code_context=['        value = get_sensor_data(self, entity_id)\n'], index=0, positions=Positions(lineno=368, end_lineno=368, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85eb5470, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 381, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=381, function='get_state_config', code_context=['    state[CONF_PHASE_A_CURRENT] = get_phase_current(self.config_entry.data.get(CONF_PHASE_A_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=381, end_lineno=381, col_offset=34, end_col_offset=111)), FrameInfo(frame=<frame at 0x7f85baadd0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f85ad7240, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f85ada460, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 26, code async_update_data>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=26, function='async_update_data', code_context=['        await temp_sensor.async_update()\n'], index=0, positions=Positions(lineno=26, end_lineno=26, col_offset=8, end_col_offset=40)), FrameInfo(frame=<frame at 0x7f85ac6c80, file '/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', line 308, code _async_update_data>, filename='/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', lineno=308, function='_async_update_data', code_context=['        return await self.update_method()\n'], index=0, positions=Positions(lineno=308, end_lineno=308, col_offset=15, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f85aae3e0, file '/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', line 419, code _async_refresh>, filename='/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', lineno=419, function='_async_refresh', code_context=['            self.data = await self._async_update_data()\n'], index=0, positions=Positions(lineno=419, end_lineno=419, col_offset=24, end_col_offset=55)), FrameInfo(frame=<frame at 0x7f859d9e00, file '/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', line 343, code _async_config_entry_first_refresh>, filename='/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', lineno=343, function='_async_config_entry_first_refresh', code_context=['            await self._async_refresh(\n'], index=0, positions=Positions(lineno=343, end_lineno=347, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f859da340, file '/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', line 318, code async_config_entry_first_refresh>, filename='/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', lineno=318, function='async_config_entry_first_refresh', code_context=['            await self._async_config_entry_first_refresh()\n'], index=0, positions=Positions(lineno=318, end_lineno=318, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f85ad51c0, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 49, code async_setup_entry>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=49, function='async_setup_entry', code_context=['    await coordinator.async_config_entry_first_refresh()\n'], index=0, positions=Positions(lineno=49, end_lineno=49, col_offset=4, end_col_offset=56)), FrameInfo(frame=<frame at 0x7f859793f0, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f85afeda0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 448, code _async_setup_platform>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=448, function='_async_setup_platform', code_context=['                awaitable = create_eager_task(awaitable, loop=hass.loop)\n'], index=0, positions=Positions(lineno=448, end_lineno=448, col_offset=28, end_col_offset=72)), FrameInfo(frame=<frame at 0x7f859da0a0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 418, code async_setup_entry>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=418, function='async_setup_entry', code_context=['        return await self._async_setup_platform(async_create_setup_awaitable)\n'], index=0, positions=Positions(lineno=418, end_lineno=418, col_offset=15, end_col_offset=77)), FrameInfo(frame=<frame at 0x7f857fa680, file '/usr/src/homeassistant/homeassistant/helpers/entity_component.py', line 221, code async_setup_entry>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_component.py', lineno=221, function='async_setup_entry', code_context=['        return await self._platforms[key].async_setup_entry(config_entry)\n'], index=0, positions=Positions(lineno=221, end_lineno=221, col_offset=15, end_col_offset=73)), FrameInfo(frame=<frame at 0x7f85ac6d40, file '/usr/src/homeassistant/homeassistant/components/sensor/__init__.py', line 100, code async_setup_entry>, filename='/usr/src/homeassistant/homeassistant/components/sensor/__init__.py', lineno=100, function='async_setup_entry', code_context=['    return await hass.data[DATA_COMPONENT].async_setup_entry(entry)\n'], index=0, positions=Positions(lineno=100, end_lineno=100, col_offset=11, end_col_offset=67)), FrameInfo(frame=<frame at 0x7f85914c40, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 761, code __async_setup_with_context>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=761, function='__async_setup_with_context', code_context=['                result = await component.async_setup_entry(hass, self)\n'], index=0, positions=Positions(lineno=761, end_lineno=761, col_offset=25, end_col_offset=70)), FrameInfo(frame=<frame at 0x7f859da5e0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 672, code async_setup>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=672, function='async_setup', code_context=['            await self.__async_setup_with_context(hass, integration)\n'], index=0, positions=Positions(lineno=672, end_lineno=672, col_offset=12, end_col_offset=68)), FrameInfo(frame=<frame at 0x7f85ab7040, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 2654, code _async_forward_entry_setup>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=2654, function='_async_forward_entry_setup', code_context=['        await entry.async_setup(self.hass, integration=integration)\n'], index=0, positions=Positions(lineno=2654, end_lineno=2654, col_offset=8, end_col_offset=67)), FrameInfo(frame=<frame at 0x7f859794e0, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f857fae60, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 2615, code <genexpr>>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=2615, function='<genexpr>', code_context=['                create_eager_task(\n'], index=0, positions=Positions(lineno=2615, end_lineno=2622, col_offset=16, end_col_offset=17)), FrameInfo(frame=<frame at 0x7f8593b030, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 2613, code _async_forward_entry_setups_locked>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=2613, function='_async_forward_entry_setups_locked', code_context=['        await asyncio.gather(\n'], index=0, positions=Positions(lineno=2613, end_lineno=2625, col_offset=14, end_col_offset=9)), FrameInfo(frame=<frame at 0x7f85ad6fc0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 2602, code async_forward_entry_setups>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=2602, function='async_forward_entry_setups', code_context=['            await self._async_forward_entry_setups_locked(entry, platforms)\n'], index=0, positions=Positions(lineno=2602, end_lineno=2602, col_offset=12, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f857f4860, file '/config/custom_components/dynamic_ocpp_evse/__init__.py', line 69, code async_setup_entry>, filename='/config/custom_components/dynamic_ocpp_evse/__init__.py', lineno=69, function='async_setup_entry', code_context=['    await hass.config_entries.async_forward_entry_setups(entry, ["sensor", "select", "button", "number", "switch"])\n'], index=0, positions=Positions(lineno=69, end_lineno=69, col_offset=4, end_col_offset=115)), FrameInfo(frame=<frame at 0x7f85914dc0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 761, code __async_setup_with_context>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=761, function='__async_setup_with_context', code_context=['                result = await component.async_setup_entry(hass, self)\n'], index=0, positions=Positions(lineno=761, end_lineno=761, col_offset=25, end_col_offset=70)), FrameInfo(frame=<frame at 0x7f859da7a0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 672, code async_setup>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=672, function='async_setup', code_context=['            await self.__async_setup_with_context(hass, integration)\n'], index=0, positions=Positions(lineno=672, end_lineno=672, col_offset=12, end_col_offset=68)), FrameInfo(frame=<frame at 0x7f859795d0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 906, code async_setup_locked>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=906, function='async_setup_locked', code_context=['            await self.async_setup(hass, integration=integration)\n'], index=0, positions=Positions(lineno=906, end_lineno=906, col_offset=12, end_col_offset=65)), FrameInfo(frame=<frame at 0x7f85ab6e40, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f85aae510, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:09:49.933 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: sensor.solaredge_i2_m1_ac_current_a: [FrameInfo(frame=<frame at 0x7f85ad8f20, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f859dac00, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 368, code get_phase_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=368, function='get_phase_current', code_context=['        value = get_sensor_data(self, entity_id)\n'], index=0, positions=Positions(lineno=368, end_lineno=368, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85eb5470, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 386, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=386, function='get_state_config', code_context=['        state[CONF_PHASE_B_CURRENT] = get_phase_current(phase_b_entity)\n'], index=0, positions=Positions(lineno=386, end_lineno=386, col_offset=38, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f85baadd0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f85ad7240, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f85ada460, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 26, code async_update_data>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=26, function='async_update_data', code_context=['        await temp_sensor.async_update()\n'], index=0, positions=Positions(lineno=26, end_lineno=26, col_offset=8, end_col_offset=40)), FrameInfo(frame=<frame at 0x7f85ac6c80, file '/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', line 308, code _async_update_data>, filename='/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', lineno=308, function='_async_update_data', code_context=['        return await self.update_method()\n'], index=0, positions=Positions(lineno=308, end_lineno=308, col_offset=15, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f85aae3e0, file '/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', line 419, code _async_refresh>, filename='/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', lineno=419, function='_async_refresh', code_context=['            self.data = await self._async_update_data()\n'], index=0, positions=Positions(lineno=419, end_lineno=419, col_offset=24, end_col_offset=55)), FrameInfo(frame=<frame at 0x7f859d9e00, file '/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', line 343, code _async_config_entry_first_refresh>, filename='/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', lineno=343, function='_async_config_entry_first_refresh', code_context=['            await self._async_refresh(\n'], index=0, positions=Positions(lineno=343, end_lineno=347, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f859da340, file '/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', line 318, code async_config_entry_first_refresh>, filename='/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', lineno=318, function='async_config_entry_first_refresh', code_context=['            await self._async_config_entry_first_refresh()\n'], index=0, positions=Positions(lineno=318, end_lineno=318, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f85ad51c0, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 49, code async_setup_entry>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=49, function='async_setup_entry', code_context=['    await coordinator.async_config_entry_first_refresh()\n'], index=0, positions=Positions(lineno=49, end_lineno=49, col_offset=4, end_col_offset=56)), FrameInfo(frame=<frame at 0x7f859793f0, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f85afeda0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 448, code _async_setup_platform>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=448, function='_async_setup_platform', code_context=['                awaitable = create_eager_task(awaitable, loop=hass.loop)\n'], index=0, positions=Positions(lineno=448, end_lineno=448, col_offset=28, end_col_offset=72)), FrameInfo(frame=<frame at 0x7f859da0a0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 418, code async_setup_entry>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=418, function='async_setup_entry', code_context=['        return await self._async_setup_platform(async_create_setup_awaitable)\n'], index=0, positions=Positions(lineno=418, end_lineno=418, col_offset=15, end_col_offset=77)), FrameInfo(frame=<frame at 0x7f857fa680, file '/usr/src/homeassistant/homeassistant/helpers/entity_component.py', line 221, code async_setup_entry>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_component.py', lineno=221, function='async_setup_entry', code_context=['        return await self._platforms[key].async_setup_entry(config_entry)\n'], index=0, positions=Positions(lineno=221, end_lineno=221, col_offset=15, end_col_offset=73)), FrameInfo(frame=<frame at 0x7f85ac6d40, file '/usr/src/homeassistant/homeassistant/components/sensor/__init__.py', line 100, code async_setup_entry>, filename='/usr/src/homeassistant/homeassistant/components/sensor/__init__.py', lineno=100, function='async_setup_entry', code_context=['    return await hass.data[DATA_COMPONENT].async_setup_entry(entry)\n'], index=0, positions=Positions(lineno=100, end_lineno=100, col_offset=11, end_col_offset=67)), FrameInfo(frame=<frame at 0x7f85914c40, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 761, code __async_setup_with_context>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=761, function='__async_setup_with_context', code_context=['                result = await component.async_setup_entry(hass, self)\n'], index=0, positions=Positions(lineno=761, end_lineno=761, col_offset=25, end_col_offset=70)), FrameInfo(frame=<frame at 0x7f859da5e0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 672, code async_setup>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=672, function='async_setup', code_context=['            await self.__async_setup_with_context(hass, integration)\n'], index=0, positions=Positions(lineno=672, end_lineno=672, col_offset=12, end_col_offset=68)), FrameInfo(frame=<frame at 0x7f85ab7040, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 2654, code _async_forward_entry_setup>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=2654, function='_async_forward_entry_setup', code_context=['        await entry.async_setup(self.hass, integration=integration)\n'], index=0, positions=Positions(lineno=2654, end_lineno=2654, col_offset=8, end_col_offset=67)), FrameInfo(frame=<frame at 0x7f859794e0, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f857fae60, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 2615, code <genexpr>>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=2615, function='<genexpr>', code_context=['                create_eager_task(\n'], index=0, positions=Positions(lineno=2615, end_lineno=2622, col_offset=16, end_col_offset=17)), FrameInfo(frame=<frame at 0x7f8593b030, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 2613, code _async_forward_entry_setups_locked>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=2613, function='_async_forward_entry_setups_locked', code_context=['        await asyncio.gather(\n'], index=0, positions=Positions(lineno=2613, end_lineno=2625, col_offset=14, end_col_offset=9)), FrameInfo(frame=<frame at 0x7f85ad6fc0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 2602, code async_forward_entry_setups>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=2602, function='async_forward_entry_setups', code_context=['            await self._async_forward_entry_setups_locked(entry, platforms)\n'], index=0, positions=Positions(lineno=2602, end_lineno=2602, col_offset=12, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f857f4860, file '/config/custom_components/dynamic_ocpp_evse/__init__.py', line 69, code async_setup_entry>, filename='/config/custom_components/dynamic_ocpp_evse/__init__.py', lineno=69, function='async_setup_entry', code_context=['    await hass.config_entries.async_forward_entry_setups(entry, ["sensor", "select", "button", "number", "switch"])\n'], index=0, positions=Positions(lineno=69, end_lineno=69, col_offset=4, end_col_offset=115)), FrameInfo(frame=<frame at 0x7f85914dc0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 761, code __async_setup_with_context>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=761, function='__async_setup_with_context', code_context=['                result = await component.async_setup_entry(hass, self)\n'], index=0, positions=Positions(lineno=761, end_lineno=761, col_offset=25, end_col_offset=70)), FrameInfo(frame=<frame at 0x7f859da7a0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 672, code async_setup>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=672, function='async_setup', code_context=['            await self.__async_setup_with_context(hass, integration)\n'], index=0, positions=Positions(lineno=672, end_lineno=672, col_offset=12, end_col_offset=68)), FrameInfo(frame=<frame at 0x7f859795d0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 906, code async_setup_locked>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=906, function='async_setup_locked', code_context=['            await self.async_setup(hass, integration=integration)\n'], index=0, positions=Positions(lineno=906, end_lineno=906, col_offset=12, end_col_offset=65)), FrameInfo(frame=<frame at 0x7f85ab6e40, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f85aae510, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:09:49.963 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: sensor.solaredge_i2_m1_ac_current_c: [FrameInfo(frame=<frame at 0x7f85ad8f20, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f859dac00, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 368, code get_phase_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=368, function='get_phase_current', code_context=['        value = get_sensor_data(self, entity_id)\n'], index=0, positions=Positions(lineno=368, end_lineno=368, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85eb5470, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 392, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=392, function='get_state_config', code_context=['        state[CONF_PHASE_C_CURRENT] = get_phase_current(phase_c_entity)\n'], index=0, positions=Positions(lineno=392, end_lineno=392, col_offset=38, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f85baadd0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f85ad7240, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f85ada460, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 26, code async_update_data>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=26, function='async_update_data', code_context=['        await temp_sensor.async_update()\n'], index=0, positions=Positions(lineno=26, end_lineno=26, col_offset=8, end_col_offset=40)), FrameInfo(frame=<frame at 0x7f85ac6c80, file '/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', line 308, code _async_update_data>, filename='/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', lineno=308, function='_async_update_data', code_context=['        return await self.update_method()\n'], index=0, positions=Positions(lineno=308, end_lineno=308, col_offset=15, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f85aae3e0, file '/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', line 419, code _async_refresh>, filename='/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', lineno=419, function='_async_refresh', code_context=['            self.data = await self._async_update_data()\n'], index=0, positions=Positions(lineno=419, end_lineno=419, col_offset=24, end_col_offset=55)), FrameInfo(frame=<frame at 0x7f859d9e00, file '/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', line 343, code _async_config_entry_first_refresh>, filename='/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', lineno=343, function='_async_config_entry_first_refresh', code_context=['            await self._async_refresh(\n'], index=0, positions=Positions(lineno=343, end_lineno=347, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f859da340, file '/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', line 318, code async_config_entry_first_refresh>, filename='/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', lineno=318, function='async_config_entry_first_refresh', code_context=['            await self._async_config_entry_first_refresh()\n'], index=0, positions=Positions(lineno=318, end_lineno=318, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f85ad51c0, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 49, code async_setup_entry>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=49, function='async_setup_entry', code_context=['    await coordinator.async_config_entry_first_refresh()\n'], index=0, positions=Positions(lineno=49, end_lineno=49, col_offset=4, end_col_offset=56)), FrameInfo(frame=<frame at 0x7f859793f0, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f85afeda0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 448, code _async_setup_platform>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=448, function='_async_setup_platform', code_context=['                awaitable = create_eager_task(awaitable, loop=hass.loop)\n'], index=0, positions=Positions(lineno=448, end_lineno=448, col_offset=28, end_col_offset=72)), FrameInfo(frame=<frame at 0x7f859da0a0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 418, code async_setup_entry>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=418, function='async_setup_entry', code_context=['        return await self._async_setup_platform(async_create_setup_awaitable)\n'], index=0, positions=Positions(lineno=418, end_lineno=418, col_offset=15, end_col_offset=77)), FrameInfo(frame=<frame at 0x7f857fa680, file '/usr/src/homeassistant/homeassistant/helpers/entity_component.py', line 221, code async_setup_entry>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_component.py', lineno=221, function='async_setup_entry', code_context=['        return await self._platforms[key].async_setup_entry(config_entry)\n'], index=0, positions=Positions(lineno=221, end_lineno=221, col_offset=15, end_col_offset=73)), FrameInfo(frame=<frame at 0x7f85ac6d40, file '/usr/src/homeassistant/homeassistant/components/sensor/__init__.py', line 100, code async_setup_entry>, filename='/usr/src/homeassistant/homeassistant/components/sensor/__init__.py', lineno=100, function='async_setup_entry', code_context=['    return await hass.data[DATA_COMPONENT].async_setup_entry(entry)\n'], index=0, positions=Positions(lineno=100, end_lineno=100, col_offset=11, end_col_offset=67)), FrameInfo(frame=<frame at 0x7f85914c40, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 761, code __async_setup_with_context>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=761, function='__async_setup_with_context', code_context=['                result = await component.async_setup_entry(hass, self)\n'], index=0, positions=Positions(lineno=761, end_lineno=761, col_offset=25, end_col_offset=70)), FrameInfo(frame=<frame at 0x7f859da5e0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 672, code async_setup>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=672, function='async_setup', code_context=['            await self.__async_setup_with_context(hass, integration)\n'], index=0, positions=Positions(lineno=672, end_lineno=672, col_offset=12, end_col_offset=68)), FrameInfo(frame=<frame at 0x7f85ab7040, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 2654, code _async_forward_entry_setup>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=2654, function='_async_forward_entry_setup', code_context=['        await entry.async_setup(self.hass, integration=integration)\n'], index=0, positions=Positions(lineno=2654, end_lineno=2654, col_offset=8, end_col_offset=67)), FrameInfo(frame=<frame at 0x7f859794e0, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f857fae60, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 2615, code <genexpr>>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=2615, function='<genexpr>', code_context=['                create_eager_task(\n'], index=0, positions=Positions(lineno=2615, end_lineno=2622, col_offset=16, end_col_offset=17)), FrameInfo(frame=<frame at 0x7f8593b030, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 2613, code _async_forward_entry_setups_locked>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=2613, function='_async_forward_entry_setups_locked', code_context=['        await asyncio.gather(\n'], index=0, positions=Positions(lineno=2613, end_lineno=2625, col_offset=14, end_col_offset=9)), FrameInfo(frame=<frame at 0x7f85ad6fc0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 2602, code async_forward_entry_setups>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=2602, function='async_forward_entry_setups', code_context=['            await self._async_forward_entry_setups_locked(entry, platforms)\n'], index=0, positions=Positions(lineno=2602, end_lineno=2602, col_offset=12, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f857f4860, file '/config/custom_components/dynamic_ocpp_evse/__init__.py', line 69, code async_setup_entry>, filename='/config/custom_components/dynamic_ocpp_evse/__init__.py', lineno=69, function='async_setup_entry', code_context=['    await hass.config_entries.async_forward_entry_setups(entry, ["sensor", "select", "button", "number", "switch"])\n'], index=0, positions=Positions(lineno=69, end_lineno=69, col_offset=4, end_col_offset=115)), FrameInfo(frame=<frame at 0x7f85914dc0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 761, code __async_setup_with_context>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=761, function='__async_setup_with_context', code_context=['                result = await component.async_setup_entry(hass, self)\n'], index=0, positions=Positions(lineno=761, end_lineno=761, col_offset=25, end_col_offset=70)), FrameInfo(frame=<frame at 0x7f859da7a0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 672, code async_setup>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=672, function='async_setup', code_context=['            await self.__async_setup_with_context(hass, integration)\n'], index=0, positions=Positions(lineno=672, end_lineno=672, col_offset=12, end_col_offset=68)), FrameInfo(frame=<frame at 0x7f859795d0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 906, code async_setup_locked>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=906, function='async_setup_locked', code_context=['            await self.async_setup(hass, integration=integration)\n'], index=0, positions=Positions(lineno=906, end_lineno=906, col_offset=12, end_col_offset=65)), FrameInfo(frame=<frame at 0x7f85ab6e40, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f85aae510, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:09:49.993 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: sensor.charger_current_import: [FrameInfo(frame=<frame at 0x7f85ad8f20, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f85eb5470, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 396, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=396, function='get_state_config', code_context=['    state[CONF_EVSE_CURRENT_IMPORT] = get_sensor_data(self, self.config_entry.data.get(CONF_EVSE_CURRENT_IMPORT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=396, end_lineno=396, col_offset=38, end_col_offset=123)), FrameInfo(frame=<frame at 0x7f85baadd0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f85ad7240, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f85ada460, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 26, code async_update_data>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=26, function='async_update_data', code_context=['        await temp_sensor.async_update()\n'], index=0, positions=Positions(lineno=26, end_lineno=26, col_offset=8, end_col_offset=40)), FrameInfo(frame=<frame at 0x7f85ac6c80, file '/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', line 308, code _async_update_data>, filename='/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', lineno=308, function='_async_update_data', code_context=['        return await self.update_method()\n'], index=0, positions=Positions(lineno=308, end_lineno=308, col_offset=15, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f85aae3e0, file '/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', line 419, code _async_refresh>, filename='/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', lineno=419, function='_async_refresh', code_context=['            self.data = await self._async_update_data()\n'], index=0, positions=Positions(lineno=419, end_lineno=419, col_offset=24, end_col_offset=55)), FrameInfo(frame=<frame at 0x7f859d9e00, file '/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', line 343, code _async_config_entry_first_refresh>, filename='/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', lineno=343, function='_async_config_entry_first_refresh', code_context=['            await self._async_refresh(\n'], index=0, positions=Positions(lineno=343, end_lineno=347, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f859da340, file '/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', line 318, code async_config_entry_first_refresh>, filename='/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', lineno=318, function='async_config_entry_first_refresh', code_context=['            await self._async_config_entry_first_refresh()\n'], index=0, positions=Positions(lineno=318, end_lineno=318, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f85ad51c0, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 49, code async_setup_entry>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=49, function='async_setup_entry', code_context=['    await coordinator.async_config_entry_first_refresh()\n'], index=0, positions=Positions(lineno=49, end_lineno=49, col_offset=4, end_col_offset=56)), FrameInfo(frame=<frame at 0x7f859793f0, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f85afeda0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 448, code _async_setup_platform>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=448, function='_async_setup_platform', code_context=['                awaitable = create_eager_task(awaitable, loop=hass.loop)\n'], index=0, positions=Positions(lineno=448, end_lineno=448, col_offset=28, end_col_offset=72)), FrameInfo(frame=<frame at 0x7f859da0a0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 418, code async_setup_entry>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=418, function='async_setup_entry', code_context=['        return await self._async_setup_platform(async_create_setup_awaitable)\n'], index=0, positions=Positions(lineno=418, end_lineno=418, col_offset=15, end_col_offset=77)), FrameInfo(frame=<frame at 0x7f857fa680, file '/usr/src/homeassistant/homeassistant/helpers/entity_component.py', line 221, code async_setup_entry>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_component.py', lineno=221, function='async_setup_entry', code_context=['        return await self._platforms[key].async_setup_entry(config_entry)\n'], index=0, positions=Positions(lineno=221, end_lineno=221, col_offset=15, end_col_offset=73)), FrameInfo(frame=<frame at 0x7f85ac6d40, file '/usr/src/homeassistant/homeassistant/components/sensor/__init__.py', line 100, code async_setup_entry>, filename='/usr/src/homeassistant/homeassistant/components/sensor/__init__.py', lineno=100, function='async_setup_entry', code_context=['    return await hass.data[DATA_COMPONENT].async_setup_entry(entry)\n'], index=0, positions=Positions(lineno=100, end_lineno=100, col_offset=11, end_col_offset=67)), FrameInfo(frame=<frame at 0x7f85914c40, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 761, code __async_setup_with_context>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=761, function='__async_setup_with_context', code_context=['                result = await component.async_setup_entry(hass, self)\n'], index=0, positions=Positions(lineno=761, end_lineno=761, col_offset=25, end_col_offset=70)), FrameInfo(frame=<frame at 0x7f859da5e0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 672, code async_setup>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=672, function='async_setup', code_context=['            await self.__async_setup_with_context(hass, integration)\n'], index=0, positions=Positions(lineno=672, end_lineno=672, col_offset=12, end_col_offset=68)), FrameInfo(frame=<frame at 0x7f85ab7040, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 2654, code _async_forward_entry_setup>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=2654, function='_async_forward_entry_setup', code_context=['        await entry.async_setup(self.hass, integration=integration)\n'], index=0, positions=Positions(lineno=2654, end_lineno=2654, col_offset=8, end_col_offset=67)), FrameInfo(frame=<frame at 0x7f859794e0, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f857fae60, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 2615, code <genexpr>>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=2615, function='<genexpr>', code_context=['                create_eager_task(\n'], index=0, positions=Positions(lineno=2615, end_lineno=2622, col_offset=16, end_col_offset=17)), FrameInfo(frame=<frame at 0x7f8593b030, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 2613, code _async_forward_entry_setups_locked>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=2613, function='_async_forward_entry_setups_locked', code_context=['        await asyncio.gather(\n'], index=0, positions=Positions(lineno=2613, end_lineno=2625, col_offset=14, end_col_offset=9)), FrameInfo(frame=<frame at 0x7f85ad6fc0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 2602, code async_forward_entry_setups>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=2602, function='async_forward_entry_setups', code_context=['            await self._async_forward_entry_setups_locked(entry, platforms)\n'], index=0, positions=Positions(lineno=2602, end_lineno=2602, col_offset=12, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f857f4860, file '/config/custom_components/dynamic_ocpp_evse/__init__.py', line 69, code async_setup_entry>, filename='/config/custom_components/dynamic_ocpp_evse/__init__.py', lineno=69, function='async_setup_entry', code_context=['    await hass.config_entries.async_forward_entry_setups(entry, ["sensor", "select", "button", "number", "switch"])\n'], index=0, positions=Positions(lineno=69, end_lineno=69, col_offset=4, end_col_offset=115)), FrameInfo(frame=<frame at 0x7f85914dc0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 761, code __async_setup_with_context>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=761, function='__async_setup_with_context', code_context=['                result = await component.async_setup_entry(hass, self)\n'], index=0, positions=Positions(lineno=761, end_lineno=761, col_offset=25, end_col_offset=70)), FrameInfo(frame=<frame at 0x7f859da7a0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 672, code async_setup>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=672, function='async_setup', code_context=['            await self.__async_setup_with_context(hass, integration)\n'], index=0, positions=Positions(lineno=672, end_lineno=672, col_offset=12, end_col_offset=68)), FrameInfo(frame=<frame at 0x7f859795d0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 906, code async_setup_locked>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=906, function='async_setup_locked', code_context=['            await self.async_setup(hass, integration=integration)\n'], index=0, positions=Positions(lineno=906, end_lineno=906, col_offset=12, end_col_offset=65)), FrameInfo(frame=<frame at 0x7f85ab6e40, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f85aae510, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:09:50.023 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: sensor.charger_current_offered: [FrameInfo(frame=<frame at 0x7f85ad8f20, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f85eb5470, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 397, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=397, function='get_state_config', code_context=['    state[CONF_EVSE_CURRENT_OFFERED] = get_sensor_data(self, self.config_entry.data.get(CONF_EVSE_CURRENT_OFFERED_ENTITY_ID))\n'], index=0, positions=Positions(lineno=397, end_lineno=397, col_offset=39, end_col_offset=125)), FrameInfo(frame=<frame at 0x7f85baadd0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f85ad7240, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f85ada460, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 26, code async_update_data>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=26, function='async_update_data', code_context=['        await temp_sensor.async_update()\n'], index=0, positions=Positions(lineno=26, end_lineno=26, col_offset=8, end_col_offset=40)), FrameInfo(frame=<frame at 0x7f85ac6c80, file '/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', line 308, code _async_update_data>, filename='/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', lineno=308, function='_async_update_data', code_context=['        return await self.update_method()\n'], index=0, positions=Positions(lineno=308, end_lineno=308, col_offset=15, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f85aae3e0, file '/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', line 419, code _async_refresh>, filename='/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', lineno=419, function='_async_refresh', code_context=['            self.data = await self._async_update_data()\n'], index=0, positions=Positions(lineno=419, end_lineno=419, col_offset=24, end_col_offset=55)), FrameInfo(frame=<frame at 0x7f859d9e00, file '/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', line 343, code _async_config_entry_first_refresh>, filename='/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', lineno=343, function='_async_config_entry_first_refresh', code_context=['            await self._async_refresh(\n'], index=0, positions=Positions(lineno=343, end_lineno=347, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f859da340, file '/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', line 318, code async_config_entry_first_refresh>, filename='/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', lineno=318, function='async_config_entry_first_refresh', code_context=['            await self._async_config_entry_first_refresh()\n'], index=0, positions=Positions(lineno=318, end_lineno=318, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f85ad51c0, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 49, code async_setup_entry>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=49, function='async_setup_entry', code_context=['    await coordinator.async_config_entry_first_refresh()\n'], index=0, positions=Positions(lineno=49, end_lineno=49, col_offset=4, end_col_offset=56)), FrameInfo(frame=<frame at 0x7f859793f0, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f85afeda0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 448, code _async_setup_platform>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=448, function='_async_setup_platform', code_context=['                awaitable = create_eager_task(awaitable, loop=hass.loop)\n'], index=0, positions=Positions(lineno=448, end_lineno=448, col_offset=28, end_col_offset=72)), FrameInfo(frame=<frame at 0x7f859da0a0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 418, code async_setup_entry>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=418, function='async_setup_entry', code_context=['        return await self._async_setup_platform(async_create_setup_awaitable)\n'], index=0, positions=Positions(lineno=418, end_lineno=418, col_offset=15, end_col_offset=77)), FrameInfo(frame=<frame at 0x7f857fa680, file '/usr/src/homeassistant/homeassistant/helpers/entity_component.py', line 221, code async_setup_entry>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_component.py', lineno=221, function='async_setup_entry', code_context=['        return await self._platforms[key].async_setup_entry(config_entry)\n'], index=0, positions=Positions(lineno=221, end_lineno=221, col_offset=15, end_col_offset=73)), FrameInfo(frame=<frame at 0x7f85ac6d40, file '/usr/src/homeassistant/homeassistant/components/sensor/__init__.py', line 100, code async_setup_entry>, filename='/usr/src/homeassistant/homeassistant/components/sensor/__init__.py', lineno=100, function='async_setup_entry', code_context=['    return await hass.data[DATA_COMPONENT].async_setup_entry(entry)\n'], index=0, positions=Positions(lineno=100, end_lineno=100, col_offset=11, end_col_offset=67)), FrameInfo(frame=<frame at 0x7f85914c40, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 761, code __async_setup_with_context>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=761, function='__async_setup_with_context', code_context=['                result = await component.async_setup_entry(hass, self)\n'], index=0, positions=Positions(lineno=761, end_lineno=761, col_offset=25, end_col_offset=70)), FrameInfo(frame=<frame at 0x7f859da5e0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 672, code async_setup>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=672, function='async_setup', code_context=['            await self.__async_setup_with_context(hass, integration)\n'], index=0, positions=Positions(lineno=672, end_lineno=672, col_offset=12, end_col_offset=68)), FrameInfo(frame=<frame at 0x7f85ab7040, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 2654, code _async_forward_entry_setup>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=2654, function='_async_forward_entry_setup', code_context=['        await entry.async_setup(self.hass, integration=integration)\n'], index=0, positions=Positions(lineno=2654, end_lineno=2654, col_offset=8, end_col_offset=67)), FrameInfo(frame=<frame at 0x7f859794e0, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f857fae60, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 2615, code <genexpr>>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=2615, function='<genexpr>', code_context=['                create_eager_task(\n'], index=0, positions=Positions(lineno=2615, end_lineno=2622, col_offset=16, end_col_offset=17)), FrameInfo(frame=<frame at 0x7f8593b030, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 2613, code _async_forward_entry_setups_locked>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=2613, function='_async_forward_entry_setups_locked', code_context=['        await asyncio.gather(\n'], index=0, positions=Positions(lineno=2613, end_lineno=2625, col_offset=14, end_col_offset=9)), FrameInfo(frame=<frame at 0x7f85ad6fc0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 2602, code async_forward_entry_setups>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=2602, function='async_forward_entry_setups', code_context=['            await self._async_forward_entry_setups_locked(entry, platforms)\n'], index=0, positions=Positions(lineno=2602, end_lineno=2602, col_offset=12, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f857f4860, file '/config/custom_components/dynamic_ocpp_evse/__init__.py', line 69, code async_setup_entry>, filename='/config/custom_components/dynamic_ocpp_evse/__init__.py', lineno=69, function='async_setup_entry', code_context=['    await hass.config_entries.async_forward_entry_setups(entry, ["sensor", "select", "button", "number", "switch"])\n'], index=0, positions=Positions(lineno=69, end_lineno=69, col_offset=4, end_col_offset=115)), FrameInfo(frame=<frame at 0x7f85914dc0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 761, code __async_setup_with_context>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=761, function='__async_setup_with_context', code_context=['                result = await component.async_setup_entry(hass, self)\n'], index=0, positions=Positions(lineno=761, end_lineno=761, col_offset=25, end_col_offset=70)), FrameInfo(frame=<frame at 0x7f859da7a0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 672, code async_setup>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=672, function='async_setup', code_context=['            await self.__async_setup_with_context(hass, integration)\n'], index=0, positions=Positions(lineno=672, end_lineno=672, col_offset=12, end_col_offset=68)), FrameInfo(frame=<frame at 0x7f859795d0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 906, code async_setup_locked>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=906, function='async_setup_locked', code_context=['            await self.async_setup(hass, integration=integration)\n'], index=0, positions=Positions(lineno=906, end_lineno=906, col_offset=12, end_col_offset=65)), FrameInfo(frame=<frame at 0x7f85ab6e40, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f85aae510, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:09:50.054 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_min_current: [FrameInfo(frame=<frame at 0x7f85ad8f20, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f85eb5470, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 402, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=402, function='get_state_config', code_context=['    state[CONF_MIN_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MIN_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=402, end_lineno=402, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f85baadd0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f85ad7240, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f85ada460, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 26, code async_update_data>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=26, function='async_update_data', code_context=['        await temp_sensor.async_update()\n'], index=0, positions=Positions(lineno=26, end_lineno=26, col_offset=8, end_col_offset=40)), FrameInfo(frame=<frame at 0x7f85ac6c80, file '/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', line 308, code _async_update_data>, filename='/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', lineno=308, function='_async_update_data', code_context=['        return await self.update_method()\n'], index=0, positions=Positions(lineno=308, end_lineno=308, col_offset=15, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f85aae3e0, file '/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', line 419, code _async_refresh>, filename='/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', lineno=419, function='_async_refresh', code_context=['            self.data = await self._async_update_data()\n'], index=0, positions=Positions(lineno=419, end_lineno=419, col_offset=24, end_col_offset=55)), FrameInfo(frame=<frame at 0x7f859d9e00, file '/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', line 343, code _async_config_entry_first_refresh>, filename='/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', lineno=343, function='_async_config_entry_first_refresh', code_context=['            await self._async_refresh(\n'], index=0, positions=Positions(lineno=343, end_lineno=347, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f859da340, file '/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', line 318, code async_config_entry_first_refresh>, filename='/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', lineno=318, function='async_config_entry_first_refresh', code_context=['            await self._async_config_entry_first_refresh()\n'], index=0, positions=Positions(lineno=318, end_lineno=318, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f85ad51c0, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 49, code async_setup_entry>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=49, function='async_setup_entry', code_context=['    await coordinator.async_config_entry_first_refresh()\n'], index=0, positions=Positions(lineno=49, end_lineno=49, col_offset=4, end_col_offset=56)), FrameInfo(frame=<frame at 0x7f859793f0, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f85afeda0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 448, code _async_setup_platform>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=448, function='_async_setup_platform', code_context=['                awaitable = create_eager_task(awaitable, loop=hass.loop)\n'], index=0, positions=Positions(lineno=448, end_lineno=448, col_offset=28, end_col_offset=72)), FrameInfo(frame=<frame at 0x7f859da0a0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 418, code async_setup_entry>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=418, function='async_setup_entry', code_context=['        return await self._async_setup_platform(async_create_setup_awaitable)\n'], index=0, positions=Positions(lineno=418, end_lineno=418, col_offset=15, end_col_offset=77)), FrameInfo(frame=<frame at 0x7f857fa680, file '/usr/src/homeassistant/homeassistant/helpers/entity_component.py', line 221, code async_setup_entry>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_component.py', lineno=221, function='async_setup_entry', code_context=['        return await self._platforms[key].async_setup_entry(config_entry)\n'], index=0, positions=Positions(lineno=221, end_lineno=221, col_offset=15, end_col_offset=73)), FrameInfo(frame=<frame at 0x7f85ac6d40, file '/usr/src/homeassistant/homeassistant/components/sensor/__init__.py', line 100, code async_setup_entry>, filename='/usr/src/homeassistant/homeassistant/components/sensor/__init__.py', lineno=100, function='async_setup_entry', code_context=['    return await hass.data[DATA_COMPONENT].async_setup_entry(entry)\n'], index=0, positions=Positions(lineno=100, end_lineno=100, col_offset=11, end_col_offset=67)), FrameInfo(frame=<frame at 0x7f85914c40, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 761, code __async_setup_with_context>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=761, function='__async_setup_with_context', code_context=['                result = await component.async_setup_entry(hass, self)\n'], index=0, positions=Positions(lineno=761, end_lineno=761, col_offset=25, end_col_offset=70)), FrameInfo(frame=<frame at 0x7f859da5e0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 672, code async_setup>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=672, function='async_setup', code_context=['            await self.__async_setup_with_context(hass, integration)\n'], index=0, positions=Positions(lineno=672, end_lineno=672, col_offset=12, end_col_offset=68)), FrameInfo(frame=<frame at 0x7f85ab7040, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 2654, code _async_forward_entry_setup>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=2654, function='_async_forward_entry_setup', code_context=['        await entry.async_setup(self.hass, integration=integration)\n'], index=0, positions=Positions(lineno=2654, end_lineno=2654, col_offset=8, end_col_offset=67)), FrameInfo(frame=<frame at 0x7f859794e0, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f857fae60, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 2615, code <genexpr>>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=2615, function='<genexpr>', code_context=['                create_eager_task(\n'], index=0, positions=Positions(lineno=2615, end_lineno=2622, col_offset=16, end_col_offset=17)), FrameInfo(frame=<frame at 0x7f8593b030, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 2613, code _async_forward_entry_setups_locked>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=2613, function='_async_forward_entry_setups_locked', code_context=['        await asyncio.gather(\n'], index=0, positions=Positions(lineno=2613, end_lineno=2625, col_offset=14, end_col_offset=9)), FrameInfo(frame=<frame at 0x7f85ad6fc0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 2602, code async_forward_entry_setups>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=2602, function='async_forward_entry_setups', code_context=['            await self._async_forward_entry_setups_locked(entry, platforms)\n'], index=0, positions=Positions(lineno=2602, end_lineno=2602, col_offset=12, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f857f4860, file '/config/custom_components/dynamic_ocpp_evse/__init__.py', line 69, code async_setup_entry>, filename='/config/custom_components/dynamic_ocpp_evse/__init__.py', lineno=69, function='async_setup_entry', code_context=['    await hass.config_entries.async_forward_entry_setups(entry, ["sensor", "select", "button", "number", "switch"])\n'], index=0, positions=Positions(lineno=69, end_lineno=69, col_offset=4, end_col_offset=115)), FrameInfo(frame=<frame at 0x7f85914dc0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 761, code __async_setup_with_context>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=761, function='__async_setup_with_context', code_context=['                result = await component.async_setup_entry(hass, self)\n'], index=0, positions=Positions(lineno=761, end_lineno=761, col_offset=25, end_col_offset=70)), FrameInfo(frame=<frame at 0x7f859da7a0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 672, code async_setup>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=672, function='async_setup', code_context=['            await self.__async_setup_with_context(hass, integration)\n'], index=0, positions=Positions(lineno=672, end_lineno=672, col_offset=12, end_col_offset=68)), FrameInfo(frame=<frame at 0x7f859795d0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 906, code async_setup_locked>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=906, function='async_setup_locked', code_context=['            await self.async_setup(hass, integration=integration)\n'], index=0, positions=Positions(lineno=906, end_lineno=906, col_offset=12, end_col_offset=65)), FrameInfo(frame=<frame at 0x7f85ab6e40, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f85aae510, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:09:50.084 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_max_current: [FrameInfo(frame=<frame at 0x7f85ad8f20, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f85eb5470, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 403, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=403, function='get_state_config', code_context=['    state[CONF_MAX_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MAX_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=403, end_lineno=403, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f85baadd0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f85ad7240, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f85ada460, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 26, code async_update_data>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=26, function='async_update_data', code_context=['        await temp_sensor.async_update()\n'], index=0, positions=Positions(lineno=26, end_lineno=26, col_offset=8, end_col_offset=40)), FrameInfo(frame=<frame at 0x7f85ac6c80, file '/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', line 308, code _async_update_data>, filename='/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', lineno=308, function='_async_update_data', code_context=['        return await self.update_method()\n'], index=0, positions=Positions(lineno=308, end_lineno=308, col_offset=15, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f85aae3e0, file '/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', line 419, code _async_refresh>, filename='/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', lineno=419, function='_async_refresh', code_context=['            self.data = await self._async_update_data()\n'], index=0, positions=Positions(lineno=419, end_lineno=419, col_offset=24, end_col_offset=55)), FrameInfo(frame=<frame at 0x7f859d9e00, file '/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', line 343, code _async_config_entry_first_refresh>, filename='/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', lineno=343, function='_async_config_entry_first_refresh', code_context=['            await self._async_refresh(\n'], index=0, positions=Positions(lineno=343, end_lineno=347, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f859da340, file '/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', line 318, code async_config_entry_first_refresh>, filename='/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', lineno=318, function='async_config_entry_first_refresh', code_context=['            await self._async_config_entry_first_refresh()\n'], index=0, positions=Positions(lineno=318, end_lineno=318, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f85ad51c0, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 49, code async_setup_entry>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=49, function='async_setup_entry', code_context=['    await coordinator.async_config_entry_first_refresh()\n'], index=0, positions=Positions(lineno=49, end_lineno=49, col_offset=4, end_col_offset=56)), FrameInfo(frame=<frame at 0x7f859793f0, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f85afeda0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 448, code _async_setup_platform>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=448, function='_async_setup_platform', code_context=['                awaitable = create_eager_task(awaitable, loop=hass.loop)\n'], index=0, positions=Positions(lineno=448, end_lineno=448, col_offset=28, end_col_offset=72)), FrameInfo(frame=<frame at 0x7f859da0a0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 418, code async_setup_entry>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=418, function='async_setup_entry', code_context=['        return await self._async_setup_platform(async_create_setup_awaitable)\n'], index=0, positions=Positions(lineno=418, end_lineno=418, col_offset=15, end_col_offset=77)), FrameInfo(frame=<frame at 0x7f857fa680, file '/usr/src/homeassistant/homeassistant/helpers/entity_component.py', line 221, code async_setup_entry>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_component.py', lineno=221, function='async_setup_entry', code_context=['        return await self._platforms[key].async_setup_entry(config_entry)\n'], index=0, positions=Positions(lineno=221, end_lineno=221, col_offset=15, end_col_offset=73)), FrameInfo(frame=<frame at 0x7f85ac6d40, file '/usr/src/homeassistant/homeassistant/components/sensor/__init__.py', line 100, code async_setup_entry>, filename='/usr/src/homeassistant/homeassistant/components/sensor/__init__.py', lineno=100, function='async_setup_entry', code_context=['    return await hass.data[DATA_COMPONENT].async_setup_entry(entry)\n'], index=0, positions=Positions(lineno=100, end_lineno=100, col_offset=11, end_col_offset=67)), FrameInfo(frame=<frame at 0x7f85914c40, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 761, code __async_setup_with_context>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=761, function='__async_setup_with_context', code_context=['                result = await component.async_setup_entry(hass, self)\n'], index=0, positions=Positions(lineno=761, end_lineno=761, col_offset=25, end_col_offset=70)), FrameInfo(frame=<frame at 0x7f859da5e0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 672, code async_setup>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=672, function='async_setup', code_context=['            await self.__async_setup_with_context(hass, integration)\n'], index=0, positions=Positions(lineno=672, end_lineno=672, col_offset=12, end_col_offset=68)), FrameInfo(frame=<frame at 0x7f85ab7040, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 2654, code _async_forward_entry_setup>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=2654, function='_async_forward_entry_setup', code_context=['        await entry.async_setup(self.hass, integration=integration)\n'], index=0, positions=Positions(lineno=2654, end_lineno=2654, col_offset=8, end_col_offset=67)), FrameInfo(frame=<frame at 0x7f859794e0, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f857fae60, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 2615, code <genexpr>>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=2615, function='<genexpr>', code_context=['                create_eager_task(\n'], index=0, positions=Positions(lineno=2615, end_lineno=2622, col_offset=16, end_col_offset=17)), FrameInfo(frame=<frame at 0x7f8593b030, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 2613, code _async_forward_entry_setups_locked>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=2613, function='_async_forward_entry_setups_locked', code_context=['        await asyncio.gather(\n'], index=0, positions=Positions(lineno=2613, end_lineno=2625, col_offset=14, end_col_offset=9)), FrameInfo(frame=<frame at 0x7f85ad6fc0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 2602, code async_forward_entry_setups>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=2602, function='async_forward_entry_setups', code_context=['            await self._async_forward_entry_setups_locked(entry, platforms)\n'], index=0, positions=Positions(lineno=2602, end_lineno=2602, col_offset=12, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f857f4860, file '/config/custom_components/dynamic_ocpp_evse/__init__.py', line 69, code async_setup_entry>, filename='/config/custom_components/dynamic_ocpp_evse/__init__.py', lineno=69, function='async_setup_entry', code_context=['    await hass.config_entries.async_forward_entry_setups(entry, ["sensor", "select", "button", "number", "switch"])\n'], index=0, positions=Positions(lineno=69, end_lineno=69, col_offset=4, end_col_offset=115)), FrameInfo(frame=<frame at 0x7f85914dc0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 761, code __async_setup_with_context>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=761, function='__async_setup_with_context', code_context=['                result = await component.async_setup_entry(hass, self)\n'], index=0, positions=Positions(lineno=761, end_lineno=761, col_offset=25, end_col_offset=70)), FrameInfo(frame=<frame at 0x7f859da7a0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 672, code async_setup>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=672, function='async_setup', code_context=['            await self.__async_setup_with_context(hass, integration)\n'], index=0, positions=Positions(lineno=672, end_lineno=672, col_offset=12, end_col_offset=68)), FrameInfo(frame=<frame at 0x7f859795d0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 906, code async_setup_locked>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=906, function='async_setup_locked', code_context=['            await self.async_setup(hass, integration=integration)\n'], index=0, positions=Positions(lineno=906, end_lineno=906, col_offset=12, end_col_offset=65)), FrameInfo(frame=<frame at 0x7f85ab6e40, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f85aae510, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:09:50.114 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_home_battery_soc_target: [FrameInfo(frame=<frame at 0x7f85ad8f20, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f85eb5470, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 421, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=421, function='get_state_config', code_context=['        state["battery_soc_target"] = get_sensor_data(self, battery_soc_target_entity_id)\n'], index=0, positions=Positions(lineno=421, end_lineno=421, col_offset=38, end_col_offset=89)), FrameInfo(frame=<frame at 0x7f85baadd0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f85ad7240, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f85ada460, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 26, code async_update_data>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=26, function='async_update_data', code_context=['        await temp_sensor.async_update()\n'], index=0, positions=Positions(lineno=26, end_lineno=26, col_offset=8, end_col_offset=40)), FrameInfo(frame=<frame at 0x7f85ac6c80, file '/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', line 308, code _async_update_data>, filename='/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', lineno=308, function='_async_update_data', code_context=['        return await self.update_method()\n'], index=0, positions=Positions(lineno=308, end_lineno=308, col_offset=15, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f85aae3e0, file '/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', line 419, code _async_refresh>, filename='/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', lineno=419, function='_async_refresh', code_context=['            self.data = await self._async_update_data()\n'], index=0, positions=Positions(lineno=419, end_lineno=419, col_offset=24, end_col_offset=55)), FrameInfo(frame=<frame at 0x7f859d9e00, file '/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', line 343, code _async_config_entry_first_refresh>, filename='/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', lineno=343, function='_async_config_entry_first_refresh', code_context=['            await self._async_refresh(\n'], index=0, positions=Positions(lineno=343, end_lineno=347, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f859da340, file '/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', line 318, code async_config_entry_first_refresh>, filename='/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', lineno=318, function='async_config_entry_first_refresh', code_context=['            await self._async_config_entry_first_refresh()\n'], index=0, positions=Positions(lineno=318, end_lineno=318, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f85ad51c0, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 49, code async_setup_entry>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=49, function='async_setup_entry', code_context=['    await coordinator.async_config_entry_first_refresh()\n'], index=0, positions=Positions(lineno=49, end_lineno=49, col_offset=4, end_col_offset=56)), FrameInfo(frame=<frame at 0x7f859793f0, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f85afeda0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 448, code _async_setup_platform>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=448, function='_async_setup_platform', code_context=['                awaitable = create_eager_task(awaitable, loop=hass.loop)\n'], index=0, positions=Positions(lineno=448, end_lineno=448, col_offset=28, end_col_offset=72)), FrameInfo(frame=<frame at 0x7f859da0a0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 418, code async_setup_entry>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=418, function='async_setup_entry', code_context=['        return await self._async_setup_platform(async_create_setup_awaitable)\n'], index=0, positions=Positions(lineno=418, end_lineno=418, col_offset=15, end_col_offset=77)), FrameInfo(frame=<frame at 0x7f857fa680, file '/usr/src/homeassistant/homeassistant/helpers/entity_component.py', line 221, code async_setup_entry>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_component.py', lineno=221, function='async_setup_entry', code_context=['        return await self._platforms[key].async_setup_entry(config_entry)\n'], index=0, positions=Positions(lineno=221, end_lineno=221, col_offset=15, end_col_offset=73)), FrameInfo(frame=<frame at 0x7f85ac6d40, file '/usr/src/homeassistant/homeassistant/components/sensor/__init__.py', line 100, code async_setup_entry>, filename='/usr/src/homeassistant/homeassistant/components/sensor/__init__.py', lineno=100, function='async_setup_entry', code_context=['    return await hass.data[DATA_COMPONENT].async_setup_entry(entry)\n'], index=0, positions=Positions(lineno=100, end_lineno=100, col_offset=11, end_col_offset=67)), FrameInfo(frame=<frame at 0x7f85914c40, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 761, code __async_setup_with_context>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=761, function='__async_setup_with_context', code_context=['                result = await component.async_setup_entry(hass, self)\n'], index=0, positions=Positions(lineno=761, end_lineno=761, col_offset=25, end_col_offset=70)), FrameInfo(frame=<frame at 0x7f859da5e0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 672, code async_setup>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=672, function='async_setup', code_context=['            await self.__async_setup_with_context(hass, integration)\n'], index=0, positions=Positions(lineno=672, end_lineno=672, col_offset=12, end_col_offset=68)), FrameInfo(frame=<frame at 0x7f85ab7040, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 2654, code _async_forward_entry_setup>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=2654, function='_async_forward_entry_setup', code_context=['        await entry.async_setup(self.hass, integration=integration)\n'], index=0, positions=Positions(lineno=2654, end_lineno=2654, col_offset=8, end_col_offset=67)), FrameInfo(frame=<frame at 0x7f859794e0, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f857fae60, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 2615, code <genexpr>>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=2615, function='<genexpr>', code_context=['                create_eager_task(\n'], index=0, positions=Positions(lineno=2615, end_lineno=2622, col_offset=16, end_col_offset=17)), FrameInfo(frame=<frame at 0x7f8593b030, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 2613, code _async_forward_entry_setups_locked>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=2613, function='_async_forward_entry_setups_locked', code_context=['        await asyncio.gather(\n'], index=0, positions=Positions(lineno=2613, end_lineno=2625, col_offset=14, end_col_offset=9)), FrameInfo(frame=<frame at 0x7f85ad6fc0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 2602, code async_forward_entry_setups>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=2602, function='async_forward_entry_setups', code_context=['            await self._async_forward_entry_setups_locked(entry, platforms)\n'], index=0, positions=Positions(lineno=2602, end_lineno=2602, col_offset=12, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f857f4860, file '/config/custom_components/dynamic_ocpp_evse/__init__.py', line 69, code async_setup_entry>, filename='/config/custom_components/dynamic_ocpp_evse/__init__.py', lineno=69, function='async_setup_entry', code_context=['    await hass.config_entries.async_forward_entry_setups(entry, ["sensor", "select", "button", "number", "switch"])\n'], index=0, positions=Positions(lineno=69, end_lineno=69, col_offset=4, end_col_offset=115)), FrameInfo(frame=<frame at 0x7f85914dc0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 761, code __async_setup_with_context>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=761, function='__async_setup_with_context', code_context=['                result = await component.async_setup_entry(hass, self)\n'], index=0, positions=Positions(lineno=761, end_lineno=761, col_offset=25, end_col_offset=70)), FrameInfo(frame=<frame at 0x7f859da7a0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 672, code async_setup>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=672, function='async_setup', code_context=['            await self.__async_setup_with_context(hass, integration)\n'], index=0, positions=Positions(lineno=672, end_lineno=672, col_offset=12, end_col_offset=68)), FrameInfo(frame=<frame at 0x7f859795d0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 906, code async_setup_locked>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=906, function='async_setup_locked', code_context=['            await self.async_setup(hass, integration=integration)\n'], index=0, positions=Positions(lineno=906, end_lineno=906, col_offset=12, end_col_offset=65)), FrameInfo(frame=<frame at 0x7f85ab6e40, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f85aae510, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:09:50.144 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: switch.dynamic_ocpp_evse_allow_grid_charging: [FrameInfo(frame=<frame at 0x7f85ad8f20, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f85eb5470, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 436, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=436, function='get_state_config', code_context=['    switch_state = get_sensor_data(self, self.config_entry.data.get(CONF_ALLOW_GRID_CHARGING_ENTITY_ID))\n'], index=0, positions=Positions(lineno=436, end_lineno=436, col_offset=19, end_col_offset=104)), FrameInfo(frame=<frame at 0x7f85baadd0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f85ad7240, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f85ada460, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 26, code async_update_data>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=26, function='async_update_data', code_context=['        await temp_sensor.async_update()\n'], index=0, positions=Positions(lineno=26, end_lineno=26, col_offset=8, end_col_offset=40)), FrameInfo(frame=<frame at 0x7f85ac6c80, file '/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', line 308, code _async_update_data>, filename='/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', lineno=308, function='_async_update_data', code_context=['        return await self.update_method()\n'], index=0, positions=Positions(lineno=308, end_lineno=308, col_offset=15, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f85aae3e0, file '/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', line 419, code _async_refresh>, filename='/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', lineno=419, function='_async_refresh', code_context=['            self.data = await self._async_update_data()\n'], index=0, positions=Positions(lineno=419, end_lineno=419, col_offset=24, end_col_offset=55)), FrameInfo(frame=<frame at 0x7f859d9e00, file '/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', line 343, code _async_config_entry_first_refresh>, filename='/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', lineno=343, function='_async_config_entry_first_refresh', code_context=['            await self._async_refresh(\n'], index=0, positions=Positions(lineno=343, end_lineno=347, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f859da340, file '/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', line 318, code async_config_entry_first_refresh>, filename='/usr/src/homeassistant/homeassistant/helpers/update_coordinator.py', lineno=318, function='async_config_entry_first_refresh', code_context=['            await self._async_config_entry_first_refresh()\n'], index=0, positions=Positions(lineno=318, end_lineno=318, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f85ad51c0, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 49, code async_setup_entry>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=49, function='async_setup_entry', code_context=['    await coordinator.async_config_entry_first_refresh()\n'], index=0, positions=Positions(lineno=49, end_lineno=49, col_offset=4, end_col_offset=56)), FrameInfo(frame=<frame at 0x7f859793f0, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f85afeda0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 448, code _async_setup_platform>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=448, function='_async_setup_platform', code_context=['                awaitable = create_eager_task(awaitable, loop=hass.loop)\n'], index=0, positions=Positions(lineno=448, end_lineno=448, col_offset=28, end_col_offset=72)), FrameInfo(frame=<frame at 0x7f859da0a0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 418, code async_setup_entry>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=418, function='async_setup_entry', code_context=['        return await self._async_setup_platform(async_create_setup_awaitable)\n'], index=0, positions=Positions(lineno=418, end_lineno=418, col_offset=15, end_col_offset=77)), FrameInfo(frame=<frame at 0x7f857fa680, file '/usr/src/homeassistant/homeassistant/helpers/entity_component.py', line 221, code async_setup_entry>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_component.py', lineno=221, function='async_setup_entry', code_context=['        return await self._platforms[key].async_setup_entry(config_entry)\n'], index=0, positions=Positions(lineno=221, end_lineno=221, col_offset=15, end_col_offset=73)), FrameInfo(frame=<frame at 0x7f85ac6d40, file '/usr/src/homeassistant/homeassistant/components/sensor/__init__.py', line 100, code async_setup_entry>, filename='/usr/src/homeassistant/homeassistant/components/sensor/__init__.py', lineno=100, function='async_setup_entry', code_context=['    return await hass.data[DATA_COMPONENT].async_setup_entry(entry)\n'], index=0, positions=Positions(lineno=100, end_lineno=100, col_offset=11, end_col_offset=67)), FrameInfo(frame=<frame at 0x7f85914c40, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 761, code __async_setup_with_context>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=761, function='__async_setup_with_context', code_context=['                result = await component.async_setup_entry(hass, self)\n'], index=0, positions=Positions(lineno=761, end_lineno=761, col_offset=25, end_col_offset=70)), FrameInfo(frame=<frame at 0x7f859da5e0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 672, code async_setup>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=672, function='async_setup', code_context=['            await self.__async_setup_with_context(hass, integration)\n'], index=0, positions=Positions(lineno=672, end_lineno=672, col_offset=12, end_col_offset=68)), FrameInfo(frame=<frame at 0x7f85ab7040, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 2654, code _async_forward_entry_setup>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=2654, function='_async_forward_entry_setup', code_context=['        await entry.async_setup(self.hass, integration=integration)\n'], index=0, positions=Positions(lineno=2654, end_lineno=2654, col_offset=8, end_col_offset=67)), FrameInfo(frame=<frame at 0x7f859794e0, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f857fae60, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 2615, code <genexpr>>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=2615, function='<genexpr>', code_context=['                create_eager_task(\n'], index=0, positions=Positions(lineno=2615, end_lineno=2622, col_offset=16, end_col_offset=17)), FrameInfo(frame=<frame at 0x7f8593b030, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 2613, code _async_forward_entry_setups_locked>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=2613, function='_async_forward_entry_setups_locked', code_context=['        await asyncio.gather(\n'], index=0, positions=Positions(lineno=2613, end_lineno=2625, col_offset=14, end_col_offset=9)), FrameInfo(frame=<frame at 0x7f85ad6fc0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 2602, code async_forward_entry_setups>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=2602, function='async_forward_entry_setups', code_context=['            await self._async_forward_entry_setups_locked(entry, platforms)\n'], index=0, positions=Positions(lineno=2602, end_lineno=2602, col_offset=12, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f857f4860, file '/config/custom_components/dynamic_ocpp_evse/__init__.py', line 69, code async_setup_entry>, filename='/config/custom_components/dynamic_ocpp_evse/__init__.py', lineno=69, function='async_setup_entry', code_context=['    await hass.config_entries.async_forward_entry_setups(entry, ["sensor", "select", "button", "number", "switch"])\n'], index=0, positions=Positions(lineno=69, end_lineno=69, col_offset=4, end_col_offset=115)), FrameInfo(frame=<frame at 0x7f85914dc0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 761, code __async_setup_with_context>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=761, function='__async_setup_with_context', code_context=['                result = await component.async_setup_entry(hass, self)\n'], index=0, positions=Positions(lineno=761, end_lineno=761, col_offset=25, end_col_offset=70)), FrameInfo(frame=<frame at 0x7f859da7a0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 672, code async_setup>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=672, function='async_setup', code_context=['            await self.__async_setup_with_context(hass, integration)\n'], index=0, positions=Positions(lineno=672, end_lineno=672, col_offset=12, end_col_offset=68)), FrameInfo(frame=<frame at 0x7f859795d0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 906, code async_setup_locked>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=906, function='async_setup_locked', code_context=['            await self.async_setup(hass, integration=integration)\n'], index=0, positions=Positions(lineno=906, end_lineno=906, col_offset=12, end_col_offset=65)), FrameInfo(frame=<frame at 0x7f85ab6e40, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f85aae510, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:09:50.144 ERROR (MainThread) [custom_components.dynamic_ocpp_evse.sensor] Error updating Dynamic OCPP EVSE Sensor: unsupported operand type(s) for /: 'str' and 'int'
Traceback (most recent call last):
  File "/config/custom_components/dynamic_ocpp_evse/sensor.py", line 140, in async_update
    data = calculate_available_current(self)
  File "/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py", line 528, in calculate_available_current
    max_evse_available = calculate_max_evse_available(charge_context)
  File "/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py", line 114, in calculate_max_evse_available
    max_import_current = max_import_power / context.voltage
                         ~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~~~~~
TypeError: unsupported operand type(s) for /: 'str' and 'int'
2025-12-23 13:09:50.316 WARNING (MainThread) [homeassistant.util.loop] Detected blocking call to open with args ('/config/custom_components/mojelektro/manifest.json', 'r') inside the event loop by custom integration 'mojelektro' at custom_components/mojelektro/sensor.py, line 137: with open(manifest_path, 'r') as f: (offender: /config/custom_components/mojelektro/sensor.py, line 137: with open(manifest_path, 'r') as f:), please create a bug report at https://github.com/frlequ/homeassistant-mojelektro/issues
For developers, please see https://developers.home-assistant.io/docs/asyncio_blocking_operations/#open
Traceback (most recent call last):
  File "<frozen runpy>", line 198, in _run_module_as_main
  File "<frozen runpy>", line 88, in _run_code
  File "/usr/src/homeassistant/homeassistant/__main__.py", line 229, in <module>
    sys.exit(main())
  File "/usr/src/homeassistant/homeassistant/__main__.py", line 215, in main
    exit_code = runner.run(runtime_conf)
  File "/usr/src/homeassistant/homeassistant/runner.py", line 289, in run
    return loop.run_until_complete(setup_and_run_hass(runtime_config))
  File "/usr/local/lib/python3.13/asyncio/base_events.py", line 712, in run_until_complete
    self.run_forever()
  File "/usr/local/lib/python3.13/asyncio/base_events.py", line 683, in run_forever
    self._run_once()
  File "/usr/local/lib/python3.13/asyncio/base_events.py", line 2050, in _run_once
    handle._run()
  File "/usr/local/lib/python3.13/asyncio/events.py", line 89, in _run
    self._context.run(self._callback, *self._args)
  File "/config/custom_components/mojelektro/sensor.py", line 67, in async_setup_entry
    async_add_entities(sensors)
  File "/usr/src/homeassistant/homeassistant/helpers/entity_platform.py", line 575, in _async_schedule_add_entities_for_entry
    task = self.config_entry.async_create_task(
  File "/usr/src/homeassistant/homeassistant/config_entries.py", line 1306, in async_create_task
    task = hass.async_create_task_internal(
  File "/usr/src/homeassistant/homeassistant/core.py", line 810, in async_create_task_internal
    task = create_eager_task(target, name=name, loop=self.loop)
  File "/usr/src/homeassistant/homeassistant/util/async_.py", line 44, in create_eager_task
    return Task(coro, loop=loop, name=name, eager_start=True)
  File "/usr/src/homeassistant/homeassistant/helpers/entity_platform.py", line 726, in async_add_entities
    await self._async_add_entities(entities, timeout, config_subentry_id)
  File "/usr/src/homeassistant/homeassistant/helpers/entity_platform.py", line 676, in _async_add_entities
    await self._async_add_entity(
  File "/usr/src/homeassistant/homeassistant/helpers/entity_platform.py", line 849, in _async_add_entity
    if device_info := entity.device_info:
  File "/config/custom_components/mojelektro/sensor.py", line 112, in device_info
    "sw_version": self.get_version(),
  File "/config/custom_components/mojelektro/sensor.py", line 137, in get_version
    with open(manifest_path, 'r') as f:

2025-12-23 13:09:50.518 ERROR (MainThread) [homeassistant.helpers.event] Error while processing template: Template<template=({% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}) renders=2>
Traceback (most recent call last):
  File "/usr/src/homeassistant/homeassistant/helpers/template/__init__.py", line 1551, in forgiving_float_filter
    return float(value)
ValueError: could not convert string to float: 'unknown'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/src/homeassistant/homeassistant/helpers/template/__init__.py", line 461, in async_render
    render_result = render_with_context(self.template, compiled, **kwargs)
  File "/usr/src/homeassistant/homeassistant/helpers/template/context.py", line 45, in render_with_context
    return template.render(**kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^
  File "/usr/local/lib/python3.13/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/usr/local/lib/python3.13/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "<template>", line 3, in top-level template code
  File "/usr/src/homeassistant/homeassistant/helpers/template/__init__.py", line 1554, in forgiving_float_filter
    raise_no_default("float", value)
    ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "/usr/src/homeassistant/homeassistant/helpers/template/helpers.py", line 24, in raise_no_default
    raise ValueError(
    ...<2 lines>...
    )
ValueError: Template error: float got invalid input 'unknown' when rendering template '{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}' but no default was specified

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/src/homeassistant/homeassistant/helpers/template/__init__.py", line 579, in async_render_to_info
    render_info._result = self.async_render(  # noqa: SLF001
                          ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
        variables, strict=strict, log_fn=log_fn, **kwargs
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/usr/src/homeassistant/homeassistant/helpers/template/__init__.py", line 463, in async_render
    raise TemplateError(err) from err
homeassistant.exceptions.TemplateError: ValueError: Template error: float got invalid input 'unknown' when rendering template '{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}' but no default was specified
2025-12-23 13:09:50.522 ERROR (MainThread) [homeassistant.components.template.template_entity] TemplateError('ValueError: Template error: float got invalid input 'unknown' when rendering template '{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}' but no default was specified') while processing template 'Template<template=({% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}) renders=4>' for attribute '_attr_native_value' in entity 'sensor.povprecna_moc_do_konca_cb'
2025-12-23 13:09:50.523 ERROR (MainThread) [homeassistant.helpers.event] Error while processing template: Template<template=({%set calculated = states('sensor.povprecna_moc_do_konca_cb') | float%}
{%set production = states('sensor.solaredge_i2_ac_power') | float%}
{%set import = -1 * states('sensor.solaredge_i2_m1_ac_power') | float%}

{{calculated - production-import}}) renders=2>
Traceback (most recent call last):
  File "/usr/src/homeassistant/homeassistant/helpers/template/__init__.py", line 1551, in forgiving_float_filter
    return float(value)
ValueError: could not convert string to float: 'unavailable'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/src/homeassistant/homeassistant/helpers/template/__init__.py", line 461, in async_render
    render_result = render_with_context(self.template, compiled, **kwargs)
  File "/usr/src/homeassistant/homeassistant/helpers/template/context.py", line 45, in render_with_context
    return template.render(**kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^
  File "/usr/local/lib/python3.13/site-packages/jinja2/environment.py", line 1295, in render
    self.environment.handle_exception()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/usr/local/lib/python3.13/site-packages/jinja2/environment.py", line 942, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "<template>", line 1, in top-level template code
  File "/usr/src/homeassistant/homeassistant/helpers/template/__init__.py", line 1554, in forgiving_float_filter
    raise_no_default("float", value)
    ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "/usr/src/homeassistant/homeassistant/helpers/template/helpers.py", line 24, in raise_no_default
    raise ValueError(
    ...<2 lines>...
    )
ValueError: Template error: float got invalid input 'unavailable' when rendering template '{%set calculated = states('sensor.povprecna_moc_do_konca_cb') | float%}
{%set production = states('sensor.solaredge_i2_ac_power') | float%}
{%set import = -1 * states('sensor.solaredge_i2_m1_ac_power') | float%}

{{calculated - production-import}}' but no default was specified

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/src/homeassistant/homeassistant/helpers/template/__init__.py", line 579, in async_render_to_info
    render_info._result = self.async_render(  # noqa: SLF001
                          ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
        variables, strict=strict, log_fn=log_fn, **kwargs
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/usr/src/homeassistant/homeassistant/helpers/template/__init__.py", line 463, in async_render
    raise TemplateError(err) from err
homeassistant.exceptions.TemplateError: ValueError: Template error: float got invalid input 'unavailable' when rendering template '{%set calculated = states('sensor.povprecna_moc_do_konca_cb') | float%}
{%set production = states('sensor.solaredge_i2_ac_power') | float%}
{%set import = -1 * states('sensor.solaredge_i2_m1_ac_power') | float%}

{{calculated - production-import}}' but no default was specified
2025-12-23 13:09:50.526 ERROR (MainThread) [homeassistant.components.template.template_entity] TemplateError('ValueError: Template error: float got invalid input 'unavailable' when rendering template '{%set calculated = states('sensor.povprecna_moc_do_konca_cb') | float%}
{%set production = states('sensor.solaredge_i2_ac_power') | float%}
{%set import = -1 * states('sensor.solaredge_i2_m1_ac_power') | float%}

{{calculated - production-import}}' but no default was specified') while processing template 'Template<template=({%set calculated = states('sensor.povprecna_moc_do_konca_cb') | float%}
{%set production = states('sensor.solaredge_i2_ac_power') | float%}
{%set import = -1 * states('sensor.solaredge_i2_m1_ac_power') | float%}

{{calculated - production-import}}) renders=4>' for attribute '_attr_native_value' in entity 'sensor.razlika_do_moci_v_cb'
2025-12-23 13:09:50.533 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=5073; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:09:50.530464+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=5809; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:09:50.530943+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:09:55.312 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=6694; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:09:55.310651+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=6841; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:09:55.311246+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:09:55.799 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=6880; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:09:55.796875+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=6863; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:09:55.798270+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:09:59.656 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get attribute 'phases' for sensor: sensor.dynamic_ocpp_evse
2025-12-23 13:09:59.715 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_min_current: [FrameInfo(frame=<frame at 0x7f801e0f20, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f1340, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 402, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=402, function='get_state_config', code_context=['    state[CONF_MIN_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MIN_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=402, end_lineno=402, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028ca60, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f801cf740, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f8d804660, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f801eb010, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f825b1f40, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f801e8220, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f801e87c0, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f801e8d60, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f8d804120, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f825b1d40, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f801f1470, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:09:59.754 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_max_current: [FrameInfo(frame=<frame at 0x7f801e0f20, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f1340, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 403, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=403, function='get_state_config', code_context=['    state[CONF_MAX_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MAX_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=403, end_lineno=403, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028ca60, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f801cf740, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f8d804660, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f801eb010, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f825b1f40, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f801e8220, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f801e87c0, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f801e8d60, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f8d804120, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f825b1d40, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f801f1470, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:09:59.757 ERROR (MainThread) [custom_components.dynamic_ocpp_evse.sensor] Error updating Dynamic OCPP EVSE Sensor: '<' not supported between instances of 'str' and 'int'
Traceback (most recent call last):
  File "/config/custom_components/dynamic_ocpp_evse/sensor.py", line 140, in async_update
    data = calculate_available_current(self)
  File "/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py", line 554, in calculate_available_current
    if state[CONF_AVAILABLE_CURRENT] < state[CONF_EVSE_MINIMUM_CHARGE_CURRENT]:
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: '<' not supported between instances of 'str' and 'int'
2025-12-23 13:09:59.759 INFO (MainThread) [ocpp] : receive message [2,"531613001","BootNotification",{"chargePointVendor":"go-e","chargePointModel":"go-eCharger_V4","chargePointSerialNumber":"216841","firmwareVersion":"59.4"}]
2025-12-23 13:09:59.764 INFO (MainThread) [ocpp] : send [2,"1e01cafd-89e4-401a-b066-a9a86765104e","GetConfiguration",{"key":["SupportedFeatureProfiles"]}]
2025-12-23 13:09:59.764 INFO (MainThread) [ocpp] : send [3,"531613001",{"currentTime":"2025-12-23T12:09:59Z","interval":3600,"status":"Accepted"}]
2025-12-23 13:09:59.829 INFO (MainThread) [ocpp] : receive message [3,"1e01cafd-89e4-401a-b066-a9a86765104e",{"configurationKey":[{"key":"SupportedFeatureProfiles","readonly":true,"value":"Core,FirmwareManagement,LocalAuthListManagement,SmartCharging,RemoteTrigger"}],"unknownKey":[]}]
2025-12-23 13:09:59.831 INFO (MainThread) [ocpp] : send [2,"05e8bc17-ead1-4242-89e1-f34a31a304e8","GetConfiguration",{"key":["NumberOfConnectors"]}]
2025-12-23 13:09:59.948 INFO (MainThread) [ocpp] : receive message [2,"531613002","StatusNotification",{"connectorId":0,"errorCode":"NoError","status":"Available","timestamp":"2025-12-23T12:09:59.788Z"}]
2025-12-23 13:09:59.961 INFO (MainThread) [ocpp] : send [3,"531613002",{}]
2025-12-23 13:09:59.965 INFO (MainThread) [ocpp] : receive message [3,"05e8bc17-ead1-4242-89e1-f34a31a304e8",{"configurationKey":[{"key":"NumberOfConnectors","readonly":true,"value":"1"}],"unknownKey":[]}]
2025-12-23 13:09:59.967 INFO (MainThread) [ocpp] : send [2,"5419ac35-21c3-40ce-a734-63ed881f5bf8","GetConfiguration",{"key":["HeartbeatInterval"]}]
2025-12-23 13:10:00.106 INFO (MainThread) [ocpp] : receive message [2,"531613003","StatusNotification",{"connectorId":1,"errorCode":"NoError","status":"Charging","timestamp":"2025-12-23T12:09:59.788Z"}]
2025-12-23 13:10:00.113 INFO (MainThread) [ocpp] : send [3,"531613003",{}]
2025-12-23 13:10:00.117 INFO (MainThread) [ocpp] : receive message [3,"5419ac35-21c3-40ce-a734-63ed881f5bf8",{"configurationKey":[{"key":"HeartbeatInterval","readonly":false,"value":"3600"}],"unknownKey":[]}]
2025-12-23 13:10:00.119 INFO (MainThread) [ocpp] : send [2,"71f722d7-d8c6-4857-aa0d-661c8b990aea","ChangeConfiguration",{"key":"MeterValuesSampledData","value":"Current.Import,Current.Offered,Energy.Active.Import.Register,Frequency,Power.Active.Import,Power.Factor,Power.Offered,Temperature,Voltage"}]
2025-12-23 13:10:00.185 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=6807; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:10:00.183860+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=6779; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:10:00.185343+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:10:00.258 INFO (MainThread) [ocpp] : receive message [2,"531613004","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:09:59.788Z","sampledValue":[{"value":"6.00","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"5.97","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"6.12","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"6.00","measurand":"Current.Offered","unit":"A"},{"value":"17137228.43","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.96","measurand":"Frequency"},{"value":"1349.20","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1340.83","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"1358.10","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"4048.13","measurand":"Power.Active.Import","unit":"W"},{"value":"99.30","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"99.32","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"4140.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"226.30","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"224.75","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"223.51","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.72","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:10:00.270 INFO (MainThread) [ocpp] : send [3,"531613004",{}]
2025-12-23 13:10:00.271 INFO (MainThread) [ocpp] : receive message [3,"71f722d7-d8c6-4857-aa0d-661c8b990aea",{"status":"Accepted"}]
2025-12-23 13:10:00.275 INFO (MainThread) [ocpp] : send [2,"69e5541b-1349-4a07-b311-58caf540e6a3","GetConfiguration",{"key":["MeterValuesSampledData"]}]
2025-12-23 13:10:00.312 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=6822; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:10:00.310649+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=6843; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:10:00.311640+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:10:00.317 INFO (MainThread) [ocpp] : receive message [3,"69e5541b-1349-4a07-b311-58caf540e6a3",{"configurationKey":[{"key":"MeterValuesSampledData","readonly":false,"value":"Current.Import.L1,Current.Import.L2,Current.Import.L3,Current.Offered,Energy.Active.Import.Register,Frequency,Power.Active.Import,Power.Factor.L1,Power.Factor.L2,Power.Factor.L3,Power.Factor.N,Power.Offered,Temperature,Voltage.L1,Voltage.L2,Voltage.L3,Voltage.N"}],"unknownKey":[]}]
2025-12-23 13:10:00.318 INFO (MainThread) [ocpp] : send [2,"0cea8487-c5b7-456e-ba55-66550c2ff692","GetConfiguration",{"key":["MeterValuesSampledData"]}]
2025-12-23 13:10:00.422 INFO (MainThread) [ocpp] : receive message [3,"0cea8487-c5b7-456e-ba55-66550c2ff692",{"configurationKey":[{"key":"MeterValuesSampledData","readonly":false,"value":"Current.Import.L1,Current.Import.L2,Current.Import.L3,Current.Offered,Energy.Active.Import.Register,Frequency,Power.Active.Import,Power.Factor.L1,Power.Factor.L2,Power.Factor.L3,Power.Factor.N,Power.Offered,Temperature,Voltage.L1,Voltage.L2,Voltage.L3,Voltage.N"}],"unknownKey":[]}]
2025-12-23 13:10:00.423 INFO (MainThread) [ocpp] : send [2,"f5e0d760-acba-4055-9155-b74d85825f64","ChangeConfiguration",{"key":"MeterValuesSampledData","value":"Current.Import,Current.Offered,Energy.Active.Import.Register,Frequency,Power.Active.Import,Power.Factor,Power.Offered,Temperature,Voltage"}]
2025-12-23 13:10:00.537 INFO (MainThread) [ocpp] : receive message [3,"f5e0d760-acba-4055-9155-b74d85825f64",{"status":"Accepted"}]
2025-12-23 13:10:00.539 INFO (MainThread) [ocpp] : send [2,"232aacca-1a46-46a1-a340-a083a29d7aae","GetConfiguration",{"key":["MeterValueSampleInterval"]}]
2025-12-23 13:10:00.650 INFO (MainThread) [ocpp] : receive message [3,"232aacca-1a46-46a1-a340-a083a29d7aae",{"configurationKey":[{"key":"MeterValueSampleInterval","readonly":false,"value":"5"}],"unknownKey":[]}]
2025-12-23 13:10:00.653 INFO (MainThread) [ocpp] : send [2,"d66bd10f-e10f-4d7f-9277-6fc1b56eb3fb","GetConfiguration",{"key":["ClockAlignedDataInterval"]}]
2025-12-23 13:10:00.756 INFO (MainThread) [ocpp] : receive message [3,"d66bd10f-e10f-4d7f-9277-6fc1b56eb3fb",{"configurationKey":[{"key":"ClockAlignedDataInterval","readonly":false,"value":"60"}],"unknownKey":[]}]
2025-12-23 13:10:00.758 INFO (MainThread) [ocpp] : send [2,"62e11ae7-e62d-42af-a6a6-20d525f67f08","ChangeAvailability",{"connectorId":0,"type":"Operative"}]
2025-12-23 13:10:00.872 INFO (MainThread) [ocpp] : receive message [3,"62e11ae7-e62d-42af-a6a6-20d525f67f08",{"status":"Accepted"}]
2025-12-23 13:10:00.880 INFO (MainThread) [ocpp] : send [2,"1a762b90-4ec0-4093-85f6-51a3daebe9b0","TriggerMessage",{"requestedMessage":"StatusNotification","connectorId":1}]
2025-12-23 13:10:01.053 INFO (MainThread) [ocpp] : receive message [2,"531613005","StatusNotification",{"connectorId":1,"errorCode":"NoError","status":"Charging","timestamp":"2025-12-23T12:10:01.003Z"}]
2025-12-23 13:10:01.058 INFO (MainThread) [ocpp] : send [3,"531613005",{}]
2025-12-23 13:10:01.065 INFO (MainThread) [ocpp] : receive message [3,"1a762b90-4ec0-4093-85f6-51a3daebe9b0",{"status":"Accepted"}]
2025-12-23 13:10:04.961 INFO (MainThread) [ocpp] : receive message [2,"531613006","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:10:04.798Z","sampledValue":[{"value":"6.00","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"5.97","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"6.12","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"6.00","measurand":"Current.Offered","unit":"A"},{"value":"17137234.09","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.96","measurand":"Frequency"},{"value":"1348.80","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1343.02","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"1355.42","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"4047.24","measurand":"Power.Active.Import","unit":"W"},{"value":"99.41","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"99.12","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"4140.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"225.99","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"225.06","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"223.51","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.72","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:10:04.972 INFO (MainThread) [ocpp] : send [3,"531613006",{}]
2025-12-23 13:10:05.313 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=6850; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:10:05.310663+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=6854; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:10:05.311393+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:10:09.657 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get attribute 'phases' for sensor: sensor.dynamic_ocpp_evse
2025-12-23 13:10:09.697 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_min_current: [FrameInfo(frame=<frame at 0x7f801e1250, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f15a0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 402, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=402, function='get_state_config', code_context=['    state[CONF_MIN_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MIN_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=402, end_lineno=402, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028ca60, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f801cfc40, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f80229540, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7fa1156200, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f825b2440, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7fa11562f0, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f873f2110, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f873f0f40, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f80229620, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f825b2540, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f801f0af0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:10:09.737 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_max_current: [FrameInfo(frame=<frame at 0x7f801e1250, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f15a0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 403, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=403, function='get_state_config', code_context=['    state[CONF_MAX_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MAX_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=403, end_lineno=403, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028ca60, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f801cfc40, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f80229540, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7fa1156200, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f825b2440, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7fa11562f0, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f873f2110, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f873f0f40, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f80229620, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f825b2540, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f801f0af0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:10:09.742 INFO (MainThread) [ocpp] : send [2,"48e3a74a-e9ab-4616-b033-24695bc8e730","SetChargingProfile",{"connectorId":0,"csChargingProfiles":{"chargingProfileId":11,"stackLevel":2,"chargingProfileKind":"Relative","chargingProfilePurpose":"TxDefaultProfile","validFrom":"2025-12-23T12:10:09Z","validTo":"2025-12-23T12:10:24Z","chargingSchedule":{"chargingRateUnit":"A","chargingSchedulePeriod":[{"startPeriod":0,"limit":6.5}]}}}]
2025-12-23 13:10:09.936 INFO (MainThread) [ocpp] : receive message [3,"48e3a74a-e9ab-4616-b033-24695bc8e730",{"status":"Accepted"}]
2025-12-23 13:10:10.075 INFO (MainThread) [ocpp] : receive message [2,"531613007","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:10:09.894Z","sampledValue":[{"value":"6.00","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"6.00","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"6.12","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"6.00","measurand":"Current.Offered","unit":"A"},{"value":"17137239.86","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.96","measurand":"Frequency"},{"value":"1349.17","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1341.69","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"1356.61","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"4047.47","measurand":"Power.Active.Import","unit":"W"},{"value":"99.43","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"99.43","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"99.21","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"4140.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"225.99","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"224.75","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"223.51","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.72","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:10:10.087 INFO (MainThread) [ocpp] : send [3,"531613007",{}]
2025-12-23 13:10:10.313 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=6860; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:10:10.310771+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=6862; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:10:10.311648+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:10:10.518 WARNING (Recorder) [homeassistant.components.sensor.recorder] The unit of sensor.charger_time_session (None) cannot be converted to the unit of previously compiled statistics (min). Generation of long term statistics will be suppressed unless the unit changes back to min or a compatible unit. Go to https://my.home-assistant.io/redirect/developer_statistics to fix this
2025-12-23 13:10:10.710 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=6845; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:10:10.708456+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=6836; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:10:10.709781+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:10:15.242 INFO (MainThread) [ocpp] : receive message [2,"531613008","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:10:15.032Z","sampledValue":[{"value":"6.00","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"6.00","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"6.12","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"6.00","measurand":"Current.Offered","unit":"A"},{"value":"17137245.55","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.96","measurand":"Frequency"},{"value":"1346.14","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1340.55","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"1356.17","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"4042.86","measurand":"Power.Active.Import","unit":"W"},{"value":"99.21","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"99.34","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"99.31","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"4140.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"225.99","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"224.75","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"223.20","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.72","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:10:15.253 INFO (MainThread) [ocpp] : send [3,"531613008",{}]
2025-12-23 13:10:15.313 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=6841; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:10:15.311057+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=6844; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:10:15.311792+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:10:15.853 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=6839; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:10:15.851308+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=6836; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:10:15.852622+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:10:19.697 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_min_current: [FrameInfo(frame=<frame at 0x7f85adb670, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 402, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=402, function='get_state_config', code_context=['    state[CONF_MIN_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MIN_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=402, end_lineno=402, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028cc10, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f8c817d80, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f802ad9a0, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f844a67a0, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f844b9540, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f844a4220, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f844a4400, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7fa957b010, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f802ada80, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f8c07fa40, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f801f15a0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:10:19.738 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_max_current: [FrameInfo(frame=<frame at 0x7f85adb670, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 403, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=403, function='get_state_config', code_context=['    state[CONF_MAX_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MAX_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=403, end_lineno=403, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028cc10, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f8c817d80, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f802ad9a0, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f844a67a0, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f844b9540, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f844a4220, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f844a4400, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7fa957b010, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f802ada80, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f8c07fa40, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f801f15a0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:10:19.744 INFO (MainThread) [ocpp] : send [2,"2cb6c621-957d-4f77-be15-ad5c08e714b0","SetChargingProfile",{"connectorId":0,"csChargingProfiles":{"chargingProfileId":11,"stackLevel":2,"chargingProfileKind":"Relative","chargingProfilePurpose":"TxDefaultProfile","validFrom":"2025-12-23T12:10:19Z","validTo":"2025-12-23T12:10:34Z","chargingSchedule":{"chargingRateUnit":"A","chargingSchedulePeriod":[{"startPeriod":0,"limit":6.3}]}}}]
2025-12-23 13:10:19.914 INFO (MainThread) [ocpp] : receive message [3,"2cb6c621-957d-4f77-be15-ad5c08e714b0",{"status":"Accepted"}]
2025-12-23 13:10:20.218 INFO (MainThread) [ocpp] : receive message [2,"531613009","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:10:20.042Z","sampledValue":[{"value":"6.00","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"5.97","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"6.12","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"6.00","measurand":"Current.Offered","unit":"A"},{"value":"17137251.21","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.96","measurand":"Frequency"},{"value":"1341.51","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1338.78","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"1361.91","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"4042.20","measurand":"Power.Active.Import","unit":"W"},{"value":"99.42","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"99.84","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"99.60","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"4140.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"224.75","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"224.75","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"223.51","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.72","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:10:20.229 INFO (MainThread) [ocpp] : send [3,"531613009",{}]
2025-12-23 13:10:20.730 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=6898; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:10:20.728354+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=6927; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:10:20.729701+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:10:25.313 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=6952; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:10:25.310810+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=6965; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:10:25.311579+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:10:25.318 INFO (MainThread) [ocpp] : receive message [2,"531613010","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:10:25.105Z","sampledValue":[{"value":"6.00","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"6.00","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"6.12","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"6.00","measurand":"Current.Offered","unit":"A"},{"value":"17137256.86","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.96","measurand":"Frequency"},{"value":"1340.60","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1339.94","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"1362.99","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"4043.53","measurand":"Power.Active.Import","unit":"W"},{"value":"99.35","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"99.30","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"99.54","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"4140.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"224.75","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"224.75","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"223.82","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.72","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:10:25.329 INFO (MainThread) [ocpp] : send [3,"531613010",{}]
2025-12-23 13:10:25.821 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=6896; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:10:25.819748+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=6858; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:10:25.821115+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:10:29.697 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_min_current: [FrameInfo(frame=<frame at 0x7f85643230, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 402, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=402, function='get_state_config', code_context=['    state[CONF_MIN_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MIN_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=402, end_lineno=402, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028cc10, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f937e4a40, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f802bcac0, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f857af4c0, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f844b9340, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f857ad5d0, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f8597be20, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f890753f0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f802bdc40, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f8c07fa40, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f801f15a0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:10:29.738 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_max_current: [FrameInfo(frame=<frame at 0x7f85643230, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 403, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=403, function='get_state_config', code_context=['    state[CONF_MAX_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MAX_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=403, end_lineno=403, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028cc10, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f937e4a40, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f802bcac0, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f857af4c0, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f844b9340, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f857ad5d0, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f8597be20, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f890753f0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f802bdc40, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f8c07fa40, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f801f15a0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:10:29.741 INFO (MainThread) [ocpp] : send [2,"37b902b3-59f8-43b8-83a7-aa09dc23c214","SetChargingProfile",{"connectorId":0,"csChargingProfiles":{"chargingProfileId":11,"stackLevel":2,"chargingProfileKind":"Relative","chargingProfilePurpose":"TxDefaultProfile","validFrom":"2025-12-23T12:10:29Z","validTo":"2025-12-23T12:10:44Z","chargingSchedule":{"chargingRateUnit":"A","chargingSchedulePeriod":[{"startPeriod":0,"limit":6.2}]}}}]
2025-12-23 13:10:29.914 INFO (MainThread) [ocpp] : receive message [3,"37b902b3-59f8-43b8-83a7-aa09dc23c214",{"status":"Accepted"}]
2025-12-23 13:10:30.313 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=6849; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:10:30.310818+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=6844; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:10:30.311697+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:10:30.328 INFO (MainThread) [ocpp] : receive message [2,"531613011","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:10:30.164Z","sampledValue":[{"value":"6.00","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"6.00","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"6.12","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"6.00","measurand":"Current.Offered","unit":"A"},{"value":"17137262.53","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.96","measurand":"Frequency"},{"value":"1343.97","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1342.32","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"1360.64","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"4046.93","measurand":"Power.Active.Import","unit":"W"},{"value":"99.46","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"99.48","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"99.37","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"4140.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"225.06","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"224.75","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"223.82","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.72","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:10:30.338 INFO (MainThread) [ocpp] : send [3,"531613011",{}]
2025-12-23 13:10:30.716 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=6834; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:10:30.714914+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=6830; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:10:30.716313+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:10:35.313 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=6838; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:10:35.310898+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=6842; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:10:35.311618+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:10:35.454 INFO (MainThread) [ocpp] : receive message [2,"531613012","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:10:35.250Z","sampledValue":[{"value":"5.97","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"5.97","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"6.08","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"6.00","measurand":"Current.Offered","unit":"A"},{"value":"17137268.19","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.95","measurand":"Frequency"},{"value":"1351.14","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1326.72","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"1350.66","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"4028.51","measurand":"Power.Active.Import","unit":"W"},{"value":"99.67","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"99.49","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"99.39","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"4140.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"227.23","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"223.51","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"223.51","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.41","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:10:35.466 INFO (MainThread) [ocpp] : send [3,"531613012",{}]
2025-12-23 13:10:35.834 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=6893; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:10:35.832554+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=6917; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:10:35.833917+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:10:39.698 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_min_current: [FrameInfo(frame=<frame at 0x7f85643de0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f8c0395a0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 402, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=402, function='get_state_config', code_context=['    state[CONF_MIN_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MIN_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=402, end_lineno=402, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028cc10, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f8c817d80, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f8020c9e0, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f8bf38d60, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f8035b740, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f8bf38a90, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f857ad300, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f857aea70, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f8020e0a0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f8035b340, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f801f15a0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:10:39.739 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_max_current: [FrameInfo(frame=<frame at 0x7f85643de0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f8c0395a0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 403, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=403, function='get_state_config', code_context=['    state[CONF_MAX_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MAX_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=403, end_lineno=403, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028cc10, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f8c817d80, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f8020c9e0, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f8bf38d60, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f8035b740, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f8bf38a90, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f857ad300, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f857aea70, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f8020e0a0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f8035b340, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f801f15a0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:10:39.742 INFO (MainThread) [ocpp] : send [2,"bd2495f3-4c74-482f-b8c2-b8912c885805","SetChargingProfile",{"connectorId":0,"csChargingProfiles":{"chargingProfileId":11,"stackLevel":2,"chargingProfileKind":"Relative","chargingProfilePurpose":"TxDefaultProfile","validFrom":"2025-12-23T12:10:39Z","validTo":"2025-12-23T12:10:54Z","chargingSchedule":{"chargingRateUnit":"A","chargingSchedulePeriod":[{"startPeriod":0,"limit":6.0}]}}}]
2025-12-23 13:10:39.904 INFO (MainThread) [ocpp] : receive message [3,"bd2495f3-4c74-482f-b8c2-b8912c885805",{"status":"Accepted"}]
2025-12-23 13:10:40.315 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=6941; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:10:40.311137+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=6953; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:10:40.313045+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:10:40.522 INFO (MainThread) [ocpp] : receive message [2,"531613013","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:10:40.363Z","sampledValue":[{"value":"6.00","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"5.97","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"6.08","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"6.00","measurand":"Current.Offered","unit":"A"},{"value":"17137273.82","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.95","measurand":"Frequency"},{"value":"1352.18","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1327.96","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"1352.58","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"4032.72","measurand":"Power.Active.Import","unit":"W"},{"value":"99.11","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"99.59","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"99.53","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"4140.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"227.23","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"223.51","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"223.51","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.41","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:10:40.533 INFO (MainThread) [ocpp] : send [3,"531613013",{}]
2025-12-23 13:10:40.697 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=6941; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:10:40.695706+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=6932; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:10:40.697072+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:10:45.313 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=6939; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:10:45.310748+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=6942; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:10:45.311529+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:10:45.642 INFO (MainThread) [ocpp] : receive message [2,"531613014","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:10:45.427Z","sampledValue":[{"value":"6.00","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"5.97","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"6.12","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"6.00","measurand":"Current.Offered","unit":"A"},{"value":"17137279.47","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.95","measurand":"Frequency"},{"value":"1353.70","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1329.48","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"1359.04","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"4042.23","measurand":"Power.Active.Import","unit":"W"},{"value":"99.36","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"99.84","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"99.39","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"4140.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"226.92","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"223.20","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"223.51","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.41","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:10:45.653 INFO (MainThread) [ocpp] : send [3,"531613014",{}]
2025-12-23 13:10:45.692 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=6931; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:10:45.690601+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=6924; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:10:45.691995+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:10:49.699 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_min_current: [FrameInfo(frame=<frame at 0x7f801e3230, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 402, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=402, function='get_state_config', code_context=['    state[CONF_MIN_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MIN_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=402, end_lineno=402, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028ca60, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f8c814180, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f7e281c40, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f890747c0, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85553240, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f801ebb50, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f801eba60, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f801ea6b0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f7e2819a0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f85550140, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f801f15a0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:10:49.739 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_max_current: [FrameInfo(frame=<frame at 0x7f801e3230, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 403, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=403, function='get_state_config', code_context=['    state[CONF_MAX_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MAX_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=403, end_lineno=403, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028ca60, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f8c814180, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f7e281c40, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f890747c0, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85553240, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f801ebb50, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f801eba60, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f801ea6b0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f7e2819a0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f85550140, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f801f15a0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:10:49.742 INFO (MainThread) [ocpp] : send [2,"38a82ef1-1c91-407c-83fa-6b43142b4e0d","SetChargingProfile",{"connectorId":0,"csChargingProfiles":{"chargingProfileId":11,"stackLevel":2,"chargingProfileKind":"Relative","chargingProfilePurpose":"TxDefaultProfile","validFrom":"2025-12-23T12:10:49Z","validTo":"2025-12-23T12:11:04Z","chargingSchedule":{"chargingRateUnit":"A","chargingSchedulePeriod":[{"startPeriod":0,"limit":6.2}]}}}]
2025-12-23 13:10:49.916 INFO (MainThread) [ocpp] : receive message [3,"38a82ef1-1c91-407c-83fa-6b43142b4e0d",{"status":"Accepted"}]
2025-12-23 13:10:50.700 INFO (MainThread) [ocpp] : receive message [2,"531613015","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:10:50.527Z","sampledValue":[{"value":"6.00","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"6.00","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"6.12","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"6.00","measurand":"Current.Offered","unit":"A"},{"value":"17137285.28","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.95","measurand":"Frequency"},{"value":"1353.36","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1333.79","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"1358.71","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"4045.86","measurand":"Power.Active.Import","unit":"W"},{"value":"99.20","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"99.39","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"99.36","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"4140.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"227.23","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"223.51","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"223.51","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.41","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:10:50.718 INFO (MainThread) [ocpp] : send [3,"531613015",{}]
2025-12-23 13:10:50.722 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=6919; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:10:50.720198+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=6916; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:10:50.721594+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:10:55.313 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=6926; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:10:55.310513+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=6931; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:10:55.311238+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:10:55.752 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=6920; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:10:55.750761+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=6913; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:10:55.752106+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:10:55.774 INFO (MainThread) [ocpp] : receive message [2,"531613016","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:10:55.566Z","sampledValue":[{"value":"6.04","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"6.00","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"6.12","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"6.00","measurand":"Current.Offered","unit":"A"},{"value":"17137291.00","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.96","measurand":"Frequency"},{"value":"1356.25","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1334.21","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"1359.77","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"4050.23","measurand":"Power.Active.Import","unit":"W"},{"value":"98.92","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"99.42","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"99.44","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"4140.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"226.92","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"223.51","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"223.51","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.41","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:10:55.786 INFO (MainThread) [ocpp] : send [3,"531613016",{}]
2025-12-23 13:10:59.699 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_min_current: [FrameInfo(frame=<frame at 0x7f85643560, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f15a0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 402, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=402, function='get_state_config', code_context=['    state[CONF_MIN_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MIN_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=402, end_lineno=402, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028cdc0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f801cfec0, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f81bc6420, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f8597be20, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f844b9540, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f8597bb50, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f89166f20, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f891666b0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7fa3110740, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f825b1740, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f801f3810, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:10:59.738 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_max_current: [FrameInfo(frame=<frame at 0x7f85643560, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f15a0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 403, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=403, function='get_state_config', code_context=['    state[CONF_MAX_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MAX_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=403, end_lineno=403, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028cdc0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f801cfec0, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f81bc6420, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f8597be20, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f844b9540, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f8597bb50, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f89166f20, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f891666b0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7fa3110740, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f825b1740, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f801f3810, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:10:59.743 INFO (MainThread) [ocpp] : send [2,"8aeb92dd-438b-42e4-b2b8-8b060b59045e","SetChargingProfile",{"connectorId":0,"csChargingProfiles":{"chargingProfileId":11,"stackLevel":2,"chargingProfileKind":"Relative","chargingProfilePurpose":"TxDefaultProfile","validFrom":"2025-12-23T12:10:59Z","validTo":"2025-12-23T12:11:14Z","chargingSchedule":{"chargingRateUnit":"A","chargingSchedulePeriod":[{"startPeriod":0,"limit":6.2}]}}}]
2025-12-23 13:10:59.952 INFO (MainThread) [ocpp] : receive message [3,"8aeb92dd-438b-42e4-b2b8-8b060b59045e",{"status":"Accepted"}]
2025-12-23 13:11:00.185 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=6851; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:11:00.183907+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=6820; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:11:00.184536+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:11:00.311 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=6875; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:11:00.310141+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=6902; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:11:00.310741+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:11:00.743 INFO (MainThread) [ocpp] : receive message [2,"531613017","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:11:00.578Z","sampledValue":[{"value":"6.00","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"6.00","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"6.12","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"6.00","measurand":"Current.Offered","unit":"A"},{"value":"17137296.70","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.96","measurand":"Frequency"},{"value":"1350.70","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1334.60","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"1357.91","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"4043.22","measurand":"Power.Active.Import","unit":"W"},{"value":"99.55","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"99.45","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"99.30","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"4140.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"225.99","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"223.51","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"223.51","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.41","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:11:00.745 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=6908; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:11:00.744226+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=6912; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:11:00.745056+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:11:00.761 INFO (MainThread) [ocpp] : send [3,"531613017",{}]
2025-12-23 13:11:05.312 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=6926; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:11:05.310616+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=6933; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:11:05.311058+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:11:05.741 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=6922; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:11:05.740605+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=6915; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:11:05.741399+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:11:05.798 INFO (MainThread) [ocpp] : receive message [2,"531613018","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:11:05.582Z","sampledValue":[{"value":"6.00","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"5.97","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"6.12","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"6.00","measurand":"Current.Offered","unit":"A"},{"value":"17137302.39","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.96","measurand":"Frequency"},{"value":"1345.58","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1328.84","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"1363.33","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"4037.75","measurand":"Power.Active.Import","unit":"W"},{"value":"99.58","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"99.93","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"99.29","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"4140.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"225.06","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"222.89","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"224.44","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.72","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:11:05.809 INFO (MainThread) [ocpp] : send [3,"531613018",{}]
2025-12-23 13:11:09.700 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_min_current: [FrameInfo(frame=<frame at 0x7f801e3120, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 402, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=402, function='get_state_config', code_context=['    state[CONF_MIN_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MIN_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=402, end_lineno=402, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028cdc0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f937e4a40, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f7e3a3140, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f890766b0, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f93ae2140, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f89075f30, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f89166f20, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f801e7a60, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f7e3a3ae0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f844b9340, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f7e3b89c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:11:09.740 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_max_current: [FrameInfo(frame=<frame at 0x7f801e3120, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 403, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=403, function='get_state_config', code_context=['    state[CONF_MAX_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MAX_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=403, end_lineno=403, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028cdc0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f937e4a40, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f7e3a3140, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f890766b0, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f93ae2140, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f89075f30, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f89166f20, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f801e7a60, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f7e3a3ae0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f844b9340, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f7e3b89c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:11:09.745 INFO (MainThread) [ocpp] : send [2,"9f890aaf-a29c-4411-b74c-ce709361bb06","SetChargingProfile",{"connectorId":0,"csChargingProfiles":{"chargingProfileId":11,"stackLevel":2,"chargingProfileKind":"Relative","chargingProfilePurpose":"TxDefaultProfile","validFrom":"2025-12-23T12:11:09Z","validTo":"2025-12-23T12:11:24Z","chargingSchedule":{"chargingRateUnit":"A","chargingSchedulePeriod":[{"startPeriod":0,"limit":6.2}]}}}]
2025-12-23 13:11:09.872 INFO (MainThread) [ocpp] : receive message [3,"9f890aaf-a29c-4411-b74c-ce709361bb06",{"status":"Accepted"}]
2025-12-23 13:11:10.312 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=6924; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:11:10.310750+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=6929; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:11:10.311261+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:11:10.697 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=6917; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:11:10.696426+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=6910; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:11:10.697202+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:11:10.828 INFO (MainThread) [ocpp] : receive message [2,"531613019","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:11:10.667Z","sampledValue":[{"value":"6.00","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"6.00","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"6.12","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"6.00","measurand":"Current.Offered","unit":"A"},{"value":"17137308.07","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.96","measurand":"Frequency"},{"value":"1343.75","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1330.04","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"1366.06","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"4039.85","measurand":"Power.Active.Import","unit":"W"},{"value":"99.44","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"99.39","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"99.35","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"4140.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"225.06","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"222.89","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"224.75","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.72","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:11:10.839 INFO (MainThread) [ocpp] : send [3,"531613019",{}]
2025-12-23 13:11:15.781 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=6904; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:11:15.780304+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=6900; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:11:15.781099+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:11:15.882 INFO (MainThread) [ocpp] : receive message [2,"531613020","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:11:15.679Z","sampledValue":[{"value":"6.00","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"6.00","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"6.12","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"6.00","measurand":"Current.Offered","unit":"A"},{"value":"17137313.73","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.96","measurand":"Frequency"},{"value":"1346.25","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1333.31","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"1363.58","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"4043.15","measurand":"Power.Active.Import","unit":"W"},{"value":"99.22","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"99.49","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"99.44","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"4140.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"225.99","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"223.20","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"224.13","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.41","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:11:15.894 INFO (MainThread) [ocpp] : send [3,"531613020",{}]
2025-12-23 13:11:19.701 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_min_current: [FrameInfo(frame=<frame at 0x7f801e3120, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 402, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=402, function='get_state_config', code_context=['    state[CONF_MIN_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MIN_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=402, end_lineno=402, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028cdc0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f937e4a40, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f7e282340, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f857ad120, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f7e41d640, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f857ad5d0, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f801ebe20, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f801ebf10, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f7e280900, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f7e41e840, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f7e3b8890, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:11:19.741 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_max_current: [FrameInfo(frame=<frame at 0x7f801e3120, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 403, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=403, function='get_state_config', code_context=['    state[CONF_MAX_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MAX_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=403, end_lineno=403, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028cdc0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f937e4a40, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f7e282340, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f857ad120, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f7e41d640, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f857ad5d0, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f801ebe20, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f801ebf10, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f7e280900, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f7e41e840, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f7e3b8890, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:11:19.741 WARNING (MainThread) [homeassistant.helpers.service] Referenced entities timer.dynamic_ocpp_evse_charge_pause_timer are missing or not currently available
2025-12-23 13:11:19.748 INFO (MainThread) [ocpp] : send [2,"40c11ce1-5b37-421a-bb3e-47325558ebd5","SetChargingProfile",{"connectorId":0,"csChargingProfiles":{"chargingProfileId":11,"stackLevel":2,"chargingProfileKind":"Relative","chargingProfilePurpose":"TxDefaultProfile","validFrom":"2025-12-23T12:11:19Z","validTo":"2025-12-23T12:11:34Z","chargingSchedule":{"chargingRateUnit":"A","chargingSchedulePeriod":[{"startPeriod":0,"limit":0}]}}}]
2025-12-23 13:11:19.844 INFO (MainThread) [ocpp] : receive message [3,"40c11ce1-5b37-421a-bb3e-47325558ebd5",{"status":"Accepted"}]
2025-12-23 13:11:20.910 INFO (MainThread) [ocpp] : receive message [2,"531613021","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:11:20.746Z","sampledValue":[{"value":"6.00","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"0.00","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"0.00","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"0.00","measurand":"Current.Offered","unit":"A"},{"value":"17137319.55","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.96","measurand":"Frequency"},{"value":"1352.69","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"0.00","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"0.00","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"1352.69","measurand":"Power.Active.Import","unit":"W"},{"value":"99.56","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"0.00","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"0.00","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"0.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"226.30","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"223.51","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"223.82","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.41","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:11:20.922 INFO (MainThread) [ocpp] : send [3,"531613021",{}]
2025-12-23 13:11:21.071 INFO (MainThread) [ocpp] : receive message [2,"531613022","StatusNotification",{"connectorId":1,"errorCode":"NoError","status":"SuspendedEVSE","timestamp":"2025-12-23T12:11:20.867Z"}]
2025-12-23 13:11:21.078 INFO (MainThread) [ocpp] : send [3,"531613022",{}]
2025-12-23 13:11:25.313 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=6910; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:11:25.311656+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=6913; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:11:25.312102+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:11:25.756 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=6890; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:11:25.754585+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=6878; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:11:25.755440+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:11:25.975 INFO (MainThread) [ocpp] : receive message [2,"531613023","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:11:25.758Z","sampledValue":[{"value":"0.00","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"0.00","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"0.00","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"0.00","measurand":"Current.Offered","unit":"A"},{"value":"17137319.00","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.98","measurand":"Frequency"},{"value":"0.00","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"0.00","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"0.00","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"0.00","measurand":"Power.Active.Import","unit":"W"},{"value":"0.00","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"0.00","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"0.00","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"0.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"0.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"228.47","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"224.75","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"226.61","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.41","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:11:25.986 INFO (MainThread) [ocpp] : send [3,"531613023",{}]
2025-12-23 13:11:29.702 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_min_current: [FrameInfo(frame=<frame at 0x7f801e3450, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 402, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=402, function='get_state_config', code_context=['    state[CONF_MIN_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MIN_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=402, end_lineno=402, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028cdc0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f937e4a40, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f8d7f8900, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f8cae97b0, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f8258b540, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f857ae7a0, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f857ad120, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f857afe20, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f8d7f9540, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f844b9440, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f7e3b8890, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:11:29.742 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_max_current: [FrameInfo(frame=<frame at 0x7f801e3450, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 403, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=403, function='get_state_config', code_context=['    state[CONF_MAX_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MAX_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=403, end_lineno=403, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028cdc0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f937e4a40, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f8d7f8900, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f8cae97b0, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f8258b540, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f857ae7a0, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f857ad120, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f857afe20, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f8d7f9540, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f844b9440, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f7e3b8890, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:11:29.743 WARNING (MainThread) [homeassistant.helpers.service] Referenced entities timer.dynamic_ocpp_evse_charge_pause_timer are missing or not currently available
2025-12-23 13:11:29.748 INFO (MainThread) [ocpp] : send [2,"7b9e953c-c152-4c67-9a2f-bf65b50585f3","SetChargingProfile",{"connectorId":0,"csChargingProfiles":{"chargingProfileId":11,"stackLevel":2,"chargingProfileKind":"Relative","chargingProfilePurpose":"TxDefaultProfile","validFrom":"2025-12-23T12:11:29Z","validTo":"2025-12-23T12:11:44Z","chargingSchedule":{"chargingRateUnit":"A","chargingSchedulePeriod":[{"startPeriod":0,"limit":0}]}}}]
2025-12-23 13:11:29.893 INFO (MainThread) [ocpp] : receive message [3,"7b9e953c-c152-4c67-9a2f-bf65b50585f3",{"status":"Accepted"}]
2025-12-23 13:11:30.313 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=6928; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:11:30.311446+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=6953; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:11:30.311896+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:11:30.827 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=6962; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:11:30.826088+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=6961; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:11:30.826905+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:11:30.964 INFO (MainThread) [ocpp] : receive message [2,"531613024","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:11:30.785Z","sampledValue":[{"value":"0.00","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"0.00","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"0.00","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"0.00","measurand":"Current.Offered","unit":"A"},{"value":"17137319.00","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"50.00","measurand":"Frequency"},{"value":"0.00","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"0.00","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"0.00","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"0.00","measurand":"Power.Active.Import","unit":"W"},{"value":"0.00","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"0.00","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"0.00","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"0.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"0.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"228.47","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"225.68","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"226.30","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.41","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:11:30.974 INFO (MainThread) [ocpp] : send [3,"531613024",{}]
2025-12-23 13:11:35.312 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=7019; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:11:35.311071+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=7048; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:11:35.311592+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:11:35.761 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=7044; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:11:35.760487+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=7034; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:11:35.761307+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:11:36.051 INFO (MainThread) [ocpp] : receive message [2,"531613025","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:11:35.844Z","sampledValue":[{"value":"0.00","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"0.00","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"0.00","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"0.00","measurand":"Current.Offered","unit":"A"},{"value":"17137319.00","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.99","measurand":"Frequency"},{"value":"0.00","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"0.00","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"0.00","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"0.00","measurand":"Power.Active.Import","unit":"W"},{"value":"0.00","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"0.00","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"0.00","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"0.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"0.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"228.16","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"225.68","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"225.99","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.41","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:11:36.061 INFO (MainThread) [ocpp] : send [3,"531613025",{}]
2025-12-23 13:11:39.703 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_min_current: [FrameInfo(frame=<frame at 0x7f801e3120, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 402, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=402, function='get_state_config', code_context=['    state[CONF_MIN_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MIN_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=402, end_lineno=402, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028d2d0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f937e4b80, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f7e286f80, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f89166e30, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f825b1740, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7fa13bef20, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7fa13bfe20, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f804153f0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f7e2866c0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f7e454b40, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f7e3bbcd0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:11:39.742 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_max_current: [FrameInfo(frame=<frame at 0x7f801e3120, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 403, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=403, function='get_state_config', code_context=['    state[CONF_MAX_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MAX_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=403, end_lineno=403, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028d2d0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f937e4b80, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f7e286f80, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f89166e30, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f825b1740, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7fa13bef20, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7fa13bfe20, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f804153f0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f7e2866c0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f7e454b40, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f7e3bbcd0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:11:39.746 INFO (MainThread) [ocpp] : send [2,"628a5189-a82c-4d74-ac0f-1385e8042e82","SetChargingProfile",{"connectorId":0,"csChargingProfiles":{"chargingProfileId":11,"stackLevel":2,"chargingProfileKind":"Relative","chargingProfilePurpose":"TxDefaultProfile","validFrom":"2025-12-23T12:11:39Z","validTo":"2025-12-23T12:11:54Z","chargingSchedule":{"chargingRateUnit":"A","chargingSchedulePeriod":[{"startPeriod":0,"limit":6.0}]}}}]
2025-12-23 13:11:39.915 INFO (MainThread) [ocpp] : receive message [3,"628a5189-a82c-4d74-ac0f-1385e8042e82",{"status":"Accepted"}]
2025-12-23 13:11:40.314 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=7090; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:11:40.311874+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=7118; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:11:40.312664+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:11:40.628 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=7130; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:11:40.626549+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=7129; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:11:40.627426+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:11:41.109 INFO (MainThread) [ocpp] : receive message [2,"531613026","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:11:40.921Z","sampledValue":[{"value":"0.00","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"0.00","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"0.00","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"0.00","measurand":"Current.Offered","unit":"A"},{"value":"17137319.00","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.99","measurand":"Frequency"},{"value":"0.00","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"0.00","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"0.00","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"0.00","measurand":"Power.Active.Import","unit":"W"},{"value":"0.00","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"0.00","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"0.00","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"0.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"0.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"228.47","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"225.37","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"226.30","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.41","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:11:41.119 INFO (MainThread) [ocpp] : send [3,"531613026",{}]
2025-12-23 13:11:45.313 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=7192; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:11:45.311749+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=7224; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:11:45.312236+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:11:46.218 INFO (MainThread) [ocpp] : receive message [2,"531613027","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:11:46.008Z","sampledValue":[{"value":"0.00","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"0.00","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"0.00","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"0.00","measurand":"Current.Offered","unit":"A"},{"value":"17137319.00","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.99","measurand":"Frequency"},{"value":"0.00","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"0.00","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"0.00","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"0.00","measurand":"Power.Active.Import","unit":"W"},{"value":"0.00","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"0.00","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"0.00","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"0.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"0.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"227.85","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"225.37","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"225.99","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.41","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:11:46.228 INFO (MainThread) [ocpp] : send [3,"531613027",{}]
2025-12-23 13:11:49.704 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_min_current: [FrameInfo(frame=<frame at 0x7f801e3340, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 402, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=402, function='get_state_config', code_context=['    state[CONF_MIN_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MIN_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=402, end_lineno=402, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028d2d0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f8c814180, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f802acd60, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f844a6980, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f7e457b40, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f844a4220, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f873f2d40, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f873f31f0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f7e443ae0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f7e457c40, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f7e3ba770, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:11:49.744 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_max_current: [FrameInfo(frame=<frame at 0x7f801e3340, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 403, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=403, function='get_state_config', code_context=['    state[CONF_MAX_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MAX_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=403, end_lineno=403, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028d2d0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f8c814180, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f802acd60, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f844a6980, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f7e457b40, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f844a4220, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f873f2d40, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f873f31f0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f7e443ae0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f7e457c40, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f7e3ba770, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:11:49.750 INFO (MainThread) [ocpp] : send [2,"de91d5fc-65ab-4fc2-a394-86e08a2b08db","SetChargingProfile",{"connectorId":0,"csChargingProfiles":{"chargingProfileId":11,"stackLevel":2,"chargingProfileKind":"Relative","chargingProfilePurpose":"TxDefaultProfile","validFrom":"2025-12-23T12:11:49Z","validTo":"2025-12-23T12:12:04Z","chargingSchedule":{"chargingRateUnit":"A","chargingSchedulePeriod":[{"startPeriod":0,"limit":6.2}]}}}]
2025-12-23 13:11:49.902 INFO (MainThread) [ocpp] : receive message [3,"de91d5fc-65ab-4fc2-a394-86e08a2b08db",{"status":"Accepted"}]
2025-12-23 13:11:50.314 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=7305; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:11:50.311120+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=7338; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:11:50.311739+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:11:51.275 INFO (MainThread) [ocpp] : receive message [2,"531613028","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:11:51.109Z","sampledValue":[{"value":"0.00","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"0.00","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"0.00","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"0.00","measurand":"Current.Offered","unit":"A"},{"value":"17137319.00","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.99","measurand":"Frequency"},{"value":"0.00","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"0.00","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"0.00","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"0.00","measurand":"Power.Active.Import","unit":"W"},{"value":"0.00","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"0.00","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"0.00","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"0.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"0.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"227.85","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"225.06","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"225.99","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.41","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:11:51.284 INFO (MainThread) [ocpp] : send [3,"531613028",{}]
2025-12-23 13:11:51.906 INFO (MainThread) [ocpp] : receive message [2,"531613029","StatusNotification",{"connectorId":1,"errorCode":"NoError","status":"SuspendedEV","timestamp":"2025-12-23T12:11:51.753Z"}]
2025-12-23 13:11:51.912 INFO (MainThread) [ocpp] : send [3,"531613029",{}]
2025-12-23 13:11:54.520 INFO (MainThread) [ocpp] : receive message [2,"531613030","StatusNotification",{"connectorId":1,"errorCode":"NoError","status":"Charging","timestamp":"2025-12-23T12:11:54.304Z"}]
2025-12-23 13:11:54.527 INFO (MainThread) [ocpp] : send [3,"531613030",{}]
2025-12-23 13:11:55.313 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=7433; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:11:55.311763+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=7472; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:11:55.312316+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:11:56.362 INFO (MainThread) [ocpp] : receive message [2,"531613031","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:11:56.150Z","sampledValue":[{"value":"0.27","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"0.27","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"0.15","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"6.00","measurand":"Current.Offered","unit":"A"},{"value":"17137319.00","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.97","measurand":"Frequency"},{"value":"-7.97","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"-8.48","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"4.25","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"-12.21","measurand":"Power.Active.Import","unit":"W"},{"value":"0.00","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"0.00","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"12.37","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"4140.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"228.47","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"225.68","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"225.99","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.41","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:11:56.374 INFO (MainThread) [ocpp] : send [3,"531613031",{}]
2025-12-23 13:11:59.705 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_min_current: [FrameInfo(frame=<frame at 0x7f801e3120, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 402, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=402, function='get_state_config', code_context=['    state[CONF_MIN_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MIN_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=402, end_lineno=402, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028d2d0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f801cfec0, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f7e2866c0, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f844a6980, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f7e454640, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f9fc4f1f0, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f857ae3e0, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f7e5adc60, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f7e285700, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f7e457c40, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f7e3ba770, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:11:59.744 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_max_current: [FrameInfo(frame=<frame at 0x7f801e3120, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 403, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=403, function='get_state_config', code_context=['    state[CONF_MAX_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MAX_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=403, end_lineno=403, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028d2d0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f801cfec0, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f7e2866c0, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f844a6980, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f7e454640, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f9fc4f1f0, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f857ae3e0, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f7e5adc60, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f7e285700, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f7e457c40, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f7e3ba770, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:11:59.747 INFO (MainThread) [ocpp] : send [2,"35fda6d9-a21c-4a05-a0f0-0baf9b9ab7d8","SetChargingProfile",{"connectorId":0,"csChargingProfiles":{"chargingProfileId":11,"stackLevel":2,"chargingProfileKind":"Relative","chargingProfilePurpose":"TxDefaultProfile","validFrom":"2025-12-23T12:11:59Z","validTo":"2025-12-23T12:12:14Z","chargingSchedule":{"chargingRateUnit":"A","chargingSchedulePeriod":[{"startPeriod":0,"limit":6.7}]}}}]
2025-12-23 13:11:59.995 INFO (MainThread) [ocpp] : receive message [3,"35fda6d9-a21c-4a05-a0f0-0baf9b9ab7d8",{"status":"Accepted"}]
2025-12-23 13:12:00.185 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=7463; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:12:00.184080+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=7448; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:12:00.184964+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:12:00.311 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=7544; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:12:00.310298+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=7592; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:12:00.311000+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:12:01.360 INFO (MainThread) [ocpp] : receive message [2,"531613032","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:12:01.200Z","sampledValue":[{"value":"0.38","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"0.27","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"0.15","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"6.00","measurand":"Current.Offered","unit":"A"},{"value":"17137319.00","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.94","measurand":"Frequency"},{"value":"-3.67","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"-8.70","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"4.22","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"-8.14","measurand":"Power.Active.Import","unit":"W"},{"value":"0.00","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"0.00","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"12.29","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"4140.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"228.47","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"225.37","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"225.99","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.41","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:12:01.372 INFO (MainThread) [ocpp] : send [3,"531613032",{}]
2025-12-23 13:12:05.314 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=7684; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:12:05.311294+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=7730; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:12:05.312073+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:12:05.691 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=7785; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:12:05.689798+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=7801; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:12:05.690610+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:12:06.474 INFO (MainThread) [ocpp] : receive message [2,"531613033","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:12:06.264Z","sampledValue":[{"value":"3.46","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"0.30","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"0.15","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"6.00","measurand":"Current.Offered","unit":"A"},{"value":"17137319.44","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.94","measurand":"Frequency"},{"value":"758.38","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"-7.53","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"4.26","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"755.11","measurand":"Power.Active.Import","unit":"W"},{"value":"96.78","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"0.00","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"12.38","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"4140.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"226.61","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"225.37","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"226.30","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.72","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:12:06.485 INFO (MainThread) [ocpp] : send [3,"531613033",{}]
2025-12-23 13:12:09.705 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_min_current: [FrameInfo(frame=<frame at 0x7f7e4698b0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 402, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=402, function='get_state_config', code_context=['    state[CONF_MIN_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MIN_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=402, end_lineno=402, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028d2d0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f8036cf40, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f7e2c2180, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f801ebc40, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f7e457740, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f873f31f0, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f7e5ad5d0, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f7e5acc70, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f7e2c35a0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f7e2ec840, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f7e3ba770, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:12:09.745 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_max_current: [FrameInfo(frame=<frame at 0x7f7e4698b0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 403, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=403, function='get_state_config', code_context=['    state[CONF_MAX_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MAX_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=403, end_lineno=403, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028d2d0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f8036cf40, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f7e2c2180, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f801ebc40, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f7e457740, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f873f31f0, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f7e5ad5d0, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f7e5acc70, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f7e2c35a0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f7e2ec840, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f7e3ba770, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:12:09.750 INFO (MainThread) [ocpp] : send [2,"8c2857c5-4889-4e93-ab05-86297a1c90c8","SetChargingProfile",{"connectorId":0,"csChargingProfiles":{"chargingProfileId":11,"stackLevel":2,"chargingProfileKind":"Relative","chargingProfilePurpose":"TxDefaultProfile","validFrom":"2025-12-23T12:12:09Z","validTo":"2025-12-23T12:12:24Z","chargingSchedule":{"chargingRateUnit":"A","chargingSchedulePeriod":[{"startPeriod":0,"limit":7.2}]}}}]
2025-12-23 13:12:09.865 INFO (MainThread) [ocpp] : receive message [3,"8c2857c5-4889-4e93-ab05-86297a1c90c8",{"status":"Accepted"}]
2025-12-23 13:12:10.313 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=7882; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:12:10.311541+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=7922; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:12:10.312022+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:12:10.697 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=7920; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:12:10.696038+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=7909; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:12:10.696863+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:12:11.467 INFO (MainThread) [ocpp] : receive message [2,"531613034","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:12:11.275Z","sampledValue":[{"value":"6.12","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"5.97","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"0.19","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"7.00","measurand":"Current.Offered","unit":"A"},{"value":"17137321.65","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.94","measurand":"Frequency"},{"value":"1366.45","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1318.25","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"3.85","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"2688.55","measurand":"Power.Active.Import","unit":"W"},{"value":"98.97","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"99.27","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"8.96","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"4830.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"225.68","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"222.58","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"225.99","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"4.65","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:12:11.478 INFO (MainThread) [ocpp] : send [3,"531613034",{}]
2025-12-23 13:12:15.313 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=7947; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:12:15.311295+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=7966; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:12:15.311785+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:12:15.761 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=7959; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:12:15.760158+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=7950; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:12:15.760972+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:12:16.510 INFO (MainThread) [ocpp] : receive message [2,"531613035","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:12:16.294Z","sampledValue":[{"value":"6.99","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"6.95","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"0.87","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"7.00","measurand":"Current.Offered","unit":"A"},{"value":"17137326.00","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.94","measurand":"Frequency"},{"value":"1572.79","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1539.55","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"38.05","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"3150.38","measurand":"Power.Active.Import","unit":"W"},{"value":"99.54","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"99.60","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"19.26","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"4830.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"225.99","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"222.27","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"225.99","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"4.65","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:12:16.522 INFO (MainThread) [ocpp] : send [3,"531613035",{}]
2025-12-23 13:12:19.707 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_min_current: [FrameInfo(frame=<frame at 0x7f801e3120, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 402, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=402, function='get_state_config', code_context=['    state[CONF_MIN_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MIN_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=402, end_lineno=402, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028d2d0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f860c6340, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f7e367840, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f801ea5c0, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f7e41fc40, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f801ebf10, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f7e5ae890, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f7e5ace50, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f7e367760, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f7e457e40, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f7e3bbcd0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:12:19.747 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_max_current: [FrameInfo(frame=<frame at 0x7f801e3120, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 403, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=403, function='get_state_config', code_context=['    state[CONF_MAX_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MAX_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=403, end_lineno=403, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028d2d0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f860c6340, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f7e367840, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f801ea5c0, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f7e41fc40, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f801ebf10, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f7e5ae890, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f7e5ace50, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f7e367760, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f7e457e40, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f7e3bbcd0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:12:19.754 INFO (MainThread) [ocpp] : send [2,"0154139f-ce50-4ffa-8934-f6ce69a4cc26","SetChargingProfile",{"connectorId":0,"csChargingProfiles":{"chargingProfileId":11,"stackLevel":2,"chargingProfileKind":"Relative","chargingProfilePurpose":"TxDefaultProfile","validFrom":"2025-12-23T12:12:19Z","validTo":"2025-12-23T12:12:34Z","chargingSchedule":{"chargingRateUnit":"A","chargingSchedulePeriod":[{"startPeriod":0,"limit":7.7}]}}}]
2025-12-23 13:12:19.965 INFO (MainThread) [ocpp] : receive message [3,"0154139f-ce50-4ffa-8934-f6ce69a4cc26",{"status":"Accepted"}]
2025-12-23 13:12:20.312 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=7980; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:12:20.311074+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=7995; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:12:20.311557+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:12:20.859 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=8175; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:12:20.858418+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=8261; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:12:20.859251+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:12:21.586 INFO (MainThread) [ocpp] : receive message [2,"531613036","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:12:21.412Z","sampledValue":[{"value":"7.03","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"6.99","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"7.11","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"7.00","measurand":"Current.Offered","unit":"A"},{"value":"17137332.47","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.95","measurand":"Frequency"},{"value":"1576.37","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1544.65","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"1583.77","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"4704.79","measurand":"Power.Active.Import","unit":"W"},{"value":"99.22","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"99.53","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"99.72","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"4830.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"225.99","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"221.96","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"223.51","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.72","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:12:21.598 INFO (MainThread) [ocpp] : send [3,"531613036",{}]
2025-12-23 13:12:25.312 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=8334; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:12:25.310561+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=8371; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:12:25.311045+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:12:25.732 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=8387; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:12:25.730857+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=8386; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:12:25.731685+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:12:26.694 INFO (MainThread) [ocpp] : receive message [2,"531613037","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:12:26.491Z","sampledValue":[{"value":"6.99","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"6.99","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"7.11","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"7.00","measurand":"Current.Offered","unit":"A"},{"value":"17137339.07","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.96","measurand":"Frequency"},{"value":"1568.48","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1546.88","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"1580.93","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"4696.29","measurand":"Power.Active.Import","unit":"W"},{"value":"99.54","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"99.67","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"99.68","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"4830.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"225.37","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"221.96","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"223.20","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.72","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:12:26.706 INFO (MainThread) [ocpp] : send [3,"531613037",{}]
2025-12-23 13:12:29.707 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_min_current: [FrameInfo(frame=<frame at 0x7f801e3450, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 402, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=402, function='get_state_config', code_context=['    state[CONF_MIN_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MIN_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=402, end_lineno=402, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028d2d0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f937e4b80, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f7e286960, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f7e5adb70, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f7e457140, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f7e5adc60, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f7e5af5b0, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f7e5af970, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f7e287840, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f7e457740, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f7e3bbcd0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:12:29.754 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_max_current: [FrameInfo(frame=<frame at 0x7f801e3450, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 403, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=403, function='get_state_config', code_context=['    state[CONF_MAX_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MAX_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=403, end_lineno=403, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028d2d0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f937e4b80, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f7e286960, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f7e5adb70, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f7e457140, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f7e5adc60, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f7e5af5b0, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f7e5af970, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f7e287840, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f7e457740, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f7e3bbcd0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:12:29.760 INFO (MainThread) [ocpp] : send [2,"8f925ef9-6097-40a5-879b-3f0b35df653c","SetChargingProfile",{"connectorId":0,"csChargingProfiles":{"chargingProfileId":11,"stackLevel":2,"chargingProfileKind":"Relative","chargingProfilePurpose":"TxDefaultProfile","validFrom":"2025-12-23T12:12:29Z","validTo":"2025-12-23T12:12:44Z","chargingSchedule":{"chargingRateUnit":"A","chargingSchedulePeriod":[{"startPeriod":0,"limit":7.9}]}}}]
2025-12-23 13:12:30.006 INFO (MainThread) [ocpp] : receive message [3,"8f925ef9-6097-40a5-879b-3f0b35df653c",{"status":"Accepted"}]
2025-12-23 13:12:30.313 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=8417; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:12:30.311018+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=8433; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:12:30.311612+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:12:30.726 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=8312; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:12:30.724617+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=8248; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:12:30.725438+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:12:31.771 INFO (MainThread) [ocpp] : receive message [2,"531613038","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:12:31.607Z","sampledValue":[{"value":"6.92","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"6.92","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"7.07","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"7.00","measurand":"Current.Offered","unit":"A"},{"value":"17137345.63","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.97","measurand":"Frequency"},{"value":"1553.96","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1536.99","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"1570.46","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"4661.41","measurand":"Power.Active.Import","unit":"W"},{"value":"99.70","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"99.85","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"99.41","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"4830.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"225.37","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"222.58","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"223.51","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.72","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:12:31.784 INFO (MainThread) [ocpp] : send [3,"531613038",{}]
2025-12-23 13:12:35.766 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=8218; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:12:35.764446+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=8206; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:12:35.765548+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:12:36.942 INFO (MainThread) [ocpp] : receive message [2,"531613039","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:12:36.681Z","sampledValue":[{"value":"6.95","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"6.92","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"7.07","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"7.00","measurand":"Current.Offered","unit":"A"},{"value":"17137352.16","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.97","measurand":"Frequency"},{"value":"1562.42","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1535.67","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"1571.82","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"4669.91","measurand":"Power.Active.Import","unit":"W"},{"value":"99.56","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"99.90","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"99.36","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"4830.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"225.68","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"222.27","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"223.82","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.72","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:12:36.954 INFO (MainThread) [ocpp] : send [3,"531613039",{}]
2025-12-23 13:12:39.708 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_min_current: [FrameInfo(frame=<frame at 0x7f801e3120, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 402, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=402, function='get_state_config', code_context=['    state[CONF_MIN_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MIN_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=402, end_lineno=402, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028cdc0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f860c6340, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f7e2858c0, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f7e5af6a0, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f7e457740, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f7e5ae7a0, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f7e5af100, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f7e5af5b0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f7e284ac0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f7e457140, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f7e3bbcd0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:12:39.749 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_max_current: [FrameInfo(frame=<frame at 0x7f801e3120, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 403, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=403, function='get_state_config', code_context=['    state[CONF_MAX_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MAX_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=403, end_lineno=403, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028cdc0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f860c6340, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f7e2858c0, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f7e5af6a0, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f7e457740, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f7e5ae7a0, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f7e5af100, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f7e5af5b0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f7e284ac0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f7e457140, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f7e3bbcd0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:12:39.754 INFO (MainThread) [ocpp] : send [2,"fcd3be50-2231-4a44-a1e1-7db829417640","SetChargingProfile",{"connectorId":0,"csChargingProfiles":{"chargingProfileId":11,"stackLevel":2,"chargingProfileKind":"Relative","chargingProfilePurpose":"TxDefaultProfile","validFrom":"2025-12-23T12:12:39Z","validTo":"2025-12-23T12:12:54Z","chargingSchedule":{"chargingRateUnit":"A","chargingSchedulePeriod":[{"startPeriod":0,"limit":7.9}]}}}]
2025-12-23 13:12:39.884 INFO (MainThread) [ocpp] : receive message [3,"fcd3be50-2231-4a44-a1e1-7db829417640",{"status":"Accepted"}]
2025-12-23 13:12:40.313 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=8230; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:12:40.311346+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=8242; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:12:40.311918+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:12:40.797 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=8238; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:12:40.795547+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=8233; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:12:40.796398+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:12:41.895 INFO (MainThread) [ocpp] : receive message [2,"531613040","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:12:41.722Z","sampledValue":[{"value":"6.95","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"6.92","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"7.07","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"7.00","measurand":"Current.Offered","unit":"A"},{"value":"17137358.68","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.97","measurand":"Frequency"},{"value":"1564.69","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1532.49","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"1571.92","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"4669.11","measurand":"Power.Active.Import","unit":"W"},{"value":"99.56","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"99.69","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"99.37","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"4830.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"225.99","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"222.27","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"223.82","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.72","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:12:41.908 INFO (MainThread) [ocpp] : send [3,"531613040",{}]
2025-12-23 13:12:45.312 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=8250; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:12:45.310928+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=8258; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:12:45.311496+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:12:47.059 INFO (MainThread) [ocpp] : receive message [2,"531613041","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:12:46.851Z","sampledValue":[{"value":"6.95","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"6.92","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"7.07","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"7.00","measurand":"Current.Offered","unit":"A"},{"value":"17137365.32","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.97","measurand":"Frequency"},{"value":"1564.05","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1534.69","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"1574.67","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"4673.41","measurand":"Power.Active.Import","unit":"W"},{"value":"99.52","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"99.84","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"99.68","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"4830.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"225.99","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"222.27","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"223.51","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.72","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:12:47.070 INFO (MainThread) [ocpp] : send [3,"531613041",{}]
2025-12-23 13:12:49.709 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_min_current: [FrameInfo(frame=<frame at 0x7f801e3450, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 402, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=402, function='get_state_config', code_context=['    state[CONF_MIN_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MIN_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=402, end_lineno=402, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028d2d0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f937e4b80, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f7e2c1e00, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f7e5ae2f0, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f7e457440, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f7e5ace50, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f7e5acc70, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f7e5ada80, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f7e2c3a00, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f7e457e40, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f7e3ba770, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:12:49.749 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_max_current: [FrameInfo(frame=<frame at 0x7f801e3450, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 403, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=403, function='get_state_config', code_context=['    state[CONF_MAX_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MAX_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=403, end_lineno=403, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028d2d0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f937e4b80, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f7e2c1e00, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f7e5ae2f0, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f7e457440, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f7e5ace50, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f7e5acc70, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f7e5ada80, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f7e2c3a00, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f7e457e40, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f7e3ba770, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:12:49.753 INFO (MainThread) [ocpp] : send [2,"d40be42f-48c5-4966-b2f3-d30a6b75ae10","SetChargingProfile",{"connectorId":0,"csChargingProfiles":{"chargingProfileId":11,"stackLevel":2,"chargingProfileKind":"Relative","chargingProfilePurpose":"TxDefaultProfile","validFrom":"2025-12-23T12:12:49Z","validTo":"2025-12-23T12:13:04Z","chargingSchedule":{"chargingRateUnit":"A","chargingSchedulePeriod":[{"startPeriod":0,"limit":7.8}]}}}]
2025-12-23 13:12:49.976 INFO (MainThread) [ocpp] : receive message [3,"d40be42f-48c5-4966-b2f3-d30a6b75ae10",{"status":"Accepted"}]
2025-12-23 13:12:50.313 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=8299; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:12:50.311189+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=8317; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:12:50.311690+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:12:50.736 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=8317; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:12:50.734584+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=8312; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:12:50.735380+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:12:52.052 INFO (MainThread) [ocpp] : receive message [2,"531613042","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:12:51.891Z","sampledValue":[{"value":"6.92","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"6.92","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"7.03","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"7.00","measurand":"Current.Offered","unit":"A"},{"value":"17137371.85","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.96","measurand":"Frequency"},{"value":"1562.67","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1534.54","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"1567.46","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"4664.68","measurand":"Power.Active.Import","unit":"W"},{"value":"99.85","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"99.83","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"99.62","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"4830.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"226.30","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"222.27","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"223.82","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.72","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:12:52.064 INFO (MainThread) [ocpp] : send [3,"531613042",{}]
2025-12-23 13:12:55.313 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=8332; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:12:55.311318+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=8342; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:12:55.311818+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:12:57.162 INFO (MainThread) [ocpp] : receive message [2,"531613043","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:12:56.960Z","sampledValue":[{"value":"7.03","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"6.99","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"7.11","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"7.00","measurand":"Current.Offered","unit":"A"},{"value":"17137378.47","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.96","measurand":"Frequency"},{"value":"1583.04","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1544.95","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"1584.54","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"4712.53","measurand":"Power.Active.Import","unit":"W"},{"value":"99.10","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"99.41","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"99.63","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"4830.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"227.23","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"222.27","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"223.82","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.72","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:12:57.173 INFO (MainThread) [ocpp] : send [3,"531613043",{}]
2025-12-23 13:12:59.709 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_min_current: [FrameInfo(frame=<frame at 0x7f801e3120, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 402, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=402, function='get_state_config', code_context=['    state[CONF_MIN_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MIN_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=402, end_lineno=402, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028d2d0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f8c814180, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f7e2e9620, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f802e45e0, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f7e457440, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f89166e30, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f7e5ae2f0, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f7e5ae3e0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f7e2eaa40, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f7e457b40, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f7e3ba770, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:12:59.749 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_max_current: [FrameInfo(frame=<frame at 0x7f801e3120, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 403, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=403, function='get_state_config', code_context=['    state[CONF_MAX_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MAX_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=403, end_lineno=403, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028d2d0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f8c814180, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f7e2e9620, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f802e45e0, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f7e457440, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f89166e30, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f7e5ae2f0, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f7e5ae3e0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f7e2eaa40, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f7e457b40, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f7e3ba770, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:12:59.754 INFO (MainThread) [ocpp] : send [2,"ef3f126e-7058-418c-928a-be73c5d84031","SetChargingProfile",{"connectorId":0,"csChargingProfiles":{"chargingProfileId":11,"stackLevel":2,"chargingProfileKind":"Relative","chargingProfilePurpose":"TxDefaultProfile","validFrom":"2025-12-23T12:12:59Z","validTo":"2025-12-23T12:13:14Z","chargingSchedule":{"chargingRateUnit":"A","chargingSchedulePeriod":[{"startPeriod":0,"limit":8.0}]}}}]
2025-12-23 13:12:59.967 INFO (MainThread) [ocpp] : receive message [3,"ef3f126e-7058-418c-928a-be73c5d84031",{"status":"Accepted"}]
2025-12-23 13:13:00.186 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=8206; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:13:00.184538+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=8135; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:13:00.185458+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:13:00.311 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=8268; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:13:00.310517+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=8334; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:13:00.311247+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:13:00.864 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=8382; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:13:00.863176+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=8406; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:13:00.863983+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:13:02.238 INFO (MainThread) [ocpp] : receive message [2,"531613044","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:13:02.060Z","sampledValue":[{"value":"7.07","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"6.99","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"7.30","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"8.00","measurand":"Current.Offered","unit":"A"},{"value":"17137385.09","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.96","measurand":"Frequency"},{"value":"1592.02","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1543.69","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"1625.35","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"4761.06","measurand":"Power.Active.Import","unit":"W"},{"value":"99.13","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"99.47","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"99.53","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"5520.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"227.23","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"221.96","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"223.82","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.72","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:13:02.250 INFO (MainThread) [ocpp] : send [3,"531613044",{}]
2025-12-23 13:13:05.312 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=8460; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:13:05.310229+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=8487; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:13:05.310724+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:13:05.721 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=8492; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:13:05.720199+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=8488; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:13:05.721036+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:13:07.266 INFO (MainThread) [ocpp] : receive message [2,"531613045","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:13:07.062Z","sampledValue":[{"value":"7.98","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"7.94","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"8.06","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"8.00","measurand":"Current.Offered","unit":"A"},{"value":"17137392.45","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.96","measurand":"Frequency"},{"value":"1794.12","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1757.31","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"1796.17","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"5347.60","measurand":"Power.Active.Import","unit":"W"},{"value":"99.21","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"99.83","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"99.89","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"5520.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"226.61","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"221.65","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"223.20","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.72","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:13:07.277 INFO (MainThread) [ocpp] : send [3,"531613045",{}]
2025-12-23 13:13:09.710 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_min_current: [FrameInfo(frame=<frame at 0x7f801e3450, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 402, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=402, function='get_state_config', code_context=['    state[CONF_MIN_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MIN_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=402, end_lineno=402, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028d480, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f937e4b80, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f7e2e9620, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f7e5aeb60, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f7e457b40, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f7e5aec50, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f7e5af790, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f7e5ae3e0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f7e2ea6c0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f7e457440, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f7e3ba770, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:13:09.751 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_max_current: [FrameInfo(frame=<frame at 0x7f801e3450, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 403, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=403, function='get_state_config', code_context=['    state[CONF_MAX_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MAX_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=403, end_lineno=403, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028d480, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f937e4b80, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f7e2e9620, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f7e5aeb60, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f7e457b40, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f7e5aec50, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f7e5af790, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f7e5ae3e0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f7e2ea6c0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f7e457440, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f7e3ba770, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:13:09.756 INFO (MainThread) [ocpp] : send [2,"d1a084d8-ce20-4d7c-835b-692a4eebab6c","SetChargingProfile",{"connectorId":0,"csChargingProfiles":{"chargingProfileId":11,"stackLevel":2,"chargingProfileKind":"Relative","chargingProfilePurpose":"TxDefaultProfile","validFrom":"2025-12-23T12:13:09Z","validTo":"2025-12-23T12:13:24Z","chargingSchedule":{"chargingRateUnit":"A","chargingSchedulePeriod":[{"startPeriod":0,"limit":8.1}]}}}]
2025-12-23 13:13:09.966 INFO (MainThread) [ocpp] : receive message [3,"d1a084d8-ce20-4d7c-835b-692a4eebab6c",{"status":"Accepted"}]
2025-12-23 13:13:10.314 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=8515; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:13:10.312108+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=8528; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:13:10.312830+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:13:10.725 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=8522; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:13:10.723796+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=8516; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:13:10.724626+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:13:12.325 INFO (MainThread) [ocpp] : receive message [2,"531613046","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:13:12.161Z","sampledValue":[{"value":"7.98","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"7.94","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"8.06","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"8.00","measurand":"Current.Offered","unit":"A"},{"value":"17137399.92","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.96","measurand":"Frequency"},{"value":"1791.24","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1752.85","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"1801.36","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"5345.45","measurand":"Power.Active.Import","unit":"W"},{"value":"99.33","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"99.71","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"5520.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"225.99","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"221.34","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"223.51","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.72","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:13:12.336 INFO (MainThread) [ocpp] : send [3,"531613046",{}]
2025-12-23 13:13:15.312 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=8527; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:13:15.310737+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=8532; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:13:15.311223+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:13:15.761 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=8382; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:13:15.760365+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=8305; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:13:15.761235+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:13:17.474 INFO (MainThread) [ocpp] : receive message [2,"531613047","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:13:17.263Z","sampledValue":[{"value":"7.94","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"7.94","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"8.06","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"8.00","measurand":"Current.Offered","unit":"A"},{"value":"17137407.53","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.97","measurand":"Frequency"},{"value":"1783.03","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1751.76","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"1800.13","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"5334.92","measurand":"Power.Active.Import","unit":"W"},{"value":"99.62","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"99.79","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"99.70","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"5520.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"225.37","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"221.03","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"224.13","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.72","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:13:17.486 INFO (MainThread) [ocpp] : send [3,"531613047",{}]
2025-12-23 13:13:19.711 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_min_current: [FrameInfo(frame=<frame at 0x7f801e3120, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 402, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=402, function='get_state_config', code_context=['    state[CONF_MIN_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MIN_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=402, end_lineno=402, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028d2d0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f801cfec0, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f7e283ae0, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f801ebb50, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f7e41f440, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f801ebc40, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f7e5ad4e0, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f7e5ae890, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f7e2804a0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f7e41c540, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f7e3bbcd0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:13:19.750 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_max_current: [FrameInfo(frame=<frame at 0x7f801e3120, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 403, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=403, function='get_state_config', code_context=['    state[CONF_MAX_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MAX_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=403, end_lineno=403, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028d2d0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f801cfec0, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f7e283ae0, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f801ebb50, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f7e41f440, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f801ebc40, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f7e5ad4e0, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f7e5ae890, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f7e2804a0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f7e41c540, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f7e3bbcd0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:13:19.757 INFO (MainThread) [ocpp] : send [2,"6e5ef52f-45a3-433c-889a-ee2461c59d2f","SetChargingProfile",{"connectorId":0,"csChargingProfiles":{"chargingProfileId":11,"stackLevel":2,"chargingProfileKind":"Relative","chargingProfilePurpose":"TxDefaultProfile","validFrom":"2025-12-23T12:13:19Z","validTo":"2025-12-23T12:13:34Z","chargingSchedule":{"chargingRateUnit":"A","chargingSchedulePeriod":[{"startPeriod":0,"limit":8.2}]}}}]
2025-12-23 13:13:19.966 INFO (MainThread) [ocpp] : receive message [3,"6e5ef52f-45a3-433c-889a-ee2461c59d2f",{"status":"Accepted"}]
2025-12-23 13:13:20.312 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=8292; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:13:20.310901+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=8286; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:13:20.311392+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:13:20.746 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=8264; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:13:20.745170+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=8254; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:13:20.746054+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:13:22.467 INFO (MainThread) [ocpp] : receive message [2,"531613048","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:13:22.269Z","sampledValue":[{"value":"7.94","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"7.94","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"8.06","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"8.00","measurand":"Current.Offered","unit":"A"},{"value":"17137415.09","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.97","measurand":"Frequency"},{"value":"1793.38","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1751.71","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"1796.77","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"5341.86","measurand":"Power.Active.Import","unit":"W"},{"value":"99.78","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"99.51","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"99.65","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"5520.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"226.30","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"221.65","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"223.82","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.72","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:13:22.482 INFO (MainThread) [ocpp] : send [3,"531613048",{}]
2025-12-23 13:13:25.742 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=8299; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:13:25.741271+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=8318; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:13:25.742096+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:13:27.550 INFO (MainThread) [ocpp] : receive message [2,"531613049","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:13:27.314Z","sampledValue":[{"value":"7.94","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"7.94","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"8.06","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"8.00","measurand":"Current.Offered","unit":"A"},{"value":"17137421.98","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.96","measurand":"Frequency"},{"value":"1792.07","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1749.07","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"1793.10","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"5334.24","measurand":"Power.Active.Import","unit":"W"},{"value":"99.85","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"99.50","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"99.72","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"5520.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"225.99","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"221.34","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"223.20","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.72","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:13:27.561 INFO (MainThread) [ocpp] : send [3,"531613049",{}]
2025-12-23 13:13:29.713 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_min_current: [FrameInfo(frame=<frame at 0x7f801e3120, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 402, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=402, function='get_state_config', code_context=['    state[CONF_MIN_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MIN_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=402, end_lineno=402, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028d2d0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f8c814180, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f7e643e60, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f802e4400, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f7e41c540, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f802e4a90, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f7e5ae980, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f7e5ad7b0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f7e640900, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f7e41d840, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f7e3bbcd0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:13:29.753 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_max_current: [FrameInfo(frame=<frame at 0x7f801e3120, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 403, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=403, function='get_state_config', code_context=['    state[CONF_MAX_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MAX_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=403, end_lineno=403, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028d2d0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f8c814180, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f7e643e60, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f802e4400, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f7e41c540, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f802e4a90, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f7e5ae980, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f7e5ad7b0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f7e640900, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f7e41d840, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f7e3bbcd0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:13:29.758 INFO (MainThread) [ocpp] : send [2,"fb36bc71-1568-40f5-a132-403fda73a284","SetChargingProfile",{"connectorId":0,"csChargingProfiles":{"chargingProfileId":11,"stackLevel":2,"chargingProfileKind":"Relative","chargingProfilePurpose":"TxDefaultProfile","validFrom":"2025-12-23T12:13:29Z","validTo":"2025-12-23T12:13:44Z","chargingSchedule":{"chargingRateUnit":"A","chargingSchedulePeriod":[{"startPeriod":0,"limit":7.9}]}}}]
2025-12-23 13:13:29.968 INFO (MainThread) [ocpp] : receive message [3,"fb36bc71-1568-40f5-a132-403fda73a284",{"status":"Accepted"}]
2025-12-23 13:13:30.313 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=8359; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:13:30.311296+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=8380; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:13:30.311786+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:13:30.686 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=8415; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:13:30.684999+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=8428; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:13:30.685812+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:13:32.590 INFO (MainThread) [ocpp] : receive message [2,"531613050","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:13:32.407Z","sampledValue":[{"value":"7.03","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"6.99","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"7.07","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"7.00","measurand":"Current.Offered","unit":"A"},{"value":"17137429.19","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.95","measurand":"Frequency"},{"value":"1584.44","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1542.59","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"1583.82","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"4710.85","measurand":"Power.Active.Import","unit":"W"},{"value":"99.19","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"99.68","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"4830.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"227.23","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"221.34","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"223.82","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.72","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:13:32.601 INFO (MainThread) [ocpp] : send [3,"531613050",{}]
2025-12-23 13:13:35.312 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=8470; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:13:35.310481+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=8491; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:13:35.310981+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:13:35.770 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=8486; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:13:35.769295+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=8478; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:13:35.770118+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:13:37.614 INFO (MainThread) [ocpp] : receive message [2,"531613051","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:13:37.407Z","sampledValue":[{"value":"7.03","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"6.99","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"7.11","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"7.00","measurand":"Current.Offered","unit":"A"},{"value":"17137435.81","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.95","measurand":"Frequency"},{"value":"1585.20","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1545.84","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"1591.62","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"4722.66","measurand":"Power.Active.Import","unit":"W"},{"value":"99.23","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"99.61","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"99.80","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"4830.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"227.23","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"221.96","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"224.44","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.72","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:13:37.626 INFO (MainThread) [ocpp] : send [3,"531613051",{}]
2025-12-23 13:13:39.712 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_min_current: [FrameInfo(frame=<frame at 0x7f801e3120, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 402, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=402, function='get_state_config', code_context=['    state[CONF_MIN_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MIN_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=402, end_lineno=402, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028d2d0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f937e4b80, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f7e286500, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f801ebb50, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f7e41c240, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f8ab4b790, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f7e5ad7b0, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f7e5ae200, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f7e285ee0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f7e41f340, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f7e3bbcd0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:13:39.753 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_max_current: [FrameInfo(frame=<frame at 0x7f801e3120, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 403, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=403, function='get_state_config', code_context=['    state[CONF_MAX_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MAX_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=403, end_lineno=403, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028d2d0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f937e4b80, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f7e286500, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f801ebb50, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f7e41c240, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f8ab4b790, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f7e5ad7b0, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f7e5ae200, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f7e285ee0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f7e41f340, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f7e3bbcd0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:13:39.758 INFO (MainThread) [ocpp] : send [2,"b945a38a-cb13-4dd7-a17a-eacc7fc65071","SetChargingProfile",{"connectorId":0,"csChargingProfiles":{"chargingProfileId":11,"stackLevel":2,"chargingProfileKind":"Relative","chargingProfilePurpose":"TxDefaultProfile","validFrom":"2025-12-23T12:13:39Z","validTo":"2025-12-23T12:13:54Z","chargingSchedule":{"chargingRateUnit":"A","chargingSchedulePeriod":[{"startPeriod":0,"limit":8.2}]}}}]
2025-12-23 13:13:39.967 INFO (MainThread) [ocpp] : receive message [3,"b945a38a-cb13-4dd7-a17a-eacc7fc65071",{"status":"Accepted"}]
2025-12-23 13:13:40.312 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=8537; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:13:40.310554+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=8566; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:13:40.311033+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:13:40.624 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=8565; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:13:40.623237+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=8557; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:13:40.624072+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:13:42.689 INFO (MainThread) [ocpp] : receive message [2,"531613052","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:13:42.497Z","sampledValue":[{"value":"7.87","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"7.56","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"8.02","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"8.00","measurand":"Current.Offered","unit":"A"},{"value":"17137442.58","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.95","measurand":"Frequency"},{"value":"1780.05","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1674.84","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"1794.63","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"5249.52","measurand":"Power.Active.Import","unit":"W"},{"value":"99.45","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"99.92","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"5520.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"227.54","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"221.65","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"223.82","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.72","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:13:42.700 INFO (MainThread) [ocpp] : send [3,"531613052",{}]
2025-12-23 13:13:45.313 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=8623; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:13:45.311552+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=8656; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:13:45.312043+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:13:47.818 INFO (MainThread) [ocpp] : receive message [2,"531613053","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:13:47.604Z","sampledValue":[{"value":"7.94","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"7.90","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"8.06","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"8.00","measurand":"Current.Offered","unit":"A"},{"value":"17137450.06","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.95","measurand":"Frequency"},{"value":"1797.95","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1752.17","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"1796.31","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"5346.42","measurand":"Power.Active.Import","unit":"W"},{"value":"99.63","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"99.76","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"5520.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"227.23","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"221.65","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"223.51","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.72","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:13:47.830 INFO (MainThread) [ocpp] : send [3,"531613053",{}]
2025-12-23 13:13:49.713 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_min_current: [FrameInfo(frame=<frame at 0x7f801e3120, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 402, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=402, function='get_state_config', code_context=['    state[CONF_MIN_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MIN_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=402, end_lineno=402, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028d480, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f937e4b80, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f7e294740, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f801ebc40, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f7e41d840, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f801ebb50, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f7e5af010, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f7e5af790, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f7e2949e0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f7e41f740, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f7e3ba770, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:13:49.753 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_max_current: [FrameInfo(frame=<frame at 0x7f801e3120, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 403, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=403, function='get_state_config', code_context=['    state[CONF_MAX_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MAX_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=403, end_lineno=403, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028d480, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f937e4b80, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f7e294740, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f801ebc40, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f7e41d840, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f801ebb50, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f7e5af010, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f7e5af790, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f7e2949e0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f7e41f740, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f7e3ba770, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:13:49.760 INFO (MainThread) [ocpp] : send [2,"8186b0e7-4a6e-47d7-8464-a4ba2dd4ddc5","SetChargingProfile",{"connectorId":0,"csChargingProfiles":{"chargingProfileId":11,"stackLevel":2,"chargingProfileKind":"Relative","chargingProfilePurpose":"TxDefaultProfile","validFrom":"2025-12-23T12:13:49Z","validTo":"2025-12-23T12:14:04Z","chargingSchedule":{"chargingRateUnit":"A","chargingSchedulePeriod":[{"startPeriod":0,"limit":8.7}]}}}]
2025-12-23 13:13:49.848 INFO (MainThread) [ocpp] : receive message [3,"8186b0e7-4a6e-47d7-8464-a4ba2dd4ddc5",{"status":"Accepted"}]
2025-12-23 13:13:50.313 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=8707; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:13:50.311270+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=8725; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:13:50.311759+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:13:52.906 INFO (MainThread) [ocpp] : receive message [2,"531613054","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:13:52.695Z","sampledValue":[{"value":"7.94","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"7.94","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"8.06","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"8.00","measurand":"Current.Offered","unit":"A"},{"value":"17137457.53","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.95","measurand":"Frequency"},{"value":"1790.13","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1749.61","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"1800.12","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"5339.87","measurand":"Power.Active.Import","unit":"W"},{"value":"99.60","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"99.53","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"99.83","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"5520.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"226.30","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"221.34","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"223.82","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.72","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:13:52.917 INFO (MainThread) [ocpp] : send [3,"531613054",{}]
2025-12-23 13:13:55.313 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=8770; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:13:55.311091+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=8788; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:13:55.311623+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:13:55.750 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=8774; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:13:55.748580+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=8762; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:13:55.749436+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:13:57.942 INFO (MainThread) [ocpp] : receive message [2,"531613055","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:13:57.698Z","sampledValue":[{"value":"7.94","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"7.98","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"8.09","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"8.00","measurand":"Current.Offered","unit":"A"},{"value":"17137465.05","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.95","measurand":"Frequency"},{"value":"1795.87","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1763.62","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"1809.48","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"5368.97","measurand":"Power.Active.Import","unit":"W"},{"value":"99.79","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"99.43","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"99.74","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"5520.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"226.61","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"222.27","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"224.13","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.72","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:13:57.953 INFO (MainThread) [ocpp] : send [3,"531613055",{}]
2025-12-23 13:13:59.714 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_min_current: [FrameInfo(frame=<frame at 0x7f7e46adf0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 402, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=402, function='get_state_config', code_context=['    state[CONF_MIN_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MIN_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=402, end_lineno=402, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028d480, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f8c814180, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f7e3a2880, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f801ebb50, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f7e41fc40, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f7e5ad030, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f7e5af880, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f7e5ade40, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f7e3a20a0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f7e41d840, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f7e3ba770, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:13:59.754 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_max_current: [FrameInfo(frame=<frame at 0x7f7e46adf0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 403, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=403, function='get_state_config', code_context=['    state[CONF_MAX_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MAX_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=403, end_lineno=403, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028d480, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f8c814180, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f7e3a2880, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f801ebb50, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f7e41fc40, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f7e5ad030, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f7e5af880, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f7e5ade40, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f7e3a20a0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f7e41d840, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f7e3ba770, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:13:59.760 INFO (MainThread) [ocpp] : send [2,"e2975e93-f7ff-424c-8a7c-661c73628d4d","SetChargingProfile",{"connectorId":0,"csChargingProfiles":{"chargingProfileId":11,"stackLevel":2,"chargingProfileKind":"Relative","chargingProfilePurpose":"TxDefaultProfile","validFrom":"2025-12-23T12:13:59Z","validTo":"2025-12-23T12:14:14Z","chargingSchedule":{"chargingRateUnit":"A","chargingSchedulePeriod":[{"startPeriod":0,"limit":8.6}]}}}]
2025-12-23 13:14:00.028 INFO (MainThread) [ocpp] : receive message [3,"e2975e93-f7ff-424c-8a7c-661c73628d4d",{"status":"Accepted"}]
2025-12-23 13:14:00.185 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=8479; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:14:00.183949+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=8338; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:14:00.184983+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:14:00.312 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=8609; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:14:00.310780+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=8745; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:14:00.311595+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:14:00.865 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=8873; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:14:00.864061+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=8937; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:14:00.864877+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:14:03.003 INFO (MainThread) [ocpp] : receive message [2,"531613056","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:14:02.833Z","sampledValue":[{"value":"7.98","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"7.98","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"8.09","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"8.00","measurand":"Current.Offered","unit":"A"},{"value":"17137472.55","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.95","measurand":"Frequency"},{"value":"1795.57","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1761.59","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"1803.65","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"5360.81","measurand":"Power.Active.Import","unit":"W"},{"value":"99.29","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"99.46","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"99.56","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"5520.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"226.61","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"221.96","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"223.82","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.72","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:14:03.015 INFO (MainThread) [ocpp] : send [3,"531613056",{}]
2025-12-23 13:14:05.313 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=9050; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:14:05.311167+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=9107; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:14:05.311680+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:14:05.678 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=9117; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:14:05.676862+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=9108; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:14:05.677700+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:14:08.066 INFO (MainThread) [ocpp] : receive message [2,"531613057","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:14:07.858Z","sampledValue":[{"value":"8.02","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"8.02","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"8.09","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"8.00","measurand":"Current.Offered","unit":"A"},{"value":"17137480.05","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.95","measurand":"Frequency"},{"value":"1811.76","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1768.17","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"1804.78","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"5384.72","measurand":"Power.Active.Import","unit":"W"},{"value":"99.44","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"99.35","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"99.76","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"5520.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"227.23","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"221.96","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"223.51","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.72","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:14:08.077 INFO (MainThread) [ocpp] : send [3,"531613057",{}]
2025-12-23 13:14:09.714 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_min_current: [FrameInfo(frame=<frame at 0x7f7e46a790, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 402, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=402, function='get_state_config', code_context=['    state[CONF_MIN_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MIN_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=402, end_lineno=402, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028d630, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f801cfec0, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f7e365ee0, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f7e5afd30, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f7e41f340, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f7e5aec50, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f7e5afa60, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f7e5af880, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f7e364ba0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f7e41f440, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f7e3ba770, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:14:09.756 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_max_current: [FrameInfo(frame=<frame at 0x7f7e46a790, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 403, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=403, function='get_state_config', code_context=['    state[CONF_MAX_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MAX_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=403, end_lineno=403, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028d630, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f801cfec0, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f7e365ee0, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f7e5afd30, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f7e41f340, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f7e5aec50, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f7e5afa60, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f7e5af880, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f7e364ba0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f7e41f440, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f7e3ba770, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:14:09.762 INFO (MainThread) [ocpp] : send [2,"593bbb00-e7c4-4c7c-9609-bd7bad168dad","SetChargingProfile",{"connectorId":0,"csChargingProfiles":{"chargingProfileId":11,"stackLevel":2,"chargingProfileKind":"Relative","chargingProfilePurpose":"TxDefaultProfile","validFrom":"2025-12-23T12:14:09Z","validTo":"2025-12-23T12:14:24Z","chargingSchedule":{"chargingRateUnit":"A","chargingSchedulePeriod":[{"startPeriod":0,"limit":9.0}]}}}]
2025-12-23 13:14:09.997 INFO (MainThread) [ocpp] : receive message [3,"593bbb00-e7c4-4c7c-9609-bd7bad168dad",{"status":"Accepted"}]
2025-12-23 13:14:10.313 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=9162; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:14:10.311098+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=9189; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:14:10.311653+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:14:10.755 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=8958; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:14:10.754474+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=8835; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:14:10.755311+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:14:13.120 INFO (MainThread) [ocpp] : receive message [2,"531613058","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:14:12.954Z","sampledValue":[{"value":"8.85","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"8.93","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"9.08","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"9.00","measurand":"Current.Offered","unit":"A"},{"value":"17137487.76","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.94","measurand":"Frequency"},{"value":"1999.54","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1976.79","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"2024.30","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"6000.63","measurand":"Power.Active.Import","unit":"W"},{"value":"99.79","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"99.73","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"99.59","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"6210.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"226.30","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"221.96","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"223.82","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.72","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:14:13.132 INFO (MainThread) [ocpp] : send [3,"531613058",{}]
2025-12-23 13:14:15.312 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=8858; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:14:15.310529+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=8869; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:14:15.311019+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:14:15.741 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=8797; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:14:15.739588+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=8758; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:14:15.740430+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:14:18.183 INFO (MainThread) [ocpp] : receive message [2,"531613059","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:14:17.979Z","sampledValue":[{"value":"8.97","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"8.97","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"9.08","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"9.00","measurand":"Current.Offered","unit":"A"},{"value":"17137496.44","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.94","measurand":"Frequency"},{"value":"2026.76","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1980.78","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"2030.65","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"6038.19","measurand":"Power.Active.Import","unit":"W"},{"value":"99.59","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"99.51","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"99.90","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"6210.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"226.92","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"221.96","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"223.82","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.72","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:14:18.194 INFO (MainThread) [ocpp] : send [3,"531613059",{}]
2025-12-23 13:14:19.715 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_min_current: [FrameInfo(frame=<frame at 0x7f801e3120, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 402, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=402, function='get_state_config', code_context=['    state[CONF_MIN_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MIN_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=402, end_lineno=402, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028d630, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f860c6340, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f7e285b60, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f7e5ad030, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f7e41f740, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f7e5afd30, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f7e5ad7b0, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f7e5ae2f0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f7e284820, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f7e41c540, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f7e3bbcd0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:14:19.755 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_max_current: [FrameInfo(frame=<frame at 0x7f801e3120, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 403, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=403, function='get_state_config', code_context=['    state[CONF_MAX_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MAX_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=403, end_lineno=403, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028d630, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f860c6340, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f7e285b60, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f7e5ad030, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f7e41f740, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f7e5afd30, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f7e5ad7b0, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f7e5ae2f0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f7e284820, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f7e41c540, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f7e3bbcd0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:14:19.758 INFO (MainThread) [ocpp] : send [2,"62bd3aec-4e8b-440a-b5a8-ad1bc54ed994","SetChargingProfile",{"connectorId":0,"csChargingProfiles":{"chargingProfileId":11,"stackLevel":2,"chargingProfileKind":"Relative","chargingProfilePurpose":"TxDefaultProfile","validFrom":"2025-12-23T12:14:19Z","validTo":"2025-12-23T12:14:34Z","chargingSchedule":{"chargingRateUnit":"A","chargingSchedulePeriod":[{"startPeriod":0,"limit":9.5}]}}}]
2025-12-23 13:14:19.967 INFO (MainThread) [ocpp] : receive message [3,"62bd3aec-4e8b-440a-b5a8-ad1bc54ed994",{"status":"Accepted"}]
2025-12-23 13:14:20.312 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=8744; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:14:20.310304+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=8737; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:14:20.310842+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:14:20.824 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=8687; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:14:20.823344+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=8664; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:14:20.824213+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:14:23.224 INFO (MainThread) [ocpp] : receive message [2,"531613060","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:14:23.056Z","sampledValue":[{"value":"8.97","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"8.97","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"9.08","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"9.00","measurand":"Current.Offered","unit":"A"},{"value":"17137504.96","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.95","measurand":"Frequency"},{"value":"2024.27","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1979.53","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"2021.22","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"6025.02","measurand":"Power.Active.Import","unit":"W"},{"value":"99.47","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"99.59","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"99.71","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"6210.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"226.92","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"221.65","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"223.20","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.72","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:14:23.235 INFO (MainThread) [ocpp] : send [3,"531613060",{}]
2025-12-23 13:14:25.312 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=8703; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:14:25.311111+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=8723; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:14:25.311645+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:14:25.760 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=9046; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:14:25.758585+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=9203; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:14:25.759390+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:14:28.366 INFO (MainThread) [ocpp] : receive message [2,"531613061","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:14:28.147Z","sampledValue":[{"value":"8.97","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"8.97","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"9.08","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"9.00","measurand":"Current.Offered","unit":"A"},{"value":"17137513.40","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.95","measurand":"Frequency"},{"value":"2028.66","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1978.05","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"2021.08","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"6027.79","measurand":"Power.Active.Import","unit":"W"},{"value":"99.69","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"99.51","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"99.56","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"6210.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"226.92","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"221.65","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"223.51","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.72","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:14:28.377 INFO (MainThread) [ocpp] : send [3,"531613061",{}]
2025-12-23 13:14:29.715 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_min_current: [FrameInfo(frame=<frame at 0x7f801e3120, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 402, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=402, function='get_state_config', code_context=['    state[CONF_MIN_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MIN_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=402, end_lineno=402, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028d630, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f801cfec0, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f802d0580, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f7e5af010, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f7e457140, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f7e5ad8a0, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f7e5aef20, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f7e5ad5d0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f802d20a0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f7e457e40, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f7e3bbcd0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:14:29.754 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_max_current: [FrameInfo(frame=<frame at 0x7f801e3120, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 403, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=403, function='get_state_config', code_context=['    state[CONF_MAX_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MAX_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=403, end_lineno=403, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028d630, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f801cfec0, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f802d0580, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f7e5af010, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f7e457140, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f7e5ad8a0, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f7e5aef20, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f7e5ad5d0, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f802d20a0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f7e457e40, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f7e3bbcd0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:14:29.760 INFO (MainThread) [ocpp] : send [2,"890a9342-84a4-4fda-865b-30b1459eb6b2","SetChargingProfile",{"connectorId":0,"csChargingProfiles":{"chargingProfileId":11,"stackLevel":2,"chargingProfileKind":"Relative","chargingProfilePurpose":"TxDefaultProfile","validFrom":"2025-12-23T12:14:29Z","validTo":"2025-12-23T12:14:44Z","chargingSchedule":{"chargingRateUnit":"A","chargingSchedulePeriod":[{"startPeriod":0,"limit":8.6}]}}}]
2025-12-23 13:14:29.967 INFO (MainThread) [ocpp] : receive message [3,"890a9342-84a4-4fda-865b-30b1459eb6b2",{"status":"Accepted"}]
2025-12-23 13:14:30.311 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=9402; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:14:30.310474+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=9501; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:14:30.310782+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:14:30.400 ERROR (MainThread) [homeassistant.components.websocket_api.commands] Unable to get manifest for integration goecharger_mqtt: Integration 'goecharger_mqtt' not found.
2025-12-23 13:14:30.760 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=9515; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:14:30.759298+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=9497; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:14:30.759827+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:14:33.321 INFO (MainThread) [ocpp] : receive message [2,"531613062","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:14:33.155Z","sampledValue":[{"value":"7.98","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"7.98","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"8.13","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"8.00","measurand":"Current.Offered","unit":"A"},{"value":"17137521.52","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.95","measurand":"Frequency"},{"value":"1795.52","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1766.38","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"1817.12","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"5379.02","measurand":"Power.Active.Import","unit":"W"},{"value":"99.43","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"99.59","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"99.42","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"5520.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"226.30","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"222.27","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"224.75","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.72","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:14:33.336 INFO (MainThread) [ocpp] : send [3,"531613062",{}]
2025-12-23 13:14:33.336 WARNING (Thread-1 (_monitor)) [homeassistant.util.logging] Module ocpp is logging too frequently. 200 messages since last count
2025-12-23 13:14:35.312 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=9572; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:14:35.310570+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=9610; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:14:35.310884+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:14:35.709 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=9135; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:14:35.708767+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=8888; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:14:35.709260+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:14:38.474 INFO (MainThread) [ocpp] : receive message [2,"531613063","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:14:38.263Z","sampledValue":[{"value":"7.98","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"7.94","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"8.06","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"8.00","measurand":"Current.Offered","unit":"A"},{"value":"17137529.03","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.95","measurand":"Frequency"},{"value":"1796.83","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1755.16","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"1804.52","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"5356.52","measurand":"Power.Active.Import","unit":"W"},{"value":"99.36","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"99.57","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"99.80","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"5520.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"226.61","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"221.96","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"224.44","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.72","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:14:38.484 INFO (MainThread) [ocpp] : send [3,"531613063",{}]
2025-12-23 13:14:39.676 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse]  Logging in 10
2025-12-23 13:14:39.676 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse]  Logging in 9
2025-12-23 13:14:39.676 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse]  Logging in 8
2025-12-23 13:14:39.676 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse]  Logging in 7
2025-12-23 13:14:39.676 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse]  Logging in 6
2025-12-23 13:14:39.676 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse]  Logging in 5
2025-12-23 13:14:39.676 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse]  Logging in 4
2025-12-23 13:14:39.676 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse]  Logging in 3
2025-12-23 13:14:39.676 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse]  Logging in 2
2025-12-23 13:14:39.676 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse]  Logging in 1
2025-12-23 13:14:39.676 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Getting attribute 'phases' for sensor: sensor.dynamic_ocpp_evse  -  <state sensor.dynamic_ocpp_evse=8.6; state_class=measurement, phases=3, charging_mode=Standard, calc_used=None, max_evse_available=8.55971014492754, last_update=2025-12-23T12:14:29.755939+01:00, pause_timer_running=False, last_set_current=8.6, target_evse=8.55971014492754, target_evse_standard=15.616666666666669, target_evse_eco=6, target_evse_solar=0, target_evse_excess=0, icon=mdi:transmission-tower, friendly_name=Dynamic OCPP EVSE @ 2025-12-23T13:14:29.756003+01:00>
2025-12-23 13:14:39.676 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Getting state for sensor: select.dynamic_ocpp_evse_charging_mode
2025-12-23 13:14:39.676 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Got state for sensor: select.dynamic_ocpp_evse_charging_mode  -  <state select.dynamic_ocpp_evse_charging_mode=Standard; options=['Standard', 'Eco', 'Solar', 'Excess'], friendly_name=Dynamic OCPP EVSE Charging Mode @ 2025-12-23T13:09:50.147963+01:00> (<class 'str'>)
2025-12-23 13:14:39.676 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Getting state for sensor: sensor.solaredge_i2_m1_ac_current_b
2025-12-23 13:14:39.676 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Got state for sensor: sensor.solaredge_i2_m1_ac_current_b  -  <state sensor.solaredge_i2_m1_ac_current_b=12.38; state_class=measurement, unit_of_measurement=A, device_class=current, friendly_name=Solaredge I2 M1 AC Current B @ 2025-12-23T13:14:35.703919+01:00> (<class 'str'>)
2025-12-23 13:14:39.676 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Sensor: sensor.solaredge_i2_m1_ac_current_b  -  <state sensor.solaredge_i2_m1_ac_current_b=12.38; state_class=measurement, unit_of_measurement=A, device_class=current, friendly_name=Solaredge I2 M1 AC Current B @ 2025-12-23T13:14:35.703919+01:00> is (<class 'float'>)
2025-12-23 13:14:39.676 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Getting state for sensor: sensor.solaredge_i2_m1_ac_current_a
2025-12-23 13:14:39.677 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Got state for sensor: sensor.solaredge_i2_m1_ac_current_a  -  <state sensor.solaredge_i2_m1_ac_current_a=11.84; state_class=measurement, unit_of_measurement=A, device_class=current, friendly_name=Solaredge I2 M1 AC Current A @ 2025-12-23T13:14:35.703870+01:00> (<class 'str'>)
2025-12-23 13:14:39.677 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Sensor: sensor.solaredge_i2_m1_ac_current_a  -  <state sensor.solaredge_i2_m1_ac_current_a=11.84; state_class=measurement, unit_of_measurement=A, device_class=current, friendly_name=Solaredge I2 M1 AC Current A @ 2025-12-23T13:14:35.703870+01:00> is (<class 'float'>)
2025-12-23 13:14:39.677 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Getting state for sensor: sensor.solaredge_i2_m1_ac_current_c
2025-12-23 13:14:39.677 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Got state for sensor: sensor.solaredge_i2_m1_ac_current_c  -  <state sensor.solaredge_i2_m1_ac_current_c=12.0; state_class=measurement, unit_of_measurement=A, device_class=current, friendly_name=Solaredge I2 M1 AC Current C @ 2025-12-23T13:14:35.703965+01:00> (<class 'str'>)
2025-12-23 13:14:39.677 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Sensor: sensor.solaredge_i2_m1_ac_current_c  -  <state sensor.solaredge_i2_m1_ac_current_c=12.0; state_class=measurement, unit_of_measurement=A, device_class=current, friendly_name=Solaredge I2 M1 AC Current C @ 2025-12-23T13:14:35.703965+01:00> is (<class 'float'>)
2025-12-23 13:14:39.677 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Getting state for sensor: sensor.charger_current_import
2025-12-23 13:14:39.677 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Got state for sensor: sensor.charger_current_import  -  <state sensor.charger_current_import=7.99333333333333; state_class=measurement, unit=A, L1=7.98, L2=7.94, L3=8.06, unit_of_measurement=A, device_class=current, icon=mdi:ev-station, friendly_name=Current Import @ 2025-12-23T13:14:38.480583+01:00> (<class 'str'>)
2025-12-23 13:14:39.677 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Sensor: sensor.charger_current_import  -  <state sensor.charger_current_import=7.99333333333333; state_class=measurement, unit=A, L1=7.98, L2=7.94, L3=8.06, unit_of_measurement=A, device_class=current, icon=mdi:ev-station, friendly_name=Current Import @ 2025-12-23T13:14:38.480583+01:00> is (<class 'float'>)
2025-12-23 13:14:39.677 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Getting state for sensor: sensor.charger_current_offered
2025-12-23 13:14:39.677 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Got state for sensor: sensor.charger_current_offered  -  <state sensor.charger_current_offered=8.0; state_class=measurement, context=Sample.Periodic, unit_of_measurement=A, device_class=current, icon=mdi:ev-station, friendly_name=Current Offered @ 2025-12-23T13:14:33.328262+01:00> (<class 'str'>)
2025-12-23 13:14:39.677 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Sensor: sensor.charger_current_offered  -  <state sensor.charger_current_offered=8.0; state_class=measurement, context=Sample.Periodic, unit_of_measurement=A, device_class=current, icon=mdi:ev-station, friendly_name=Current Offered @ 2025-12-23T13:14:33.328262+01:00> is (<class 'float'>)
2025-12-23 13:14:39.677 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Getting state for sensor: sensor.glajena_povprecna_moc_do_konca_cb
2025-12-23 13:14:39.677 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Got state for sensor: sensor.glajena_povprecna_moc_do_konca_cb  -  <state sensor.glajena_povprecna_moc_do_konca_cb=9523; state_class=measurement, buffer_usage_ratio=1.0, age_coverage_ratio=0.36, source_value_valid=True, unit_of_measurement=W, device_class=power, icon=mdi:calculator, friendly_name=Glajena povprecna moc do konca CB @ 2025-12-23T13:14:35.709635+01:00> (<class 'str'>)
2025-12-23 13:14:39.677 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Sensor: sensor.glajena_povprecna_moc_do_konca_cb  -  <state sensor.glajena_povprecna_moc_do_konca_cb=9523; state_class=measurement, buffer_usage_ratio=1.0, age_coverage_ratio=0.36, source_value_valid=True, unit_of_measurement=W, device_class=power, icon=mdi:calculator, friendly_name=Glajena povprecna moc do konca CB @ 2025-12-23T13:14:35.709635+01:00> is (<class 'float'>)
2025-12-23 13:14:39.677 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Getting state for sensor: number.dynamic_ocpp_evse_min_current
2025-12-23 13:14:39.722 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_min_current: [FrameInfo(frame=<frame at 0x7f7e620480, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 402, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=402, function='get_state_config', code_context=['    state[CONF_MIN_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MIN_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=402, end_lineno=402, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028d2d0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f8036d440, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f7e2ea6c0, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f802e4310, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f7e457540, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f7e5add50, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f7e5afd30, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f7e5ade40, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f7e2e84a0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f7e5b8340, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f7e3bbcd0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:14:39.723 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Getting state for sensor: number.dynamic_ocpp_evse_max_current
2025-12-23 13:14:39.767 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_max_current: [FrameInfo(frame=<frame at 0x7f7e46bcd0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f801f3810, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 403, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=403, function='get_state_config', code_context=['    state[CONF_MAX_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MAX_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=403, end_lineno=403, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028d2d0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f8036d440, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f7e2ea6c0, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f802e4310, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f7e457540, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f7e5add50, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7f7e5afd30, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7f7e5ade40, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f7e2e84a0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f7e5b8340, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f7e3bbcd0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:14:39.767 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Getting state for sensor: number.dynamic_ocpp_evse_home_battery_soc_target
2025-12-23 13:14:39.767 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Got state for sensor: number.dynamic_ocpp_evse_home_battery_soc_target  -  <state number.dynamic_ocpp_evse_home_battery_soc_target=80.0; min=10, max=100, step=5, mode=auto, friendly_name=Dynamic OCPP EVSE Home Battery SOC Target @ 2025-12-23T13:09:50.149562+01:00> (<class 'str'>)
2025-12-23 13:14:39.767 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Sensor: number.dynamic_ocpp_evse_home_battery_soc_target  -  <state number.dynamic_ocpp_evse_home_battery_soc_target=80.0; min=10, max=100, step=5, mode=auto, friendly_name=Dynamic OCPP EVSE Home Battery SOC Target @ 2025-12-23T13:09:50.149562+01:00> is (<class 'float'>)
2025-12-23 13:14:39.767 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Getting state for sensor: switch.dynamic_ocpp_evse_allow_grid_charging
2025-12-23 13:14:39.767 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Got state for sensor: switch.dynamic_ocpp_evse_allow_grid_charging  -  <state switch.dynamic_ocpp_evse_allow_grid_charging=on; friendly_name=Dynamic OCPP EVSE Allow Grid Charging @ 2025-12-23T13:09:50.150017+01:00> (<class 'str'>)
2025-12-23 13:14:39.767 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Calculating max EVSE available current with context: ChargeContext(state={'phases': 3, 'main_breaker_rating': 20, 'invert_phases': False, 'charging_mode': 'Standard', 'phase_a_current': 12.38, 'phase_b_current': 11.84, 'phase_c_current': 12.0, 'evse_current_import': 7.99333333333333, 'evse_current_offered': 8.0, 'max_import_power': 9523.0, 'phase_voltage': 230, 'evse_minimum_charge_current': 6, 'evse_maximum_charge_current': 16, 'min_current': None, 'max_current': None, 'excess_export_threshold': 8000, 'battery_soc': None, 'battery_power': None, 'battery_soc_target': 80.0, 'battery_max_charge_power': 5000, 'battery_max_discharge_power': 5000, 'power_buffer': 0, 'allow_grid_charging': True}, phases=3, voltage=230, total_import_current=36.22, grid_phase_a_current=12.38, grid_phase_b_current=11.84, grid_phase_c_current=12.0, phase_a_export_current=0, phase_b_export_current=0, phase_c_export_current=0, evse_current_per_phase=7.99333333333333, max_evse_available=0, min_current=6, max_current=16, total_export_power=0, battery_soc=None, battery_power=None, battery_soc_target=80.0, battery_max_charge_power=5000, battery_max_discharge_power=5000, allow_grid_charging=True, allow_grid_charging_entity_id=None)
2025-12-23 13:14:39.767 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Max import current: 41.404347826086955A, Total import current: 36.22A, Remaining available import current: 5.184347826086956A
2025-12-23 13:14:39.767 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Remaining available current - Phase A: 7.619999999999999A, Phase B: 8.16A, Phase C: 8.0A
2025-12-23 13:14:39.767 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Max EVSE available (3 phases): 9.721449275362314A
2025-12-23 13:14:39.767 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Standard mode: using buffered target 15.61333333333333A (buffer: 0W = 0.0A)
2025-12-23 13:14:39.768 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Ramping limited: 8.55971014492754 -> 9.06034104492754 (requested 9.721449275362314)
2025-12-23 13:14:39.768 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.sensor] Sending set_charge_rate with data: {'chargingProfileId': 11, 'stackLevel': 2, 'chargingProfileKind': 'Relative', 'chargingProfilePurpose': 'TxDefaultProfile', 'validFrom': '2025-12-23T12:14:39Z', 'validTo': '2025-12-23T12:14:54Z', 'chargingSchedule': {'chargingRateUnit': 'A', 'chargingSchedulePeriod': [{'startPeriod': 0, 'limit': 9.1}]}}
2025-12-23 13:14:39.773 INFO (MainThread) [ocpp] : send [2,"fe133ec7-f4f0-4854-b286-6071255e892a","SetChargingProfile",{"connectorId":0,"csChargingProfiles":{"chargingProfileId":11,"stackLevel":2,"chargingProfileKind":"Relative","chargingProfilePurpose":"TxDefaultProfile","validFrom":"2025-12-23T12:14:39Z","validTo":"2025-12-23T12:14:54Z","chargingSchedule":{"chargingRateUnit":"A","chargingSchedulePeriod":[{"startPeriod":0,"limit":9.1}]}}}]
2025-12-23 13:14:39.968 INFO (MainThread) [ocpp] : receive message [3,"fe133ec7-f4f0-4854-b286-6071255e892a",{"status":"Accepted"}]
2025-12-23 13:14:40.312 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=8854; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:14:40.310912+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=8837; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:14:40.311229+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:14:43.502 INFO (MainThread) [ocpp] : receive message [2,"531613064","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:14:43.327Z","sampledValue":[{"value":"8.93","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"8.97","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"9.12","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"9.00","measurand":"Current.Offered","unit":"A"},{"value":"17137536.85","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.95","measurand":"Frequency"},{"value":"2009.38","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1985.67","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"2033.25","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"6028.30","measurand":"Power.Active.Import","unit":"W"},{"value":"99.43","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"99.76","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"99.75","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"6210.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"226.30","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"221.96","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"223.51","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.72","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:14:43.515 INFO (MainThread) [ocpp] : send [3,"531613064",{}]
2025-12-23 13:14:45.313 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=8975; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:14:45.311584+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=9048; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:14:45.312069+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:14:45.829 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=10542; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:14:45.828007+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=11271; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:14:45.828816+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:14:48.614 INFO (MainThread) [ocpp] : receive message [2,"531613065","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:14:48.407Z","sampledValue":[{"value":"8.97","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"8.97","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"9.08","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"9.00","measurand":"Current.Offered","unit":"A"},{"value":"17137545.35","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.95","measurand":"Frequency"},{"value":"2025.49","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1979.12","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"2029.91","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"6034.52","measurand":"Power.Active.Import","unit":"W"},{"value":"99.53","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"99.84","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"99.86","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"6210.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"226.92","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"221.03","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"223.82","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.72","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:14:48.625 INFO (MainThread) [ocpp] : send [3,"531613065",{}]
2025-12-23 13:14:49.677 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse]  Logging in 10
2025-12-23 13:14:49.677 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse]  Logging in 9
2025-12-23 13:14:49.677 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse]  Logging in 8
2025-12-23 13:14:49.677 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse]  Logging in 7
2025-12-23 13:14:49.677 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse]  Logging in 6
2025-12-23 13:14:49.677 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse]  Logging in 5
2025-12-23 13:14:49.677 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse]  Logging in 4
2025-12-23 13:14:49.677 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse]  Logging in 3
2025-12-23 13:14:49.677 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse]  Logging in 2
2025-12-23 13:14:49.677 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse]  Logging in 1
2025-12-23 13:14:49.677 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Getting attribute 'phases' for sensor: sensor.dynamic_ocpp_evse  -  <state sensor.dynamic_ocpp_evse=9.1; state_class=measurement, phases=3, charging_mode=Standard, calc_used=None, max_evse_available=9.721449275362314, last_update=2025-12-23T12:14:39.768635+01:00, pause_timer_running=False, last_set_current=9.1, target_evse=9.721449275362314, target_evse_standard=15.61333333333333, target_evse_eco=6, target_evse_solar=0, target_evse_excess=0, icon=mdi:transmission-tower, friendly_name=Dynamic OCPP EVSE @ 2025-12-23T13:14:39.768693+01:00>
2025-12-23 13:14:49.677 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Getting state for sensor: select.dynamic_ocpp_evse_charging_mode
2025-12-23 13:14:49.677 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Got state for sensor: select.dynamic_ocpp_evse_charging_mode  -  <state select.dynamic_ocpp_evse_charging_mode=Standard; options=['Standard', 'Eco', 'Solar', 'Excess'], friendly_name=Dynamic OCPP EVSE Charging Mode @ 2025-12-23T13:09:50.147963+01:00> (<class 'str'>)
2025-12-23 13:14:49.677 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Getting state for sensor: sensor.solaredge_i2_m1_ac_current_b
2025-12-23 13:14:49.677 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Got state for sensor: sensor.solaredge_i2_m1_ac_current_b  -  <state sensor.solaredge_i2_m1_ac_current_b=12.94; state_class=measurement, unit_of_measurement=A, device_class=current, friendly_name=Solaredge I2 M1 AC Current B @ 2025-12-23T13:14:45.822635+01:00> (<class 'str'>)
2025-12-23 13:14:49.677 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Sensor: sensor.solaredge_i2_m1_ac_current_b  -  <state sensor.solaredge_i2_m1_ac_current_b=12.94; state_class=measurement, unit_of_measurement=A, device_class=current, friendly_name=Solaredge I2 M1 AC Current B @ 2025-12-23T13:14:45.822635+01:00> is (<class 'float'>)
2025-12-23 13:14:49.677 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Getting state for sensor: sensor.solaredge_i2_m1_ac_current_a
2025-12-23 13:14:49.677 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Got state for sensor: sensor.solaredge_i2_m1_ac_current_a  -  <state sensor.solaredge_i2_m1_ac_current_a=12.38; state_class=measurement, unit_of_measurement=A, device_class=current, friendly_name=Solaredge I2 M1 AC Current A @ 2025-12-23T13:14:45.822585+01:00> (<class 'str'>)
2025-12-23 13:14:49.677 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Sensor: sensor.solaredge_i2_m1_ac_current_a  -  <state sensor.solaredge_i2_m1_ac_current_a=12.38; state_class=measurement, unit_of_measurement=A, device_class=current, friendly_name=Solaredge I2 M1 AC Current A @ 2025-12-23T13:14:45.822585+01:00> is (<class 'float'>)
2025-12-23 13:14:49.678 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Getting state for sensor: sensor.solaredge_i2_m1_ac_current_c
2025-12-23 13:14:49.678 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Got state for sensor: sensor.solaredge_i2_m1_ac_current_c  -  <state sensor.solaredge_i2_m1_ac_current_c=12.52; state_class=measurement, unit_of_measurement=A, device_class=current, friendly_name=Solaredge I2 M1 AC Current C @ 2025-12-23T13:14:45.822682+01:00> (<class 'str'>)
2025-12-23 13:14:49.678 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Sensor: sensor.solaredge_i2_m1_ac_current_c  -  <state sensor.solaredge_i2_m1_ac_current_c=12.52; state_class=measurement, unit_of_measurement=A, device_class=current, friendly_name=Solaredge I2 M1 AC Current C @ 2025-12-23T13:14:45.822682+01:00> is (<class 'float'>)
2025-12-23 13:14:49.678 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Getting state for sensor: sensor.charger_current_import
2025-12-23 13:14:49.678 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Got state for sensor: sensor.charger_current_import  -  <state sensor.charger_current_import=9.00666666666667; state_class=measurement, unit=A, L1=8.97, L2=8.97, L3=9.08, unit_of_measurement=A, device_class=current, icon=mdi:ev-station, friendly_name=Current Import @ 2025-12-23T13:14:43.508655+01:00> (<class 'str'>)
2025-12-23 13:14:49.678 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Sensor: sensor.charger_current_import  -  <state sensor.charger_current_import=9.00666666666667; state_class=measurement, unit=A, L1=8.97, L2=8.97, L3=9.08, unit_of_measurement=A, device_class=current, icon=mdi:ev-station, friendly_name=Current Import @ 2025-12-23T13:14:43.508655+01:00> is (<class 'float'>)
2025-12-23 13:14:49.678 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Getting state for sensor: sensor.charger_current_offered
2025-12-23 13:14:49.678 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Got state for sensor: sensor.charger_current_offered  -  <state sensor.charger_current_offered=9.0; state_class=measurement, context=Sample.Periodic, unit_of_measurement=A, device_class=current, icon=mdi:ev-station, friendly_name=Current Offered @ 2025-12-23T13:14:43.508899+01:00> (<class 'str'>)
2025-12-23 13:14:49.678 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Sensor: sensor.charger_current_offered  -  <state sensor.charger_current_offered=9.0; state_class=measurement, context=Sample.Periodic, unit_of_measurement=A, device_class=current, icon=mdi:ev-station, friendly_name=Current Offered @ 2025-12-23T13:14:43.508899+01:00> is (<class 'float'>)
2025-12-23 13:14:49.678 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Getting state for sensor: sensor.glajena_povprecna_moc_do_konca_cb
2025-12-23 13:14:49.678 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Got state for sensor: sensor.glajena_povprecna_moc_do_konca_cb  -  <state sensor.glajena_povprecna_moc_do_konca_cb=8934; state_class=measurement, buffer_usage_ratio=1.0, age_coverage_ratio=0.67, source_value_valid=True, unit_of_measurement=W, device_class=power, icon=mdi:calculator, friendly_name=Glajena povprecna moc do konca CB @ 2025-12-23T13:14:45.829195+01:00> (<class 'str'>)
2025-12-23 13:14:49.678 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Sensor: sensor.glajena_povprecna_moc_do_konca_cb  -  <state sensor.glajena_povprecna_moc_do_konca_cb=8934; state_class=measurement, buffer_usage_ratio=1.0, age_coverage_ratio=0.67, source_value_valid=True, unit_of_measurement=W, device_class=power, icon=mdi:calculator, friendly_name=Glajena povprecna moc do konca CB @ 2025-12-23T13:14:45.829195+01:00> is (<class 'float'>)
2025-12-23 13:14:49.678 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Getting state for sensor: number.dynamic_ocpp_evse_min_current
2025-12-23 13:14:49.722 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_min_current: [FrameInfo(frame=<frame at 0x7f7e5447b0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f7e3bbba0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 402, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=402, function='get_state_config', code_context=['    state[CONF_MIN_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MIN_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=402, end_lineno=402, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028d480, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f8036d800, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f7e3643c0, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f7e5ae4d0, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f7e41f340, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f7e5af100, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7fa11945e0, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7fa1194130, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f7e3674c0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f7e41f440, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f7e3ba8a0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:14:49.722 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Getting state for sensor: number.dynamic_ocpp_evse_max_current
2025-12-23 13:14:49.762 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_max_current: [FrameInfo(frame=<frame at 0x7f7e46b780, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f7e3bbba0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 403, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=403, function='get_state_config', code_context=['    state[CONF_MAX_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MAX_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=403, end_lineno=403, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028d480, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f8036d800, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f7e3643c0, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7f7e5ae4d0, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f7e41f340, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7f7e5af100, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7fa11945e0, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7fa1194130, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f7e3674c0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f7e41f440, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f7e3ba8a0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:14:49.762 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Getting state for sensor: number.dynamic_ocpp_evse_home_battery_soc_target
2025-12-23 13:14:49.762 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Got state for sensor: number.dynamic_ocpp_evse_home_battery_soc_target  -  <state number.dynamic_ocpp_evse_home_battery_soc_target=80.0; min=10, max=100, step=5, mode=auto, friendly_name=Dynamic OCPP EVSE Home Battery SOC Target @ 2025-12-23T13:09:50.149562+01:00> (<class 'str'>)
2025-12-23 13:14:49.762 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Sensor: number.dynamic_ocpp_evse_home_battery_soc_target  -  <state number.dynamic_ocpp_evse_home_battery_soc_target=80.0; min=10, max=100, step=5, mode=auto, friendly_name=Dynamic OCPP EVSE Home Battery SOC Target @ 2025-12-23T13:09:50.149562+01:00> is (<class 'float'>)
2025-12-23 13:14:49.762 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Getting state for sensor: switch.dynamic_ocpp_evse_allow_grid_charging
2025-12-23 13:14:49.762 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Got state for sensor: switch.dynamic_ocpp_evse_allow_grid_charging  -  <state switch.dynamic_ocpp_evse_allow_grid_charging=on; friendly_name=Dynamic OCPP EVSE Allow Grid Charging @ 2025-12-23T13:09:50.150017+01:00> (<class 'str'>)
2025-12-23 13:14:49.762 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Calculating max EVSE available current with context: ChargeContext(state={'phases': 3, 'main_breaker_rating': 20, 'invert_phases': False, 'charging_mode': 'Standard', 'phase_a_current': 12.94, 'phase_b_current': 12.38, 'phase_c_current': 12.52, 'evse_current_import': 9.00666666666667, 'evse_current_offered': 9.0, 'max_import_power': 8934.0, 'phase_voltage': 230, 'evse_minimum_charge_current': 6, 'evse_maximum_charge_current': 16, 'min_current': None, 'max_current': None, 'excess_export_threshold': 8000, 'battery_soc': None, 'battery_power': None, 'battery_soc_target': 80.0, 'battery_max_charge_power': 5000, 'battery_max_discharge_power': 5000, 'power_buffer': 0, 'allow_grid_charging': True}, phases=3, voltage=230, total_import_current=37.84, grid_phase_a_current=12.94, grid_phase_b_current=12.38, grid_phase_c_current=12.52, phase_a_export_current=0, phase_b_export_current=0, phase_c_export_current=0, evse_current_per_phase=9.00666666666667, max_evse_available=0, min_current=6, max_current=16, total_export_power=0, battery_soc=None, battery_power=None, battery_soc_target=80.0, battery_max_charge_power=5000, battery_max_discharge_power=5000, allow_grid_charging=True, allow_grid_charging_entity_id=None)
2025-12-23 13:14:49.762 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Max import current: 38.84347826086957A, Total import current: 37.84A, Remaining available import current: 1.0034782608695636A
2025-12-23 13:14:49.762 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Remaining available current - Phase A: 7.0600000000000005A, Phase B: 7.619999999999999A, Phase C: 7.48A
2025-12-23 13:14:49.762 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Max EVSE available (3 phases): 9.341159420289857A
2025-12-23 13:14:49.762 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Standard mode: using buffered target 16.06666666666667A (buffer: 0W = 0.0A)
2025-12-23 13:14:49.763 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.sensor] Sending set_charge_rate with data: {'chargingProfileId': 11, 'stackLevel': 2, 'chargingProfileKind': 'Relative', 'chargingProfilePurpose': 'TxDefaultProfile', 'validFrom': '2025-12-23T12:14:49Z', 'validTo': '2025-12-23T12:15:04Z', 'chargingSchedule': {'chargingRateUnit': 'A', 'chargingSchedulePeriod': [{'startPeriod': 0, 'limit': 9.3}]}}
2025-12-23 13:14:49.770 INFO (MainThread) [ocpp] : send [2,"f7973f29-5fdc-4b0d-82cf-8509d3f7045e","SetChargingProfile",{"connectorId":0,"csChargingProfiles":{"chargingProfileId":11,"stackLevel":2,"chargingProfileKind":"Relative","chargingProfilePurpose":"TxDefaultProfile","validFrom":"2025-12-23T12:14:49Z","validTo":"2025-12-23T12:15:04Z","chargingSchedule":{"chargingRateUnit":"A","chargingSchedulePeriod":[{"startPeriod":0,"limit":9.3}]}}}]
2025-12-23 13:14:49.987 INFO (MainThread) [ocpp] : receive message [3,"f7973f29-5fdc-4b0d-82cf-8509d3f7045e",{"status":"Accepted"}]
2025-12-23 13:14:50.312 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=12636; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:14:50.310568+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=13318; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:14:50.311045+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:14:50.665 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=12410; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:14:50.663790+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=11785; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:14:50.664610+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:14:53.581 INFO (MainThread) [ocpp] : receive message [2,"531613066","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:14:53.416Z","sampledValue":[{"value":"8.97","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"8.97","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"9.12","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"9.00","measurand":"Current.Offered","unit":"A"},{"value":"17137553.85","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.96","measurand":"Frequency"},{"value":"2029.15","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1990.89","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"2035.33","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"6055.38","measurand":"Power.Active.Import","unit":"W"},{"value":"99.71","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"99.88","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"99.71","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"6210.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"226.92","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"222.27","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"223.82","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.72","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:14:53.594 INFO (MainThread) [ocpp] : send [3,"531613066",{}]
2025-12-23 13:14:55.313 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=12733; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:14:55.311277+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=13207; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:14:55.311765+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:14:58.714 INFO (MainThread) [ocpp] : receive message [2,"531613067","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:14:58.507Z","sampledValue":[{"value":"9.01","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"8.97","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"9.12","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"9.00","measurand":"Current.Offered","unit":"A"},{"value":"17137562.31","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.96","measurand":"Frequency"},{"value":"2034.35","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1993.70","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"2034.01","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"6062.05","measurand":"Power.Active.Import","unit":"W"},{"value":"99.68","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"99.78","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"6210.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"226.61","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"222.27","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"223.51","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.72","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:14:58.725 INFO (MainThread) [ocpp] : send [3,"531613067",{}]
2025-12-23 13:14:59.677 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse]  Logging in 10
2025-12-23 13:14:59.677 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse]  Logging in 9
2025-12-23 13:14:59.677 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse]  Logging in 8
2025-12-23 13:14:59.677 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse]  Logging in 7
2025-12-23 13:14:59.677 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse]  Logging in 6
2025-12-23 13:14:59.677 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse]  Logging in 5
2025-12-23 13:14:59.677 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse]  Logging in 4
2025-12-23 13:14:59.677 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse]  Logging in 3
2025-12-23 13:14:59.677 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse]  Logging in 2
2025-12-23 13:14:59.677 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse]  Logging in 1
2025-12-23 13:14:59.678 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Getting attribute 'phases' for sensor: sensor.dynamic_ocpp_evse  -  <state sensor.dynamic_ocpp_evse=9.3; state_class=measurement, phases=3, charging_mode=Standard, calc_used=None, max_evse_available=9.341159420289857, last_update=2025-12-23T12:14:49.763581+01:00, pause_timer_running=False, last_set_current=9.3, target_evse=9.341159420289857, target_evse_standard=16.06666666666667, target_evse_eco=6, target_evse_solar=0, target_evse_excess=0, icon=mdi:transmission-tower, friendly_name=Dynamic OCPP EVSE @ 2025-12-23T13:14:49.763641+01:00>
2025-12-23 13:14:59.678 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Getting state for sensor: select.dynamic_ocpp_evse_charging_mode
2025-12-23 13:14:59.678 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Got state for sensor: select.dynamic_ocpp_evse_charging_mode  -  <state select.dynamic_ocpp_evse_charging_mode=Standard; options=['Standard', 'Eco', 'Solar', 'Excess'], friendly_name=Dynamic OCPP EVSE Charging Mode @ 2025-12-23T13:09:50.147963+01:00> (<class 'str'>)
2025-12-23 13:14:59.678 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Getting state for sensor: sensor.solaredge_i2_m1_ac_current_b
2025-12-23 13:14:59.678 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Got state for sensor: sensor.solaredge_i2_m1_ac_current_b  -  <state sensor.solaredge_i2_m1_ac_current_b=13.43; state_class=measurement, unit_of_measurement=A, device_class=current, friendly_name=Solaredge I2 M1 AC Current B @ 2025-12-23T13:14:55.683702+01:00> (<class 'str'>)
2025-12-23 13:14:59.678 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Sensor: sensor.solaredge_i2_m1_ac_current_b  -  <state sensor.solaredge_i2_m1_ac_current_b=13.43; state_class=measurement, unit_of_measurement=A, device_class=current, friendly_name=Solaredge I2 M1 AC Current B @ 2025-12-23T13:14:55.683702+01:00> is (<class 'float'>)
2025-12-23 13:14:59.678 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Getting state for sensor: sensor.solaredge_i2_m1_ac_current_a
2025-12-23 13:14:59.678 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Got state for sensor: sensor.solaredge_i2_m1_ac_current_a  -  <state sensor.solaredge_i2_m1_ac_current_a=12.86; state_class=measurement, unit_of_measurement=A, device_class=current, friendly_name=Solaredge I2 M1 AC Current A @ 2025-12-23T13:14:55.683651+01:00> (<class 'str'>)
2025-12-23 13:14:59.678 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Sensor: sensor.solaredge_i2_m1_ac_current_a  -  <state sensor.solaredge_i2_m1_ac_current_a=12.86; state_class=measurement, unit_of_measurement=A, device_class=current, friendly_name=Solaredge I2 M1 AC Current A @ 2025-12-23T13:14:55.683651+01:00> is (<class 'float'>)
2025-12-23 13:14:59.678 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Getting state for sensor: sensor.solaredge_i2_m1_ac_current_c
2025-12-23 13:14:59.678 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Got state for sensor: sensor.solaredge_i2_m1_ac_current_c  -  <state sensor.solaredge_i2_m1_ac_current_c=13.02; state_class=measurement, unit_of_measurement=A, device_class=current, friendly_name=Solaredge I2 M1 AC Current C @ 2025-12-23T13:14:55.683752+01:00> (<class 'str'>)
2025-12-23 13:14:59.678 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Sensor: sensor.solaredge_i2_m1_ac_current_c  -  <state sensor.solaredge_i2_m1_ac_current_c=13.02; state_class=measurement, unit_of_measurement=A, device_class=current, friendly_name=Solaredge I2 M1 AC Current C @ 2025-12-23T13:14:55.683752+01:00> is (<class 'float'>)
2025-12-23 13:14:59.678 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Getting state for sensor: sensor.charger_current_import
2025-12-23 13:14:59.678 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Got state for sensor: sensor.charger_current_import  -  <state sensor.charger_current_import=9.03333333333333; state_class=measurement, unit=A, L1=9.01, L2=8.97, L3=9.12, unit_of_measurement=A, device_class=current, icon=mdi:ev-station, friendly_name=Current Import @ 2025-12-23T13:14:58.720507+01:00> (<class 'str'>)
2025-12-23 13:14:59.678 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Sensor: sensor.charger_current_import  -  <state sensor.charger_current_import=9.03333333333333; state_class=measurement, unit=A, L1=9.01, L2=8.97, L3=9.12, unit_of_measurement=A, device_class=current, icon=mdi:ev-station, friendly_name=Current Import @ 2025-12-23T13:14:58.720507+01:00> is (<class 'float'>)
2025-12-23 13:14:59.678 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Getting state for sensor: sensor.charger_current_offered
2025-12-23 13:14:59.678 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Got state for sensor: sensor.charger_current_offered  -  <state sensor.charger_current_offered=9.0; state_class=measurement, context=Sample.Periodic, unit_of_measurement=A, device_class=current, icon=mdi:ev-station, friendly_name=Current Offered @ 2025-12-23T13:14:43.508899+01:00> (<class 'str'>)
2025-12-23 13:14:59.678 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Sensor: sensor.charger_current_offered  -  <state sensor.charger_current_offered=9.0; state_class=measurement, context=Sample.Periodic, unit_of_measurement=A, device_class=current, icon=mdi:ev-station, friendly_name=Current Offered @ 2025-12-23T13:14:43.508899+01:00> is (<class 'float'>)
2025-12-23 13:14:59.678 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Getting state for sensor: sensor.glajena_povprecna_moc_do_konca_cb
2025-12-23 13:14:59.679 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Got state for sensor: sensor.glajena_povprecna_moc_do_konca_cb  -  <state sensor.glajena_povprecna_moc_do_konca_cb=12144; state_class=measurement, buffer_usage_ratio=1.0, age_coverage_ratio=0.63, source_value_valid=True, unit_of_measurement=W, device_class=power, icon=mdi:calculator, friendly_name=Glajena povprecna moc do konca CB @ 2025-12-23T13:14:55.313641+01:00> (<class 'str'>)
2025-12-23 13:14:59.679 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Sensor: sensor.glajena_povprecna_moc_do_konca_cb  -  <state sensor.glajena_povprecna_moc_do_konca_cb=12144; state_class=measurement, buffer_usage_ratio=1.0, age_coverage_ratio=0.63, source_value_valid=True, unit_of_measurement=W, device_class=power, icon=mdi:calculator, friendly_name=Glajena povprecna moc do konca CB @ 2025-12-23T13:14:55.313641+01:00> is (<class 'float'>)
2025-12-23 13:14:59.679 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Getting state for sensor: number.dynamic_ocpp_evse_min_current
2025-12-23 13:14:59.724 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_min_current: [FrameInfo(frame=<frame at 0x7f7e550ae0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f7e3bbba0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 402, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=402, function='get_state_config', code_context=['    state[CONF_MIN_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MIN_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=402, end_lineno=402, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028d480, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f8036d6c0, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f7e2eb5a0, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7fa1197010, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f7e457e40, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7fa1194e50, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7fa1195a80, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7fa1195b70, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f7e2e8ac0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f7e457240, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f7e3ba8a0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:14:59.724 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Getting state for sensor: number.dynamic_ocpp_evse_max_current
2025-12-23 13:14:59.765 WARNING (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Failed to get state for sensor: number.dynamic_ocpp_evse_max_current: [FrameInfo(frame=<frame at 0x7f7e46bbc0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 47, code get_sensor_data>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=47, function='get_sensor_data', code_context=['        _LOGGER.warning(f"Failed to get state for sensor: {sensor}: {inspect.stack()}")\n'], index=0, positions=Positions(lineno=47, end_lineno=47, col_offset=69, end_col_offset=84)), FrameInfo(frame=<frame at 0x7f7e3bbba0, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 403, code get_state_config>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=403, function='get_state_config', code_context=['    state[CONF_MAX_CURRENT] = get_sensor_data(self, self.config_entry.data.get(CONF_MAX_CURRENT_ENTITY_ID))\n'], index=0, positions=Positions(lineno=403, end_lineno=403, col_offset=30, end_col_offset=107)), FrameInfo(frame=<frame at 0x7f8028d480, file '/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', line 524, code calculate_available_current>, filename='/config/custom_components/dynamic_ocpp_evse/dynamic_ocpp_evse.py', lineno=524, function='calculate_available_current', code_context=['    state = get_state_config(self)\n'], index=0, positions=Positions(lineno=524, end_lineno=524, col_offset=12, end_col_offset=34)), FrameInfo(frame=<frame at 0x7f8036d6c0, file '/config/custom_components/dynamic_ocpp_evse/sensor.py', line 140, code async_update>, filename='/config/custom_components/dynamic_ocpp_evse/sensor.py', lineno=140, function='async_update', code_context=['            data = calculate_available_current(self)\n'], index=0, positions=Positions(lineno=140, end_lineno=140, col_offset=19, end_col_offset=52)), FrameInfo(frame=<frame at 0x7f7e2eb5a0, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 1312, code async_device_update>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=1312, function='async_device_update', code_context=['                await self.async_update()\n'], index=0, positions=Positions(lineno=1312, end_lineno=1312, col_offset=16, end_col_offset=41)), FrameInfo(frame=<frame at 0x7fa1197010, file '/usr/src/homeassistant/homeassistant/helpers/entity.py', line 961, code async_update_ha_state>, filename='/usr/src/homeassistant/homeassistant/helpers/entity.py', lineno=961, function='async_update_ha_state', code_context=['                await self.async_device_update()\n'], index=0, positions=Positions(lineno=961, end_lineno=961, col_offset=16, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f7e457e40, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 1135, code _async_update_entity_states>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=1135, function='_async_update_entity_states', code_context=['                        await entity.async_update_ha_state(True)\n'], index=0, positions=Positions(lineno=1135, end_lineno=1135, col_offset=24, end_col_offset=64)), FrameInfo(frame=<frame at 0x7fa1194e50, file '/usr/src/homeassistant/homeassistant/util/async_.py', line 44, code create_eager_task>, filename='/usr/src/homeassistant/homeassistant/util/async_.py', lineno=44, function='create_eager_task', code_context=['    return Task(coro, loop=loop, name=name, eager_start=True)\n'], index=0, positions=Positions(lineno=44, end_lineno=44, col_offset=11, end_col_offset=61)), FrameInfo(frame=<frame at 0x7fa1195a80, file '/usr/src/homeassistant/homeassistant/core.py', line 842, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/core.py', lineno=842, function='async_create_background_task', code_context=['            task = create_eager_task(target, name=name, loop=self.loop)\n'], index=0, positions=Positions(lineno=842, end_lineno=842, col_offset=19, end_col_offset=71)), FrameInfo(frame=<frame at 0x7fa1195b70, file '/usr/src/homeassistant/homeassistant/config_entries.py', line 1336, code async_create_background_task>, filename='/usr/src/homeassistant/homeassistant/config_entries.py', lineno=1336, function='async_create_background_task', code_context=['        task = hass.async_create_background_task(target, name, eager_start)\n'], index=0, positions=Positions(lineno=1336, end_lineno=1336, col_offset=15, end_col_offset=75)), FrameInfo(frame=<frame at 0x7f7e2e8ac0, file '/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', line 757, code _async_handle_interval_callback>, filename='/usr/src/homeassistant/homeassistant/helpers/entity_platform.py', lineno=757, function='_async_handle_interval_callback', code_context=['            self.config_entry.async_create_background_task(\n'], index=0, positions=Positions(lineno=757, end_lineno=762, col_offset=12, end_col_offset=13)), FrameInfo(frame=<frame at 0x7f7e457240, file '/usr/local/lib/python3.13/asyncio/events.py', line 89, code _run>, filename='/usr/local/lib/python3.13/asyncio/events.py', lineno=89, function='_run', code_context=['            self._context.run(self._callback, *self._args)\n'], index=0, positions=Positions(lineno=89, end_lineno=89, col_offset=12, end_col_offset=58)), FrameInfo(frame=<frame at 0x7f7e3ba8a0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 2050, code _run_once>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=2050, function='_run_once', code_context=['                handle._run()\n'], index=0, positions=Positions(lineno=2050, end_lineno=2050, col_offset=16, end_col_offset=29)), FrameInfo(frame=<frame at 0x7fa1136e00, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 683, code run_forever>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=683, function='run_forever', code_context=['                self._run_once()\n'], index=0, positions=Positions(lineno=683, end_lineno=683, col_offset=16, end_col_offset=32)), FrameInfo(frame=<frame at 0x7f859da6c0, file '/usr/local/lib/python3.13/asyncio/base_events.py', line 712, code run_until_complete>, filename='/usr/local/lib/python3.13/asyncio/base_events.py', lineno=712, function='run_until_complete', code_context=['            self.run_forever()\n'], index=0, positions=Positions(lineno=712, end_lineno=712, col_offset=12, end_col_offset=30)), FrameInfo(frame=<frame at 0x7f859da500, file '/usr/src/homeassistant/homeassistant/runner.py', line 289, code run>, filename='/usr/src/homeassistant/homeassistant/runner.py', lineno=289, function='run', code_context=['        return loop.run_until_complete(setup_and_run_hass(runtime_config))\n'], index=0, positions=Positions(lineno=289, end_lineno=289, col_offset=15, end_col_offset=74)), FrameInfo(frame=<frame at 0x7f85a75d00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 215, code main>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=215, function='main', code_context=['            exit_code = runner.run(runtime_conf)\n'], index=0, positions=Positions(lineno=215, end_lineno=215, col_offset=24, end_col_offset=48)), FrameInfo(frame=<frame at 0x7f85ac6e00, file '/usr/src/homeassistant/homeassistant/__main__.py', line 229, code <module>>, filename='/usr/src/homeassistant/homeassistant/__main__.py', lineno=229, function='<module>', code_context=['    sys.exit(main())\n'], index=0, positions=Positions(lineno=229, end_lineno=229, col_offset=13, end_col_offset=19)), FrameInfo(frame=<frame at 0x7f85ad7600, file '<frozen runpy>', line 88, code _run_code>, filename='<frozen runpy>', lineno=88, function='_run_code', code_context=None, index=None, positions=Positions(lineno=88, end_lineno=88, col_offset=4, end_col_offset=27)), FrameInfo(frame=<frame at 0x7f85ada570, file '<frozen runpy>', line 198, code _run_module_as_main>, filename='<frozen runpy>', lineno=198, function='_run_module_as_main', code_context=None, index=None, positions=Positions(lineno=198, end_lineno=199, col_offset=11, end_col_offset=42))]
2025-12-23 13:14:59.765 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Getting state for sensor: number.dynamic_ocpp_evse_home_battery_soc_target
2025-12-23 13:14:59.766 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Got state for sensor: number.dynamic_ocpp_evse_home_battery_soc_target  -  <state number.dynamic_ocpp_evse_home_battery_soc_target=80.0; min=10, max=100, step=5, mode=auto, friendly_name=Dynamic OCPP EVSE Home Battery SOC Target @ 2025-12-23T13:09:50.149562+01:00> (<class 'str'>)
2025-12-23 13:14:59.766 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Sensor: number.dynamic_ocpp_evse_home_battery_soc_target  -  <state number.dynamic_ocpp_evse_home_battery_soc_target=80.0; min=10, max=100, step=5, mode=auto, friendly_name=Dynamic OCPP EVSE Home Battery SOC Target @ 2025-12-23T13:09:50.149562+01:00> is (<class 'float'>)
2025-12-23 13:14:59.766 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Getting state for sensor: switch.dynamic_ocpp_evse_allow_grid_charging
2025-12-23 13:14:59.766 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Got state for sensor: switch.dynamic_ocpp_evse_allow_grid_charging  -  <state switch.dynamic_ocpp_evse_allow_grid_charging=on; friendly_name=Dynamic OCPP EVSE Allow Grid Charging @ 2025-12-23T13:09:50.150017+01:00> (<class 'str'>)
2025-12-23 13:14:59.766 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Calculating max EVSE available current with context: ChargeContext(state={'phases': 3, 'main_breaker_rating': 20, 'invert_phases': False, 'charging_mode': 'Standard', 'phase_a_current': 13.43, 'phase_b_current': 12.86, 'phase_c_current': 13.02, 'evse_current_import': 9.03333333333333, 'evse_current_offered': 9.0, 'max_import_power': 12144.0, 'phase_voltage': 230, 'evse_minimum_charge_current': 6, 'evse_maximum_charge_current': 16, 'min_current': None, 'max_current': None, 'excess_export_threshold': 8000, 'battery_soc': None, 'battery_power': None, 'battery_soc_target': 80.0, 'battery_max_charge_power': 5000, 'battery_max_discharge_power': 5000, 'power_buffer': 0, 'allow_grid_charging': True}, phases=3, voltage=230, total_import_current=39.31, grid_phase_a_current=13.43, grid_phase_b_current=12.86, grid_phase_c_current=13.02, phase_a_export_current=0, phase_b_export_current=0, phase_c_export_current=0, evse_current_per_phase=9.03333333333333, max_evse_available=0, min_current=6, max_current=16, total_export_power=0, battery_soc=None, battery_power=None, battery_soc_target=80.0, battery_max_charge_power=5000, battery_max_discharge_power=5000, allow_grid_charging=True, allow_grid_charging_entity_id=None)
2025-12-23 13:14:59.766 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Max import current: 52.8A, Total import current: 39.31A, Remaining available import current: 13.489999999999995A
2025-12-23 13:14:59.766 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Remaining available current - Phase A: 6.57A, Phase B: 7.140000000000001A, Phase C: 6.98A
2025-12-23 13:14:59.766 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Max EVSE available (3 phases): 13.529999999999994A
2025-12-23 13:14:59.766 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Standard mode: using buffered target 15.60333333333333A (buffer: 0W = 0.0A)
2025-12-23 13:14:59.766 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.dynamic_ocpp_evse] Ramping limited: 9.341159420289857 -> 9.841336470289857 (requested 13.529999999999994)
2025-12-23 13:14:59.766 DEBUG (MainThread) [custom_components.dynamic_ocpp_evse.sensor] Sending set_charge_rate with data: {'chargingProfileId': 11, 'stackLevel': 2, 'chargingProfileKind': 'Relative', 'chargingProfilePurpose': 'TxDefaultProfile', 'validFrom': '2025-12-23T12:14:59Z', 'validTo': '2025-12-23T12:15:14Z', 'chargingSchedule': {'chargingRateUnit': 'A', 'chargingSchedulePeriod': [{'startPeriod': 0, 'limit': 9.8}]}}
2025-12-23 13:14:59.769 INFO (MainThread) [ocpp] : send [2,"d7004fd2-4d6a-4573-ae83-e429b6017a15","SetChargingProfile",{"connectorId":0,"csChargingProfiles":{"chargingProfileId":11,"stackLevel":2,"chargingProfileKind":"Relative","chargingProfilePurpose":"TxDefaultProfile","validFrom":"2025-12-23T12:14:59Z","validTo":"2025-12-23T12:15:14Z","chargingSchedule":{"chargingRateUnit":"A","chargingSchedulePeriod":[{"startPeriod":0,"limit":9.8}]}}}]
2025-12-23 13:14:59.967 INFO (MainThread) [ocpp] : receive message [3,"d7004fd2-4d6a-4573-ae83-e429b6017a15",{"status":"Accepted"}]
2025-12-23 13:15:00.004 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=13722; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:15:00.002694+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=13861; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:15:00.003557+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:15:00.313 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=9528; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:15:00.311017+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=7362; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:15:00.311648+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:15:00.858 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=5678; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:15:00.857003+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=5377; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:15:00.857940+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
2025-12-23 13:15:03.703 INFO (MainThread) [ocpp] : receive message [2,"531613068","MeterValues",{"connectorId":1,"transactionId":1766486654,"meterValue":[{"timestamp":"2025-12-23T12:15:03.538Z","sampledValue":[{"value":"9.01","measurand":"Current.Import","unit":"A","phase":"L1"},{"value":"8.97","measurand":"Current.Import","unit":"A","phase":"L2"},{"value":"9.12","measurand":"Current.Import","unit":"A","phase":"L3"},{"value":"9.00","measurand":"Current.Offered","unit":"A"},{"value":"17137570.77","measurand":"Energy.Active.Import.Register","unit":"Wh"},{"value":"49.96","measurand":"Frequency"},{"value":"2039.12","measurand":"Power.Active.Import","unit":"W","phase":"L1"},{"value":"1995.41","measurand":"Power.Active.Import","unit":"W","phase":"L2"},{"value":"2032.81","measurand":"Power.Active.Import","unit":"W","phase":"L3"},{"value":"6067.34","measurand":"Power.Active.Import","unit":"W"},{"value":"99.78","measurand":"Power.Factor","unit":"Percent","phase":"L1"},{"value":"99.97","measurand":"Power.Factor","unit":"Percent","phase":"L2"},{"value":"99.72","measurand":"Power.Factor","unit":"Percent","phase":"L3"},{"value":"100.00","measurand":"Power.Factor","unit":"Percent","phase":"N"},{"value":"6210.00","measurand":"Power.Offered","unit":"W"},{"value":"23000.00","measurand":"Temperature","unit":"Celsius"},{"value":"226.92","measurand":"Voltage","unit":"V","phase":"L1"},{"value":"222.58","measurand":"Voltage","unit":"V","phase":"L2"},{"value":"223.51","measurand":"Voltage","unit":"V","phase":"L3"},{"value":"3.41","measurand":"Voltage","unit":"V","phase":"N"}]}]}]
2025-12-23 13:15:03.714 INFO (MainThread) [ocpp] : send [3,"531613068",{}]
2025-12-23 13:15:05.313 WARNING (MainThread) [homeassistant.components.template.template_entity] Template loop detected while processing event: <Event state_changed[L]: entity_id=sensor.povprecna_moc_do_konca_cb, old_state=<state sensor.povprecna_moc_do_konca_cb=5219; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:15:05.310280+01:00>, new_state=<state sensor.povprecna_moc_do_konca_cb=5140; state_class=measurement, unit_of_measurement=W, device_class=power, friendly_name=Povprecna Moc do konca CB @ 2025-12-23T13:15:05.311459+01:00>>, skipping template render for Template[{% set old = states('sensor.povprecna_moc_do_konca_cb') | float(3600) %}

{% set used_energy = states('sensor.trenutni_cb_import_adjusted') | float %}

{% set available_energy = states('number.trenutna_omejitev') | float / 4000 %}
{% set remainig_time = states('sensor.time_remaining_in_15_minute_block') | int %}
{% set buffer = states('input_number.evse_power_buffer') | int / 4000 %}
{% set remaining_energy = available_energy - used_energy - buffer %}
{% set varovalke = states('input_number.moc_varovalk') | float %}

{% set target = ([remaining_energy * 1000 * 3600 / remainig_time, varovalke] | min) %}
{{ (old/2 + target/2) | round }}]
